<!doctype html><html lang="zh-CN"><head><meta charset="utf-8" /><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="generator" content="VuePress 2.0.0-rc.26" /><meta name="theme" content="VuePress Theme Plume 1.0.0-rc.180" /><script id="check-mac-os">document.documentElement.classList.toggle('mac', /Mac|iPhone|iPod|iPad/i.test(navigator.platform))</script><script id="check-dark-mode">;(function () {const um= localStorage.getItem('vuepress-theme-appearance') || 'auto';const sm = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;const isDark = um === 'dark' || (um !== 'light' && sm);document.documentElement.dataset.theme = isDark ? 'dark' : 'light';})();</script><link rel="icon" type="image/svg+xml" href="/assests/jade_light.svg"><title>计算机网络 | JinBlog</title><meta name="description" content="走在未知的道路上, 不许停也不能回头"><link rel="preload" href="/JinBlog/assets/style-Dud8xOD9.css" as="style"><link rel="stylesheet" href="/JinBlog/assets/style-Dud8xOD9.css"><link rel="modulepreload" href="/JinBlog/assets/app-AuyBpmKP.js"><link rel="modulepreload" href="/JinBlog/assets/index.html-oA2l1sfy.js"></head><body><div id="app"><!--[--><!--[--><div class="theme-plume vp-layout" vp-container data-v-6fcf39b7><!--[--><!--[--><!--]--><!--[--><span tabindex="-1" data-v-a1e390b2></span><a href="#VPContent" class="vp-skip-link visually-hidden" data-v-a1e390b2> Skip to content </a><!--]--><!----><header class="vp-nav" data-v-6fcf39b7 data-v-04ce2e5b><div class="vp-navbar" vp-navbar data-v-04ce2e5b data-v-43d9cf9e><div class="wrapper" data-v-43d9cf9e><div class="container" data-v-43d9cf9e><div class="title" data-v-43d9cf9e><div class="vp-navbar-title has-sidebar" data-v-43d9cf9e data-v-6c4c1c9c><a class="vp-link link no-icon title" href="/JinBlog/" data-v-6c4c1c9c><!--[--><!--[--><!--]--><!--[--><!--[--><!--[--><img class="vp-image dark logo" style="" src="/JinBlog/assests/jade_light.svg" alt data-v-264f5058><!--]--><!--[--><img class="vp-image light logo" style="" src="/JinBlog/assests/jade_light.svg" alt data-v-264f5058><!--]--><!--]--><!--]--><span data-v-6c4c1c9c>JinBlog</span><!--[--><!--]--><!--]--></a></div></div><div class="content" data-v-43d9cf9e><div class="content-body" data-v-43d9cf9e><!--[--><!--]--><div class="vp-navbar-search search" data-v-43d9cf9e><div class="search-wrapper" data-v-47ff7b1a><!----><div id="local-search" data-v-47ff7b1a><button type="button" class="mini-search mini-search-button" aria-label="搜索文档" data-v-47ff7b1a><span class="mini-search-button-container"><span class="mini-search-search-icon vpi-mini-search" aria-label="search icon"></span><span class="mini-search-button-placeholder">搜索文档</span></span><span class="mini-search-button-keys"><kbd class="mini-search-button-key"></kbd><kbd class="mini-search-button-key">K</kbd></span></button></div></div></div><!--[--><!--]--><nav aria-labelledby="main-nav-aria-label" class="vp-navbar-menu menu" data-v-43d9cf9e data-v-098c5d7d><span id="main-nav-aria-label" class="visually-hidden" data-v-098c5d7d>Main Navigation</span><!--[--><!--[--><a class="vp-link link navbar-menu-link" href="/JinBlog/" tabindex="0" data-v-098c5d7d data-v-6cfe1038><!--[--><!----><span data-v-6cfe1038>首页</span><!----><!--]--></a><!--]--><!--[--><a class="vp-link link navbar-menu-link" href="/JinBlog/blog/posts/" tabindex="0" data-v-098c5d7d data-v-6cfe1038><!--[--><!----><span data-v-6cfe1038>博客</span><!----><!--]--></a><!--]--><!--[--><a class="vp-link link navbar-menu-link" href="/JinBlog/fzu_cs_course/" tabindex="0" data-v-098c5d7d data-v-6cfe1038><!--[--><!----><span data-v-6cfe1038>FZU CS课程</span><!----><!--]--></a><!--]--><!--[--><a class="vp-link link navbar-menu-link" href="/JinBlog/dl_llm/vllm-anatomy/" tabindex="0" data-v-098c5d7d data-v-6cfe1038><!--[--><!----><span data-v-6cfe1038>DL-LLM</span><!----><!--]--></a><!--]--><!--[--><a class="vp-link link navbar-menu-link" href="/JinBlog/csdiy/10-414/" tabindex="0" data-v-098c5d7d data-v-6cfe1038><!--[--><!----><span data-v-6cfe1038>CSDIY公开课</span><!----><!--]--></a><!--]--><!--[--><a class="vp-link link navbar-menu-link" href="/JinBlog/tools/linux-install/" tabindex="0" data-v-098c5d7d data-v-6cfe1038><!--[--><!----><span data-v-6cfe1038>工具分享</span><!----><!--]--></a><!--]--><!--]--></nav><!--[--><!--]--><!----><div class="vp-navbar-appearance appearance" data-v-43d9cf9e data-v-e59180ad><button class="vp-switch vp-switch-appearance" type="button" role="switch" title aria-checked="false" data-v-e59180ad data-v-3baa2a62 data-v-4dd2fff8><span class="check" data-v-4dd2fff8><span class="icon" data-v-4dd2fff8><!--[--><span class="vpi-sun sun" data-v-3baa2a62></span><span class="vpi-moon moon" data-v-3baa2a62></span><!--]--></span></span></button></div><div class="vp-social-links vp-navbar-social-links social-links" data-v-43d9cf9e data-v-967cd3fa data-v-4bcc4c24><!--[--><a class="vp-social-link no-icon" href="https://github.com/yJader/JinBlog" aria-label="github" target="_blank" rel="noopener" data-v-4bcc4c24 data-v-961e560d><span class="vpi-social-github" /></a><!--]--></div><div class="vp-flyout vp-navbar-extra extra" data-v-43d9cf9e data-v-3d0b13b6 data-v-d83556c7><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-d83556c7><span class="vpi-more-horizontal icon" data-v-d83556c7></span></button><div class="menu" data-v-d83556c7><div class="vp-menu" data-v-d83556c7 data-v-77899dba><!----><!--[--><!--[--><!----><div class="group" data-v-3d0b13b6><div class="item appearance" data-v-3d0b13b6><p class="label" data-v-3d0b13b6>外观</p><div class="appearance-action" data-v-3d0b13b6><button class="vp-switch vp-switch-appearance" type="button" role="switch" title aria-checked="false" data-v-3d0b13b6 data-v-3baa2a62 data-v-4dd2fff8><span class="check" data-v-4dd2fff8><span class="icon" data-v-4dd2fff8><!--[--><span class="vpi-sun sun" data-v-3baa2a62></span><span class="vpi-moon moon" data-v-3baa2a62></span><!--]--></span></span></button></div></div></div><div class="group" data-v-3d0b13b6><div class="item social-links" data-v-3d0b13b6><div class="vp-social-links social-links-list" data-v-3d0b13b6 data-v-4bcc4c24><!--[--><a class="vp-social-link no-icon" href="https://github.com/yJader/JinBlog" aria-label="github" target="_blank" rel="noopener" data-v-4bcc4c24 data-v-961e560d><span class="vpi-social-github" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="vp-navbar-hamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="nav-screen" data-v-43d9cf9e data-v-6c75f11b><span class="container" data-v-6c75f11b><span class="top" data-v-6c75f11b></span><span class="middle" data-v-6c75f11b></span><span class="bottom" data-v-6c75f11b></span></span></button></div></div></div></div><div class="divider" data-v-43d9cf9e><div class="divider-line" data-v-43d9cf9e></div></div></div><!----></header><div class="vp-local-nav reached-top" data-v-6fcf39b7 data-v-9d9c2ce3><button class="menu" aria-expanded="false" aria-controls="SidebarNav" data-v-9d9c2ce3><span class="vpi-align-left menu-icon" data-v-9d9c2ce3></span><span class="menu-text" data-v-9d9c2ce3>Menu</span></button><div class="vp-local-nav-outline-dropdown" style="--vp-vh:0px;" data-v-9d9c2ce3 data-v-f64fbe72><!----><!----></div></div><aside class="vp-sidebar" vp-sidebar data-v-6fcf39b7 data-v-f3fda0df><div class="curtain" data-v-f3fda0df></div><nav id="SidebarNav" class="nav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-f3fda0df><span id="sidebar-aria-label" class="visually-hidden" data-v-f3fda0df> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-87fea307><section class="vp-sidebar-item sidebar-item level-0" data-v-87fea307 data-v-23b58e2e><!----><div data-v-23b58e2e data-v-23b58e2e><div class="items" data-v-23b58e2e><!--[--><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-23b58e2e data-v-23b58e2e><div class="item" data-v-23b58e2e><div class="indicator" data-v-23b58e2e></div><!----><a class="vp-link link link" href="/JinBlog/fzu_cs_course/" data-v-23b58e2e><!--[--><p class="text" data-v-23b58e2e><span data-v-23b58e2e>课程总览</span><!----></p><!--]--></a><!----></div><!----></div><!--]--></div></div></section></div><div class="no-transition group" data-v-87fea307><section class="vp-sidebar-item sidebar-item level-0 collapsible collapsed" data-v-87fea307 data-v-23b58e2e><div class="item" role="button" tabindex="0" data-v-23b58e2e><div class="indicator" data-v-23b58e2e></div><!----><h2 class="text" data-v-23b58e2e><span data-v-23b58e2e>数字电路与逻辑设计</span><!----></h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-23b58e2e><span class="vpi-chevron-right caret-icon" data-v-23b58e2e></span></div></div><div style="display:none;" data-v-23b58e2e data-v-23b58e2e><div class="items" data-v-23b58e2e><!--[--><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-23b58e2e data-v-23b58e2e><div class="item" data-v-23b58e2e><div class="indicator" data-v-23b58e2e></div><!----><a class="vp-link link link" href="/JinBlog/fzu_cs_course/digital-logic/review/" data-v-23b58e2e><!--[--><p class="text" data-v-23b58e2e><span data-v-23b58e2e>复习纲要</span><!----></p><!--]--></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-23b58e2e data-v-23b58e2e><div class="item" data-v-23b58e2e><div class="indicator" data-v-23b58e2e></div><!----><a class="vp-link link link" href="/JinBlog/fzu_cs_course/digital-logic/" data-v-23b58e2e><!--[--><p class="text" data-v-23b58e2e><span data-v-23b58e2e>数字电路与逻辑设计</span><!----></p><!--]--></a><!----></div><!----></div><!--]--></div></div></section></div><div class="no-transition group" data-v-87fea307><section class="vp-sidebar-item sidebar-item level-0" data-v-87fea307 data-v-23b58e2e><!----><div data-v-23b58e2e data-v-23b58e2e><div class="items" data-v-23b58e2e><!--[--><div class="vp-sidebar-item sidebar-item level-1 collapsible collapsed is-link" data-v-23b58e2e data-v-23b58e2e><div class="item" data-v-23b58e2e><div class="indicator" data-v-23b58e2e></div><!----><a class="vp-link link link" href="/JinBlog/fzu_cs_course/discrete-math/" data-v-23b58e2e><!--[--><p class="text" data-v-23b58e2e><span data-v-23b58e2e>离散数学</span><!----></p><!--]--></a><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-23b58e2e><span class="vpi-chevron-right caret-icon" data-v-23b58e2e></span></div></div><!----></div><!--]--></div></div></section></div><div class="no-transition group" data-v-87fea307><section class="vp-sidebar-item sidebar-item level-0 collapsible collapsed" data-v-87fea307 data-v-23b58e2e><div class="item" role="button" tabindex="0" data-v-23b58e2e><div class="indicator" data-v-23b58e2e></div><!----><h2 class="text" data-v-23b58e2e><span data-v-23b58e2e>数据结构</span><!----></h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-23b58e2e><span class="vpi-chevron-right caret-icon" data-v-23b58e2e></span></div></div><div style="display:none;" data-v-23b58e2e data-v-23b58e2e><div class="items" data-v-23b58e2e><!--[--><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-23b58e2e data-v-23b58e2e><div class="item" data-v-23b58e2e><div class="indicator" data-v-23b58e2e></div><!----><a class="vp-link link link" href="/JinBlog/fzu_cs_course/data-structures/" data-v-23b58e2e><!--[--><p class="text" data-v-23b58e2e><span data-v-23b58e2e>数据结构</span><!----></p><!--]--></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-23b58e2e data-v-23b58e2e><div class="item" data-v-23b58e2e><div class="indicator" data-v-23b58e2e></div><!----><a class="vp-link link link" href="/JinBlog/fzu_cs_course/data-structures/exam-material/" data-v-23b58e2e><!--[--><p class="text" data-v-23b58e2e><span data-v-23b58e2e>数据结构考试材料</span><!----></p><!--]--></a><!----></div><!----></div><!--]--></div></div></section></div><div class="no-transition group" data-v-87fea307><section class="vp-sidebar-item sidebar-item level-0 collapsible collapsed" data-v-87fea307 data-v-23b58e2e><div class="item" role="button" tabindex="0" data-v-23b58e2e><div class="indicator" data-v-23b58e2e></div><!----><h2 class="text" data-v-23b58e2e><span data-v-23b58e2e>计算机组成原理</span><!----></h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-23b58e2e><span class="vpi-chevron-right caret-icon" data-v-23b58e2e></span></div></div><div style="display:none;" data-v-23b58e2e data-v-23b58e2e><div class="items" data-v-23b58e2e><!--[--><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-23b58e2e data-v-23b58e2e><div class="item" data-v-23b58e2e><div class="indicator" data-v-23b58e2e></div><!----><a class="vp-link link link" href="/JinBlog/fzu_cs_course/computer-organization/" data-v-23b58e2e><!--[--><p class="text" data-v-23b58e2e><span data-v-23b58e2e>计算机组成原理</span><!----></p><!--]--></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-23b58e2e data-v-23b58e2e><div class="item" data-v-23b58e2e><div class="indicator" data-v-23b58e2e></div><!----><a class="vp-link link link" href="/JinBlog/fzu_cs_course/computer-organization/exam-points/" data-v-23b58e2e><!--[--><p class="text" data-v-23b58e2e><span data-v-23b58e2e>计算机组成原理考点</span><!----></p><!--]--></a><!----></div><!----></div><!--]--></div></div></section></div><div class="no-transition group" data-v-87fea307><section class="vp-sidebar-item sidebar-item level-0 collapsible has-active" data-v-87fea307 data-v-23b58e2e><div class="item" role="button" tabindex="0" data-v-23b58e2e><div class="indicator" data-v-23b58e2e></div><!----><h2 class="text" data-v-23b58e2e><span data-v-23b58e2e>计算机网络</span><!----></h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-23b58e2e><span class="vpi-chevron-right caret-icon" data-v-23b58e2e></span></div></div><div data-v-23b58e2e data-v-23b58e2e><div class="items" data-v-23b58e2e><!--[--><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-23b58e2e data-v-23b58e2e><div class="item" data-v-23b58e2e><div class="indicator" data-v-23b58e2e></div><!----><a class="vp-link link link" href="/JinBlog/fzu_cs_course/computer-networks/exercises/" data-v-23b58e2e><!--[--><p class="text" data-v-23b58e2e><span data-v-23b58e2e>计算机网络 课后题</span><!----></p><!--]--></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-23b58e2e data-v-23b58e2e><div class="item" data-v-23b58e2e><div class="indicator" data-v-23b58e2e></div><!----><a class="vp-link link link" href="/JinBlog/fzu_cs_course/computer-networks/" data-v-23b58e2e><!--[--><p class="text" data-v-23b58e2e><span data-v-23b58e2e>计算机网络</span><!----></p><!--]--></a><!----></div><!----></div><!--]--></div></div></section></div><div class="no-transition group" data-v-87fea307><section class="vp-sidebar-item sidebar-item level-0 collapsible collapsed" data-v-87fea307 data-v-23b58e2e><div class="item" role="button" tabindex="0" data-v-23b58e2e><div class="indicator" data-v-23b58e2e></div><!----><h2 class="text" data-v-23b58e2e><span data-v-23b58e2e>操作系统</span><!----></h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-23b58e2e><span class="vpi-chevron-right caret-icon" data-v-23b58e2e></span></div></div><div style="display:none;" data-v-23b58e2e data-v-23b58e2e><div class="items" data-v-23b58e2e><!--[--><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-23b58e2e data-v-23b58e2e><div class="item" data-v-23b58e2e><div class="indicator" data-v-23b58e2e></div><!----><a class="vp-link link link" href="/JinBlog/fzu_cs_course/operating-systems/nju/" data-v-23b58e2e><!--[--><p class="text" data-v-23b58e2e><span data-v-23b58e2e>NJU操作系统</span><!----></p><!--]--></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-23b58e2e data-v-23b58e2e><div class="item" data-v-23b58e2e><div class="indicator" data-v-23b58e2e></div><!----><a class="vp-link link link" href="/JinBlog/fzu_cs_course/operating-systems/" data-v-23b58e2e><!--[--><p class="text" data-v-23b58e2e><span data-v-23b58e2e>操作系统</span><!----></p><!--]--></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-23b58e2e data-v-23b58e2e><div class="item" data-v-23b58e2e><div class="indicator" data-v-23b58e2e></div><!----><a class="vp-link link link" href="/JinBlog/fzu_cs_course/operating-systems/short-answers/" data-v-23b58e2e><!--[--><p class="text" data-v-23b58e2e><span data-v-23b58e2e>简答题 MDver</span><!----></p><!--]--></a><!----></div><!----></div><!--]--></div></div></section></div><div class="no-transition group" data-v-87fea307><section class="vp-sidebar-item sidebar-item level-0 collapsible collapsed" data-v-87fea307 data-v-23b58e2e><div class="item" role="button" tabindex="0" data-v-23b58e2e><div class="indicator" data-v-23b58e2e></div><!----><h2 class="text" data-v-23b58e2e><span data-v-23b58e2e>软件工程</span><!----></h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-23b58e2e><span class="vpi-chevron-right caret-icon" data-v-23b58e2e></span></div></div><div style="display:none;" data-v-23b58e2e data-v-23b58e2e><div class="items" data-v-23b58e2e><!--[--><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-23b58e2e data-v-23b58e2e><div class="item" data-v-23b58e2e><div class="indicator" data-v-23b58e2e></div><!----><a class="vp-link link link" href="/JinBlog/fzu_cs_course/software-engineering/summary/" data-v-23b58e2e><!--[--><p class="text" data-v-23b58e2e><span data-v-23b58e2e>一些整理</span><!----></p><!--]--></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-23b58e2e data-v-23b58e2e><div class="item" data-v-23b58e2e><div class="indicator" data-v-23b58e2e></div><!----><a class="vp-link link link" href="/JinBlog/fzu_cs_course/software-engineering/" data-v-23b58e2e><!--[--><p class="text" data-v-23b58e2e><span data-v-23b58e2e>软件工程</span><!----></p><!--]--></a><!----></div><!----></div><!--]--></div></div></section></div><div class="no-transition group" data-v-87fea307><section class="vp-sidebar-item sidebar-item level-0 collapsible collapsed" data-v-87fea307 data-v-23b58e2e><div class="item" role="button" tabindex="0" data-v-23b58e2e><div class="indicator" data-v-23b58e2e></div><!----><h2 class="text" data-v-23b58e2e><span data-v-23b58e2e>数据库系统原理</span><!----></h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-23b58e2e><span class="vpi-chevron-right caret-icon" data-v-23b58e2e></span></div></div><div style="display:none;" data-v-23b58e2e data-v-23b58e2e><div class="items" data-v-23b58e2e><!--[--><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-23b58e2e data-v-23b58e2e><div class="item" data-v-23b58e2e><div class="indicator" data-v-23b58e2e></div><!----><a class="vp-link link link" href="/JinBlog/fzu_cs_course/databases/short-answers/" data-v-23b58e2e><!--[--><p class="text" data-v-23b58e2e><span data-v-23b58e2e>数据库简答题</span><!----></p><!--]--></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-23b58e2e data-v-23b58e2e><div class="item" data-v-23b58e2e><div class="indicator" data-v-23b58e2e></div><!----><a class="vp-link link link" href="/JinBlog/fzu_cs_course/databases/" data-v-23b58e2e><!--[--><p class="text" data-v-23b58e2e><span data-v-23b58e2e>数据库系统原理</span><!----></p><!--]--></a><!----></div><!----></div><!--]--></div></div></section></div><div class="no-transition group" data-v-87fea307><section class="vp-sidebar-item sidebar-item level-0" data-v-87fea307 data-v-23b58e2e><!----><div data-v-23b58e2e data-v-23b58e2e><div class="items" data-v-23b58e2e><!--[--><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-23b58e2e data-v-23b58e2e><div class="item" data-v-23b58e2e><div class="indicator" data-v-23b58e2e></div><!----><a class="vp-link link link" href="/JinBlog/fzu_cs_course/graphics/" data-v-23b58e2e><!--[--><p class="text" data-v-23b58e2e><span data-v-23b58e2e>计算机图形学</span><!----></p><!--]--></a><!----></div><!----></div><!--]--></div></div></section></div><div class="no-transition group" data-v-87fea307><section class="vp-sidebar-item sidebar-item level-0 collapsible collapsed" data-v-87fea307 data-v-23b58e2e><div class="item" role="button" tabindex="0" data-v-23b58e2e><div class="indicator" data-v-23b58e2e></div><!----><h2 class="text" data-v-23b58e2e><span data-v-23b58e2e>汇编 & 接口</span><!----></h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-23b58e2e><span class="vpi-chevron-right caret-icon" data-v-23b58e2e></span></div></div><div style="display:none;" data-v-23b58e2e data-v-23b58e2e><div class="items" data-v-23b58e2e><!--[--><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-23b58e2e data-v-23b58e2e><div class="item" data-v-23b58e2e><div class="indicator" data-v-23b58e2e></div><!----><a class="vp-link link link" href="/JinBlog/fzu_cs_course/assembly-and-interfaces/" data-v-23b58e2e><!--[--><p class="text" data-v-23b58e2e><span data-v-23b58e2e>汇编 & 接口</span><!----></p><!--]--></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-23b58e2e data-v-23b58e2e><div class="item" data-v-23b58e2e><div class="indicator" data-v-23b58e2e></div><!----><a class="vp-link link link" href="/JinBlog/fzu_cs_course/assembly/template/" data-v-23b58e2e><!--[--><p class="text" data-v-23b58e2e><span data-v-23b58e2e>汇编模板</span><!----></p><!--]--></a><!----></div><!----></div><!--]--></div></div></section></div><div class="no-transition group" data-v-87fea307><section class="vp-sidebar-item sidebar-item level-0" data-v-87fea307 data-v-23b58e2e><!----><div data-v-23b58e2e data-v-23b58e2e><div class="items" data-v-23b58e2e><!--[--><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-23b58e2e data-v-23b58e2e><div class="item" data-v-23b58e2e><div class="indicator" data-v-23b58e2e></div><!----><a class="vp-link link link" href="/JinBlog/fzu_cs_course/lab-practice/bearpi/" data-v-23b58e2e><!--[--><p class="text" data-v-23b58e2e><span data-v-23b58e2e>劳动实践 (BearPi)</span><!----></p><!--]--></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-23b58e2e data-v-23b58e2e><div class="item" data-v-23b58e2e><div class="indicator" data-v-23b58e2e></div><!----><a class="vp-link link link" href="/JinBlog/fzu_cs_course/data-mining/" data-v-23b58e2e><!--[--><p class="text" data-v-23b58e2e><span data-v-23b58e2e>数据挖掘</span><!----></p><!--]--></a><!----></div><!----></div><!--]--></div></div></section></div><div class="no-transition group" data-v-87fea307><section class="vp-sidebar-item sidebar-item level-0 collapsible collapsed is-link" data-v-87fea307 data-v-23b58e2e><div class="item" tabindex="0" data-v-23b58e2e><div class="indicator" data-v-23b58e2e></div><!----><a class="vp-link link link" href="/JinBlog/fzu_cs_course/computer-system-architecture/" data-v-23b58e2e><!--[--><h2 class="text" data-v-23b58e2e><span data-v-23b58e2e>计算机系统结构</span><!----></h2><!--]--></a><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-23b58e2e><span class="vpi-chevron-right caret-icon" data-v-23b58e2e></span></div></div><div style="display:none;" data-v-23b58e2e data-v-23b58e2e><div class="items" data-v-23b58e2e><!--[--><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-23b58e2e data-v-23b58e2e><div class="item" data-v-23b58e2e><div class="indicator" data-v-23b58e2e></div><!----><a class="vp-link link link" href="/JinBlog/fzu_cs_course/computer-system-architecture/overview/" data-v-23b58e2e><!--[--><p class="text" data-v-23b58e2e><span data-v-23b58e2e>课程笔记</span><!----></p><!--]--></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-23b58e2e data-v-23b58e2e><div class="item" data-v-23b58e2e><div class="indicator" data-v-23b58e2e></div><!----><a class="vp-link link link" href="/JinBlog/fzu_cs_course/computer-system-architecture/outline-map/" data-v-23b58e2e><!--[--><p class="text" data-v-23b58e2e><span data-v-23b58e2e>复习提纲MAP</span><!----></p><!--]--></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-23b58e2e data-v-23b58e2e><div class="item" data-v-23b58e2e><div class="indicator" data-v-23b58e2e></div><!----><a class="vp-link link link" href="/JinBlog/fzu_cs_course/computer-system-architecture/short-answers/" data-v-23b58e2e><!--[--><p class="text" data-v-23b58e2e><span data-v-23b58e2e>简答题</span><!----></p><!--]--></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-23b58e2e data-v-23b58e2e><div class="item" data-v-23b58e2e><div class="indicator" data-v-23b58e2e></div><!----><a class="vp-link link link" href="/JinBlog/fzu_cs_course/computer-system-architecture/quiz/" data-v-23b58e2e><!--[--><p class="text" data-v-23b58e2e><span data-v-23b58e2e>小测选填</span><!----></p><!--]--></a><!----></div><!----></div><!--]--></div></div></section></div><div class="no-transition group" data-v-87fea307><section class="vp-sidebar-item sidebar-item level-0" data-v-87fea307 data-v-23b58e2e><!----><div data-v-23b58e2e data-v-23b58e2e><div class="items" data-v-23b58e2e><!--[--><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-23b58e2e data-v-23b58e2e><div class="item" data-v-23b58e2e><div class="indicator" data-v-23b58e2e></div><!----><a class="vp-link link link" href="/JinBlog/fzu_cs_course/compiler-principles/" data-v-23b58e2e><!--[--><p class="text" data-v-23b58e2e><span data-v-23b58e2e>编译原理</span><!----></p><!--]--></a><!----></div><!----></div><!--]--></div></div></section></div><div class="no-transition group" data-v-87fea307><section class="vp-sidebar-item sidebar-item level-0 collapsible collapsed" data-v-87fea307 data-v-23b58e2e><div class="item" role="button" tabindex="0" data-v-23b58e2e><div class="indicator" data-v-23b58e2e></div><!----><h2 class="text" data-v-23b58e2e><span data-v-23b58e2e>计算方法 (数值分析)</span><!----></h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-23b58e2e><span class="vpi-chevron-right caret-icon" data-v-23b58e2e></span></div></div><div style="display:none;" data-v-23b58e2e data-v-23b58e2e><div class="items" data-v-23b58e2e><!--[--><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-23b58e2e data-v-23b58e2e><div class="item" data-v-23b58e2e><div class="indicator" data-v-23b58e2e></div><!----><a class="vp-link link link" href="/JinBlog/fzu_cs_course/numerical-methods/formulas/" data-v-23b58e2e><!--[--><p class="text" data-v-23b58e2e><span data-v-23b58e2e>公式整理</span><!----></p><!--]--></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-23b58e2e data-v-23b58e2e><div class="item" data-v-23b58e2e><div class="indicator" data-v-23b58e2e></div><!----><a class="vp-link link link" href="/JinBlog/fzu_cs_course/numerical-methods/" data-v-23b58e2e><!--[--><p class="text" data-v-23b58e2e><span data-v-23b58e2e>计算方法(数值分析)</span><!----></p><!--]--></a><!----></div><!----></div><!--]--></div></div></section></div><div class="no-transition group" data-v-87fea307><section class="vp-sidebar-item sidebar-item level-0 collapsible collapsed" data-v-87fea307 data-v-23b58e2e><div class="item" role="button" tabindex="0" data-v-23b58e2e><div class="indicator" data-v-23b58e2e></div><!----><h2 class="text" data-v-23b58e2e><span data-v-23b58e2e>人机交互</span><!----></h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-23b58e2e><span class="vpi-chevron-right caret-icon" data-v-23b58e2e></span></div></div><div style="display:none;" data-v-23b58e2e data-v-23b58e2e><div class="items" data-v-23b58e2e><!--[--><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-23b58e2e data-v-23b58e2e><div class="item" data-v-23b58e2e><div class="indicator" data-v-23b58e2e></div><!----><a class="vp-link link link" href="/JinBlog/fzu_cs_course/human-computer-interaction/review/" data-v-23b58e2e><!--[--><p class="text" data-v-23b58e2e><span data-v-23b58e2e>复习课件 MD Ver</span><!----></p><!--]--></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-23b58e2e data-v-23b58e2e><div class="item" data-v-23b58e2e><div class="indicator" data-v-23b58e2e></div><!----><a class="vp-link link link" href="/JinBlog/fzu_cs_course/human-computer-interaction/abridged/" data-v-23b58e2e><!--[--><p class="text" data-v-23b58e2e><span data-v-23b58e2e>人机交互复习笔记 缩减版</span><!----></p><!--]--></a><!----></div><!----></div><!--]--></div></div></section></div><div class="no-transition group" data-v-87fea307><section class="vp-sidebar-item sidebar-item level-0 collapsible collapsed" data-v-87fea307 data-v-23b58e2e><div class="item" role="button" tabindex="0" data-v-23b58e2e><div class="indicator" data-v-23b58e2e></div><!----><h2 class="text" data-v-23b58e2e><span data-v-23b58e2e>毕业设计</span><!----></h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-23b58e2e><span class="vpi-chevron-right caret-icon" data-v-23b58e2e></span></div></div><div style="display:none;" data-v-23b58e2e data-v-23b58e2e><div class="items" data-v-23b58e2e><!--[--><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-23b58e2e data-v-23b58e2e><div class="item" data-v-23b58e2e><div class="indicator" data-v-23b58e2e></div><!----><a class="vp-link link link" href="/JinBlog/fzu_cs_course/FZU-SINTEF-Beamer-Template/" data-v-23b58e2e><!--[--><p class="text" data-v-23b58e2e><span data-v-23b58e2e>FZU-SINTEF-Beamer-Template</span><!----></p><!--]--></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-23b58e2e data-v-23b58e2e><div class="item" data-v-23b58e2e><div class="indicator" data-v-23b58e2e></div><!----><a class="vp-link link link" href="/JinBlog/fzu_cs_course/FZU-Undergraduate-Thesis/" data-v-23b58e2e><!--[--><p class="text" data-v-23b58e2e><span data-v-23b58e2e>FZU-Undergraduate-Thesis</span><!----></p><!--]--></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-23b58e2e data-v-23b58e2e><div class="item" data-v-23b58e2e><div class="indicator" data-v-23b58e2e></div><!----><a class="vp-link link link" href="/JinBlog/fzu_cs_course/thesis-requirements/" data-v-23b58e2e><!--[--><p class="text" data-v-23b58e2e><span data-v-23b58e2e>毕设要求整理</span><!----></p><!--]--></a><!----></div><!----></div><!--]--></div></div></section></div><!--]--><!--[--><!--]--></nav></aside><!--[--><div id="VPContent" vp-content class="vp-content has-sidebar" data-v-6fcf39b7 data-v-743d3d68><div class="vp-doc-container has-sidebar has-aside" data-v-743d3d68 data-v-50e98be9><!--[--><!--]--><div class="container" data-v-50e98be9><div class="aside" vp-outline data-v-50e98be9><div class="aside-curtain" data-v-50e98be9></div><div class="aside-container" data-v-50e98be9><div class="aside-content" data-v-50e98be9><div class="vp-doc-aside" data-v-50e98be9 data-v-0fdc8756><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="vp-doc-aside-outline" role="navigation" data-v-0fdc8756 data-v-fe5fe191><div class="content" data-v-fe5fe191><div class="outline-marker" data-v-fe5fe191></div><div id="doc-outline-aria-label" aria-level="2" class="outline-title" role="heading" data-v-fe5fe191><span data-v-fe5fe191>此页内容</span><span class="vpi-print icon" data-v-fe5fe191></span></div><ul class="root" data-v-fe5fe191 data-v-b4b17828><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-0fdc8756></div><!--[--><!--]--></div></div></div></div><div class="content" data-v-50e98be9><div class="content-container" data-v-50e98be9><!--[--><!--]--><main class="main" data-v-50e98be9><nav class="vp-breadcrumb" data-v-50e98be9 data-v-3472e66e><ol vocab="https://schema.org/" typeof="BreadcrumbList" data-v-3472e66e><!--[--><li property="itemListElement" typeof="ListItem" data-v-3472e66e><a class="vp-link link no-icon breadcrumb" href="/JinBlog/" property="item" typeof="WebPage" data-v-3472e66e><!--[-->首页<!--]--></a><span class="vpi-chevron-right" data-v-3472e66e></span><meta property="name" content="首页" data-v-3472e66e><meta property="position" content="1" data-v-3472e66e></li><li property="itemListElement" typeof="ListItem" data-v-3472e66e><span class="vp-link no-icon breadcrumb" property="item" typeof="WebPage" data-v-3472e66e><!--[-->FZU CS课程<!--]--></span><span class="vpi-chevron-right" data-v-3472e66e></span><meta property="name" content="FZU CS课程" data-v-3472e66e><meta property="position" content="2" data-v-3472e66e></li><li property="itemListElement" typeof="ListItem" data-v-3472e66e><a class="vp-link link no-icon breadcrumb current" href="/JinBlog/fzu_cs_course/computer-networks/" property="item" typeof="WebPage" data-v-3472e66e><!--[-->计算机网络<!--]--></a><!----><meta property="name" content="计算机网络" data-v-3472e66e><meta property="position" content="3" data-v-3472e66e></li><!--]--></ol></nav><!--[--><!--]--><!--[--><div class="vp-doc-title" data-v-1b67cc8d><!--[--><!--]--><h1 class="page-title" data-v-1b67cc8d><!----> 计算机网络 <!----></h1><!--[--><!--]--></div><div class="vp-doc-meta" data-v-1b67cc8d><!--[--><!--]--><p class="reading-time" data-v-1b67cc8d><span class="vpi-books icon" data-v-1b67cc8d></span><span data-v-1b67cc8d>约 42947 字</span><span data-v-1b67cc8d>大约 143 分钟</span></p><!----><!--[--><!--]--><p class="create-time" data-v-1b67cc8d><span class="vpi-clock icon" data-v-1b67cc8d></span><span data-v-1b67cc8d>2024-06-30</span></p></div><!--]--><!--[--><!--]--><div class="_fzu_cs_course_computer-networks_ external-link-icon-enabled vp-doc plume-content" vp-content data-v-50e98be9><!--[--><!--]--><div data-v-50e98be9><blockquote><p>男大学生自用 99 新笔记</p></blockquote><h1 id="第一章-绪论" tabindex="-1"><a class="header-anchor" href="#第一章-绪论"><span>第一章 绪论</span></a></h1><h2 id="_1-1-计算机网络定义及其特点" tabindex="-1"><a class="header-anchor" href="#_1-1-计算机网络定义及其特点"><span>1.1 计算机网络定义及其特点</span></a></h2><!---->：是一个将分散的、具有独立功能的计算机系统，通过通信设备与线路(硬件)连接起来，由功能完善的软件实现资源共享和信息传递的系统。<p>计算机网络向用户提供的两个最重要的功能：</p><ul><li><!---->（连通性）：计算机网络最基本<mark>最重要</mark> 的功能。</li><li><!----></li></ul><p>**网络：**若干个节点（node）以及连接节点的链路（linker）组成，节点可以为计算机，集线器，交换机，路由器等</p><h2 id="_1-2-互联网概述" tabindex="-1"><a class="header-anchor" href="#_1-2-互联网概述"><span>1.2 互联网概述</span></a></h2><ol><li><p>互联网发展的三个阶段：</p><ul><li><p>第一阶段：从单个网络 ARPANET 向互联网发展的过程。1983 年 TCP/IP 协议成为 ARPANET 上的标准协议。</p></li><li><p>第二阶段：建成三级结构的互联网：主干网、地区网和校园网（或企业网）。</p></li><li><p>第三阶段：形成多层次的<!---->（Internet Service Provider 互联网服务提供者）结构的互联网。 分为不同层次的 ISP : 主干 ISP，地区 ISP，本地 ISP</p></li></ul></li><li><p>基于 ISP 的多层结构的互联网的概念示意图</p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/202401141758857.png" alt="image-20230223221959199" style="zoom:50%;"><ul><li><strong>正常位于不同主干 ISP 的计算机通过 ISP 过程</strong>：主机 A-&gt;本地 ISP-&gt;地区 ISP-》主干 ISP-&gt;地区 ISP-&gt;本地 ISP-&gt;主机 B</li></ul></li><li><!---->（Internet exchange Point 互联网交换点） : 允许两个网络直接连接并交换分组，不在需要通过第三个网络来交换；<ul><li>典型的 IXP 有由多个网络交换机组成: 工作在数据链路层的网络交换机，局域网连接交换机</li><li>IXP 能更快地转发分组</li></ul></li><li><p>internet 和 Internet 的区别：</p><ul><li><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>n</mi><mi>e</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">internet</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">in</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal">t</span></span></span></span>：通用名词，它泛指由多个计算机网络互连而成的网络。</p></li><li><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>n</mi><mi>e</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">Internet</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal">t</span></span></span></span>：专用名词，它指当前全球最大的、开放的、由众多网络相互连接而成的特定计算机网络，它采用 TCP/IP 协议族作为通信的规则，且其前身是美国的 ARPANET。</p></li><li><p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230619154002461.png" alt="image-20230619154002461"></p></li></ul></li><li><p>制定 Internet 的正式标准经历过程：</p><ol><li>互联网草案（Internet Draft）</li><li>建议标准（Proposed Standard） ---此阶段就成为 RFC（Request For Comments)</li><li>草案标准（Draft Standard）</li><li>互联网标准（Internet Standard）</li></ol></li></ol><h2 id="_1-3-互联网的组成-p8" tabindex="-1"><a class="header-anchor" href="#_1-3-互联网的组成-p8"><span>1.3 互联网的组成 P8</span></a></h2><ol><li><p>计算机网络的组成的分类</p><ul><li><p>从组成部分看: 一个完整的计算机网络主要由硬件, 软件, 协议组成</p></li><li><p>从<strong>工作方式</strong></p><ul><li><p><strong>边缘部分</strong>：由所有连接在互联网上的主机组成。这部分由<strong>用户直接使用</strong>，用来进行通信和资源共享。</p></li><li><p><strong>核心部分</strong>: 由大量的网络和连接这些网络的路由器组成。这部分是<strong>为边缘部分提供服务的</strong>（提供连通性和交换）</p></li></ul></li><li><p>从功能组成看: 通信子网和资源子网</p><ul><li>通信子网: 传输介质, 通信设备和相应的网络协议</li><li>资源子网: 实现资源共享功能的设备及其软件的集合</li></ul></li></ul></li><li><p><strong>计算机之间通信</strong>：不同主机之间的进程相互通信</p></li><li><p>处于边缘部分的用户通信方式 P9-P10</p><ul><li><p>客户服务器方式（C/S 方式）：即 Client/Server 方式。（客户是服务的请求方，服务器是服务的提供方）</p></li><li><p>对等方式（P2P 方式）：即 Peer-to-Peer 方式。（对等连接中的每一个主机既是客户又同时是服务器）</p></li></ul></li><li><p><strong>Internet 的核心部分</strong>：路由器（router），专用计算机，转发收到的分组。</p></li><li><p>核心部分的交换技术 P11-15</p><ul><li><p><strong>电路交换</strong>的三个阶段：建立连接——通话——释放连接<strong>在通话时，两用户之间始终占用端到端的资源</strong>，而由于绝大部分时间线路都是空闲的，所以线路的传输速率往往很低。</p></li><li><p><strong>分组交换</strong>的组成：报文、首部、分组。采用存储转发技术，即收到分组——存储分组——查询路由（路由选择协议）——转发分组。优点：高效、灵活、迅速、可靠。缺点：时延、开销。关键构件：路由器。</p></li><li><p><strong>报文交换</strong>整个报文传送到相邻结点，全部存储下来之后查询转发表，转发到下一个结点。</p></li></ul></li><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/202401141800118.png" alt="img" style="zoom:50%;"> - 电路交换︰端对端通信质量因约定了通信资源获得可靠保障，对连续传送大量数据效率高。 - 报文交换:无须预约传输带宽，动态逐段利用传输带宽对突发式数据通信效率高，通信迅速。 - 分组交换∶具有报文交换之高效、迅速的要点, 且各分组小, 路由灵活, 网络生存性能好 </li></ol><h2 id="_1-4-计算机网络的类别-p17" tabindex="-1"><a class="header-anchor" href="#_1-4-计算机网络的类别-p17"><span>1.4 计算机网络的类别 P17</span></a></h2><ul><li>按分布范围分： <ul><li>广域网（WAN Wide Area Network ）</li><li>城域网（MAN Metropolitan ）</li><li>局域网（LAN Local）</li><li>个人局域网（PAN/WPAN Wireless Personal ）</li></ul></li><li>按网络拓扑结构分：星型网、树型网、环型网、总线网</li><li>按传输带宽分：基带网、宽带网</li><li>按使用范围分：公用网、专用网</li><li>按速率分：高速网、中速网、低速网</li><li>按通信传播方式分：广播式、点到点式 <ul><li>广播式网络：共享公共通信通道</li><li>点对点网络：使用分组存储转发和路由选择机制 性能指标（P18）：速率、带宽、时延</li><li>局域网基本采用广播式网络, 广域网基本采用点对点网络</li></ul></li></ul><h2 id="_1-5-计算机网络的性能指标" tabindex="-1"><a class="header-anchor" href="#_1-5-计算机网络的性能指标"><span>1.5 计算机网络的性能指标</span></a></h2><ol><li><!---->(data rate/bit rate)：指连接在计算机网络上的主机在数字信道上传送数据的速率<ul><li><p>也称 数据传输速率, 数据率, 比特率</p></li><li><p>单位: <code>比特/秒</code>, <code>b/s</code>（<code>bps</code>）</p></li><li><p>如 100M 以太网，实际是指 100Mb/s。往往是指额定速率或标称速率</p></li></ul></li><li><!---->(bandwidth)：数字信道所能传送的<strong>最高速率</strong><ul><li>单位: <code>比特/秒</code>, <code>b/s</code>（<code>bps</code>）</li><li>原本表示通信线路允许通过的信号频带范围(频带宽度)</li></ul></li><li><!---->(throughput)：单位时间内通过某个网络（或信道、接口）的<strong>实际数据量</strong>。其绝对上限值等于带宽。</li><li><!---->(delay/latency)：数据（一个报文或分组、甚至比特）从网络（或链路）的一段传送到另一端的时间，也称延迟。<ol><li><!---->：主机或路由器发送数据帧所需的时间，也就是从发送数据帧的第一个比特算起，到该帧的最后一个比特发送完毕所需的时间。也成传输时延。<ul><li>$发送时延 = 数据帧长度(b)\ (分组长度,数据总量)\ /\ 信道带宽 (b/s) $</li></ul></li><li><!---->：电磁波在信道中传输一定距离所需划分的时间<ul><li>$传播时延 = 信道长度(m) / 传播速率(m/s) $</li></ul></li><li><!---->：主机或路由器处理收到的分组所花费的时间。包括分析分组首部，提取分组数据部分，差错检测，查找路由等</li><li><!---->：分组在输入队列中等待处理的时间加上其在输出队列中等待转发的时间。分组转发的时候，经过诸多路由器确定转发接口后，还要在输出队列中排队等待转发，即排队时延</li><li>综上：<code>总时延 = 发送时延 + 传播时延 + 处理时延 + 排队时延</code><ul><li>注：对于高速网络链路，提高的是<strong>发送速率</strong>而不是传播速率</li></ul></li></ol></li></ol><ul><li><!---->：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>时延带宽积</mtext><mo>=</mo><mtext>传播时延</mtext><mo>∗</mo><mtext>带宽</mtext></mrow><annotation encoding="application/x-tex">时延带宽积 = 传播时延 * 带宽</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">时延带宽积</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">传播时延</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">带宽</span></span></span></span>。表示链路的容量。</li><li><!---->(Round-Trip Time)：从发送方发送数据开始，到发送发收到接收方的确认为止，所花费的时间。</li><li><!---->：某信道有百分之几是被利用的（有数据通过）<ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>信道利用率</mtext><mo>=</mo><mtext>有数据通过时间</mtext><mi mathvariant="normal">/</mi><mo stretchy="false">(</mo><mtext>有</mtext><mo>+</mo><mtext>无</mtext><mo stretchy="false">)</mo><mtext>数据通过时间</mtext></mrow><annotation encoding="application/x-tex">信道利用率 = 有数据通过时间 / (有+无)数据通过时间</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">信道利用率</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord cjk_fallback">有数据通过时间</span><span class="mord">/</span><span class="mopen">(</span><span class="mord cjk_fallback">有</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord cjk_fallback">无</span><span class="mclose">)</span><span class="mord cjk_fallback">数据通过时间</span></span></span></span></li><li><!----> : 全网络的信道利用率的加权平均值</li><li>信道或网络利用率过高会产生非常大的时延, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>当前时延</mtext><mo>=</mo><mtext>网络空闲的时延</mtext><mi mathvariant="normal">/</mi><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mtext>网络利用率</mtext><mo stretchy="false">)</mo><mtext> </mtext><mo separator="true">,</mo><mtext>即</mtext><mi>D</mi><mo>=</mo><mfrac><msub><mi>D</mi><mn>0</mn></msub><mrow><mn>1</mn><mo>−</mo><mi>U</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">当前时延 = 网络空闲的时延/(1-网络利用率)\ ,即 D = \frac{D_0}{1-U}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">当前时延</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord cjk_fallback">网络空闲的时延</span><span class="mord">/</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord cjk_fallback">网络利用率</span><span class="mclose">)</span><span class="mspace"> </span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord cjk_fallback">即</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2918em;vertical-align:-0.4033em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8884em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">U</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4101em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.0278em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4033em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></li></ul></li></ul><h2 id="_1-6-计算机网络的体系结构-p25" tabindex="-1"><a class="header-anchor" href="#_1-6-计算机网络的体系结构-p25"><span>1.6 计算机网络的体系结构 P25</span></a></h2><ol><li><!---->：简称协议，是为了进行网络中的数据交换而建立的规则、标准或约定，是控制两个对等实体进行通信的规则的集合。在协议的控制下，两个对等实体间的通信使得本层能够向上一层提供服务，而要实现本层协议，还需要使用下一层提供的服务。</li><li><p>网络协议的三要素</p><ul><li><!---->：传输数据的格式</li><li><!---->：规定了所要完成的功能 (比如, 需要发出何种控制信息，完成何种动作以及做出何种响应)</li><li><!---->：各种操作的条件, 操作顺序的详细说明</li></ul></li><li><p>几个概念</p><ul><li><!---->：第 n 层的活动元素称为 n 层实体。同一层的实体叫<!---->。</li><li><!---->：上层使用下层服务的入口</li><li><!---->：下层为相邻上层提供的功能调用。</li><li><!---->(architecture)简称<!---->，是计算机网络的各层及其协议的集合。</li></ul></li><li><p>7 层<!---->：</p><ul><li><p>物理层、数据链路层、网络层：提供<strong>点到点</strong>的服务</p></li><li><p>传输层、会话层、表示层、应用层：提供<strong>端到端</strong>的服务</p></li><li><p>低三层(物理层、数据链路层、网络层)统称为<strong>资源子网</strong>, 为联网附加的通信设备, 完成数据的传输功能</p></li><li><p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/202401141759623.png" alt="img"></p></li></ul></li><li><p>4 层<strong>TCP/IP 参考模型</strong>：网络接口层、网际层 IP、运输层、应用层</p><p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/202401141800553.png" alt="img"></p><ul><li><p>TCP/IP 设计之初就考虑到异构网互联问题，将 IP 作为重要层次；而 OSI 参考模型先于协议发明，不偏向特定协议。</p></li><li><p>两者常考的异同点：</p><ul><li>OSI 参考模型<strong>网络层</strong>是「无连接+面向连接」，而 TCP/IP 模型是「无连接」的；</li><li>OSI 参考模型<strong>传输层</strong>是「面向连接」，而 TCP/IP 模型是「无连接+面向连接」。</li></ul></li><li><p>广泛应用, 成为了事实上的国际标准</p></li></ul></li><li><p>五层协议的体系结构（综合了 OSI 和 TCP/IP 的优点）</p><ol><li><!---->：物理层的任务就是透明地传送比特流。<ul><li>注意：传递信息的物理媒体，如双绞线、同轴电缆、光缆等，是在物理层的下面，当做第 0 层。</li><li>物理层还要确定连接电缆插头的定义及连接法。</li><li>数据单位：<code>比特</code></li></ul><ol start="2"><li><!---->：将网络层交下来的 IP 数据报组装成帧，在两个相邻结点间的链路上”透明“的传送数据。<ul><li><p>每一帧包括数据和必要的控制信息（同步信息、地址信息、差错控制等）。</p></li><li><p>数据单位：<code>帧</code></p></li></ul></li></ol></li><li><!---->：为分组交换网上的不同主机提供通信服务。选择合适的路由，使源主机运输层所传下来的分组能通过网络中的路由器找到目的主机。<ul><li>数据单位：<code>分组（IP数据报/数据报）</code></li></ul></li><li><!---->：向两个主机中进程间的通信提供通用的数据传输服务。<ul><li><!---->（Transmission control Protocol）: 提供面向连接的，可靠的数据传输服务。 数据单位：<code>报文段</code><ul><li><!---->（User Datagram Protocol）: 提供无连接的，尽最大努力的数据传输服务。 数据单位：<code>用户数据报</code></li></ul></li></ul></li><li><!---->：直接为用户的应用进程提供服务(HTTP、FTP 等),通过应用进程间的交互来完成特定网络应用<ul><li>数据单元:报文。</li></ul></li></ol><ul><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/202401141800541.jpg" alt="img"><!---->（Protocol Data Unit)协议数据单元，对等层次之间传送的数据单元。</li></ul><ol start="2"><li><p>一些概念</p><ul><li><!---->：任何可发送或接受信息的硬件或软件进程。</li><li><!---->：控制对等实体间通信的规则集合。在协议控制下，两个对等实体间通信使得本层能够向上一层提供服务。实现本层协议，还需要使用下面一层提供的服务。</li><li><!---->：有下层向上层提供层间接口提供的。只有那些能被上一层实体“看得见”的功能，才能称之为服务。<ul><li>使用本层服务的实体只能看见服务而无法下面的协议。即下面的协议对上面的实体使透明的。</li></ul></li><li><!---->（Service Access Point）：同一系统中相邻两层的实体进行交互的地方（抽象概念）</li><li><!---->（Service Data Unit）：层与层之间交换的数据的单位。</li></ul></li></ol></li></ol><h1 id="第二章-应用层" tabindex="-1"><a class="header-anchor" href="#第二章-应用层"><span>第二章 应用层</span></a></h1><ol><li>网络应用的原理与实现 <ul><li>应用层所需的网络服务</li><li>客户和服务器</li><li>进程和传输层接</li><li>创建网络应用程序</li><li>套接字接口</li></ul></li><li>通过观察流行的网络应用，学习相关协议 <ul><li>Web:HTTP</li><li>电子邮件:SMTP/POP3 /IMAP</li><li>域名解析:DNS</li><li>对等文件分发:P2P</li><li>地址分配:DHCP(网络层)</li></ul></li></ol><h2 id="_2-1-应用层协议原理" tabindex="-1"><a class="header-anchor" href="#_2-1-应用层协议原理"><span>2.1 应用层协议原理</span></a></h2><blockquote><p><strong>Principles of network applications</strong></p></blockquote><h3 id="_2-1-1-网络应用程序体系结构" tabindex="-1"><a class="header-anchor" href="#_2-1-1-网络应用程序体系结构"><span>2.1.1 网络应用程序体系结构</span></a></h3><blockquote><p>Network application structure</p></blockquote><p>**应用程序体系结构（application architecture）**由应用程序研发者设计，规定了如何在各种端系统上组织该应用程序。现代网络应用程序中所使用的两种主流体系结构：</p><h4 id="一-客户-服务器体系结构" tabindex="-1"><a class="header-anchor" href="#一-客户-服务器体系结构"><span>一. 客户-服务器体系结构</span></a></h4><blockquote><p>Client-server architecture</p></blockquote><ol><li><p>Server 服务器</p><ul><li>总是在线（always on host） <ol><li>永久的 IP 地址（permanent IP address）</li><li>配置在数据中心（often in data centers）</li></ol></li></ul></li><li><p>Client 客户机</p><ul><li>只与服务器通信 5. 可以间歇性（intermittently）地连接服务器 5. 可以拥有动态地址 5. 客户之间不直接联系</li></ul></li><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/4179e1fb72104f6b8674acc015337f96.png" alt="img" style="zoom:50%;"></li></ol><h4 id="二-p2p-体系结构" tabindex="-1"><a class="header-anchor" href="#二-p2p-体系结构"><span>二. P2P 体系结构</span></a></h4><blockquote><p>Peer-peer architecture</p></blockquote><ul><li><p>没有一直在线的服务器</p></li><li><p>端与端之间直接进行连接</p></li><li><p><strong>自拓展性（self-scalability）</strong>，每个对等方通过向其他对等方分发文件为系统提供服务能力</p></li><li><p>对等方可间歇性的被连接并且可以改变 IP 地址；</p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/1c8050ca1ce546e9a92c36693793f568.png" alt="img" style="zoom:50%;"></li></ul><h3 id="_2-1-2-进程通信" tabindex="-1"><a class="header-anchor" href="#_2-1-2-进程通信"><span>2.1.2 进程通信</span></a></h3><blockquote><p>Process communicating</p></blockquote><p>用操作系统的术语来说，进行通信的实际上是**进程（process）<strong>而不是程序；在两个不同端系统上的进程，通过跨越计算机网络交换</strong>报文（message）**而相互通信。</p><h4 id="一-客户和服务器进程" tabindex="-1"><a class="header-anchor" href="#一-客户和服务器进程"><span>一. 客户和服务器进程</span></a></h4><ul><li>客户进程：发起通信的进程</li><li>服务进程：在会话开始时等待联系的进程；</li></ul><h4 id="二-进程与计算机网络之间的接口" tabindex="-1"><a class="header-anchor" href="#二-进程与计算机网络之间的接口"><span>二. 进程与计算机网络之间的接口</span></a></h4><blockquote><p>Socket</p></blockquote><p>进程通过一个称为<!---->的软件接口向网络发送报文和从网络接受报文。</p><ul><li><!----></li></ul><p>由于该套接字是建立网络应用的可编程接口，因此套接字被称为应用程序和网络之间的<strong>应用程序编程接口（Application Programming Interface，API）</strong></p><p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/ce785a031f0d49de9efa8fb54328cb80.png" alt="img"></p><h4 id="三-进程寻址" tabindex="-1"><a class="header-anchor" href="#三-进程寻址"><span>三. 进程寻址</span></a></h4><blockquote><p>Addressing processes</p></blockquote><ul><li>主机地址 👉 <strong>IP 地址（IP address）</strong></li><li>目的主机指定<strong>接受进程</strong>的标识符 👉 目的地<strong>端口号（port number）</strong></li></ul><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/0563e9cb6e8c493797da69b10222f75f.png" alt="img" style="zoom:50%;"><h3 id="_2-1-3-可供应用程序使用的运输服务" tabindex="-1"><a class="header-anchor" href="#_2-1-3-可供应用程序使用的运输服务"><span>2.1.3 可供应用程序使用的运输服务</span></a></h3><blockquote><p>Transport service used in application</p></blockquote><ol><li><p><strong>可靠数据传输（reliable data transfer）</strong></p><ul><li>一些应用需要 100%可靠数据传输</li><li>一些应用允许丢包（loss）；</li></ul></li><li><p><strong>吞吐量（Throughout）</strong></p><ul><li>具有吞吐量要求是应用程序被称为<strong>带宽敏感的应用（bandwidth-sensitive application）</strong></li><li><strong>弹性应用（elastic application）</strong> 能够根据当时可用的带宽或多或少地利用可供使用的吞吐量</li></ul></li><li><p><strong>定时（Timing）</strong></p><ul><li><strong>低延时（low delay）</strong> 要求；</li></ul></li><li><p><strong>安全（Security）</strong></p><ul><li>加密技术（encryption）、数据完整性（data integrity）</li></ul></li></ol><h3 id="_2-1-4-因特网提供的运输服务" tabindex="-1"><a class="header-anchor" href="#_2-1-4-因特网提供的运输服务"><span>2.1.4 因特网提供的运输服务</span></a></h3><blockquote><p>Transport protocols services</p></blockquote><h4 id="一-tcp-服务" tabindex="-1"><a class="header-anchor" href="#一-tcp-服务"><span>一. TCP 服务</span></a></h4><ul><li>面向连接的服务（connection-oriented）：报文开始流动之前，TCP 让客户和服务器互相交换运输层控制信息（握手阶段），握手阶段后，一条 TCP 连接（TCP connection）就在两条进程的套接字之间建立</li><li>可靠的数据传送服务（reliable transport）：无差别、按适当顺序交付所有发送的数据</li><li>拥塞控制机制（congestion control）</li></ul><h4 id="二-tcp-安全" tabindex="-1"><a class="header-anchor" href="#二-tcp-安全"><span>二. TCP 安全</span></a></h4><ol><li><p><strong>安全套接字层（Secure Sockets Layer，SSL）</strong> 提供了关键的进程到进程的安全性服务。</p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/b789cf532caf4fbe8ae38c9b33785184.png" alt="img" style="zoom:50%;"><ul><li>我们平时上网冲浪时，网址前面的 http 与 https 的关系其实就是 http + SSL = https</li></ul></li><li><p>SSL</p><ul><li><p>用于加密, 数据完整性, 端点鉴别</p></li><li><p>位于应用层, 应用程序使用 SSL 库, 想 SSL 套接字传输明文, SSL 加密该数据并将其传递给 TCP 套接字, 经由因特网传输, 由接收方 SSL 进行解密</p></li></ul></li></ol><h4 id="三-udp-服务" tabindex="-1"><a class="header-anchor" href="#三-udp-服务"><span>三. UDP 服务</span></a></h4><ul><li>提供一种<strong>不可靠</strong>数据传送服务（unreliable data transfer）</li><li>当进程将报文发送至 UDP 套接字时，UDP 并不能保证该报文将到达接收进程</li></ul><h3 id="_2-1-5-应用层协议" tabindex="-1"><a class="header-anchor" href="#_2-1-5-应用层协议"><span>2.1.5 应用层协议</span></a></h3><blockquote><p>Application-layer protocol</p></blockquote><p><strong>应用层协议（Application-layer protocol）</strong> 定义了运行在不同端系统上的应用程序进程如何相互传递报文。</p><h3 id="_2-1-6-网络应用" tabindex="-1"><a class="header-anchor" href="#_2-1-6-网络应用"><span>2.1.6 网络应用</span></a></h3><ul><li>Web</li><li>电子邮件</li><li>目录服务</li><li>流式视频</li><li>P2P</li><li>。。。</li></ul><h2 id="_2-2-web-和-http" tabindex="-1"><a class="header-anchor" href="#_2-2-web-和-http"><span>2.2 Web 和 HTTP</span></a></h2><blockquote><p><strong>Web and http</strong></p></blockquote><h3 id="_2-2-1-http-概况" tabindex="-1"><a class="header-anchor" href="#_2-2-1-http-概况"><span>2.2.1 HTTP 概况</span></a></h3><blockquote><p>HTTP overview</p></blockquote><p>Web 的应用层协议是<strong>超文本传输协议（HyperText Transfer Protocol，HTTP）</strong>，它是 Web 的核心</p><ul><li><strong>Web 页面（Web page）</strong>（也叫文档）是由对象组成。一个对象（object）只是一个文件，诸如一个 HTML 文件、一个 JPEG 图片、一个 Java 小程序等等</li><li>多数 Web 页面包含<strong>HTML 基本文件（base HTML）</strong> 以及几个引用对象</li><li><strong>Web 浏览器（Web browser）</strong> 实现了 HTTP 的客户端；<strong>Web 服务器（Web server）</strong> 实现了 HTTP 的服务器端</li><li>HTTP 使用 TCP 作为它的支撑运输协议</li><li>因为 HTTP 服务器并不保存关于客户的任何信息，所以我们会说 HTTP 是一个<!---->；</li></ul><h3 id="_2-2-2-非持续连接和持续连接" tabindex="-1"><a class="header-anchor" href="#_2-2-2-非持续连接和持续连接"><span>2.2.2 非持续连接和持续连接</span></a></h3><blockquote><p>Non-persistent HTTP and Persistent HTTP</p></blockquote><h4 id="一-非持续连接" tabindex="-1"><a class="header-anchor" href="#一-非持续连接"><span>一. 非持续连接</span></a></h4><ol><li>TCP 连接开启</li><li>最多一个对象通过该 TCP 连接发送</li><li>该 TCP 连接关闭；</li></ol><h4 id="二-持续连接" tabindex="-1"><a class="header-anchor" href="#二-持续连接"><span>二. 持续连接</span></a></h4><ol><li><p>持续连接的 HTTP</p><ol><li>TCP 连接开启</li><li>多个对象通过该 TCP 连接发送</li><li>该 TCP 连接关闭；</li></ol></li><li><p>无流水线的持续:</p><ul><li><p>仅当前面的响应已经收到, 客户端才发出新的请求</p></li><li><p>每一个应用对象就需要一个 RTT</p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230320212811166.png" alt="image-20230320212811166" style="zoom:50%;"></li></ul></li><li><p>有流水线的持续</p><ul><li><p>在 HTTP/1.1 为默认</p></li><li><p>只要客户遇到一个引用对象, 它就发送请求</p></li><li><p>对于所有引用的对象花费一个 RTT 时间</p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230320212934701.png" alt="image-20230320212934701" style="zoom:50%;"></li></ul></li></ol><ul><li><!---->（Round-Trip Time，RTT） 定义：该时间是指一个短分组从客户到服务器然后在返回客户所需要的时间；</li></ul><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/c5522e3d6da14bf1a876da8be78991c7.png" alt="img" style="zoom:50%;"><h3 id="_2-2-3-http-报文格式" tabindex="-1"><a class="header-anchor" href="#_2-2-3-http-报文格式"><span>2.2.3 HTTP 报文格式</span></a></h3><blockquote><p>HTTP message format</p></blockquote><h4 id="http-请求报文" tabindex="-1"><a class="header-anchor" href="#http-请求报文"><span>HTTP 请求报文</span></a></h4><div class="language-http line-numbers-mode" data-highlighter="shiki" data-ext="http" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-http"><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">GET</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> /index.html </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">HTTP</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">/</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">1.1</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">\r\n</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">Host:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> www-net.cs.umass.edu\r\n</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">User-Agent:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Firefox/3.6.10\r\n</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">Accept:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> text/html,application/xhtml+xml\r\n</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">Accept-Language:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> en-us,en;q=0.5\r\n</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">Accept-Encoding:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> gzip,deflate\r\n</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">Accept-Charset:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ISO-8859-1,utf-8;q=0.7\r\n</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">Keep-Alive:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 115\r\n</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">Connection:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> keep-alive\r\n</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">\r\n</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>请求报文的第一行叫做<strong>请求行（request line）</strong>，其后继的行叫作<strong>首部行（header line）</strong></p></li><li><p>请求行有 3 个字段：① 方法字段、②URL 字段和 ③HTTP 版本字段</p><ul><li>方法可取<code>GET</code>,<code>POST</code>,<code>HEAD</code>,<code>PUT</code>,<code>DELETE</code></li></ul></li><li><p>首部行 HOST:指明了对象所在的主机；首部行 User-Agent:指明了用户代理，即浏览器类型</p></li></ul><p><strong>HTTP 请求报文通用格式：</strong></p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/9a0af254014e4edfafef72d90dbc8394.png" alt="img" style="zoom:33%;"><h4 id="http-响应报文" tabindex="-1"><a class="header-anchor" href="#http-响应报文"><span>HTTP 响应报文</span></a></h4><div class="language-http line-numbers-mode" data-highlighter="shiki" data-ext="http" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-http"><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">HTTP</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">/</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">1.1</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 200</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> OK\r\n</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">Date:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Sun, 26 Sep 2010 20:09:20 GMT\r\n</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">Server:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Apache/2.0.52 (CentOS)\r\n</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">Last-Modified:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Tue, 30 Oct 2007 17:00:02 GMT\r\n</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">ETag:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> &quot;17dc6-a5c-bf716880&quot;\r\n</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">Accept-Ranges:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> bytes\r\n</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">Content-Length:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 2652\r\n</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">Keep-Alive:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> timeout=10, max=100\r\n</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">Connection:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Keep-Alive\r\n</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">Content-Type:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> text/html; charset=ISO-8859-1\r\n</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">\r\n</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(data data data data data ... )</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>上例响应报文包括一个<strong>初始状态行（status line）</strong>，9 个<strong>首部行（header line）</strong>，然后是<strong>实体体（entity boby）</strong></li><li>状态行有 3 个字段：协议版本字段、状态码和状态信息 <ul><li>200 OK：请求成功</li><li>301 Moved Permanently：请求对象以及被永久转移</li><li>400 Bad Request：一个通用差错代码，该请求不能被服务器理解</li><li>404 Not Found：被请求的文档不在服务器上</li><li>505 HTTP Version Not Support：服务器不支持请求报文使用的 HTTP 协议版本</li></ul></li></ul><h3 id="_2-2-4-用户与服务器的交互-cookie🍪" tabindex="-1"><a class="header-anchor" href="#_2-2-4-用户与服务器的交互-cookie🍪"><span>2.2.4 用户与服务器的交互：cookie🍪</span></a></h3><blockquote><p>Maintaining user/server state: cookies🍪</p></blockquote><p>前面提到 HTTP 服务器为<strong>无状态</strong>的，而一个 Web 站点通常希望能够识别用户，可能是因为服务器希望限制用户的访问，或者因为它希望把内容与用户身份联系起来。为此，HTTP 使用了 cookie🍪。</p><p>cookie 技术有 4 个组件：</p><ul><li>HTTP 响应报文的 cookie 首部行</li><li>HTTP 请求报文的 cookie 首部行</li><li>用户端系统中保留一个 cookie 文行</li><li>位于 Web 站点的一个后端数据库；</li></ul><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/acee63fc80ea41dcb1f6bde1c6d72c7b.png" alt="img" style="zoom:33%;"><h3 id="_2-2-5-web-缓存" tabindex="-1"><a class="header-anchor" href="#_2-2-5-web-缓存"><span>2.2.5 Web 缓存</span></a></h3><blockquote><p>Web cache(proxy server)</p></blockquote><ol><li><p><strong>Web 缓存器（Web cache）也叫代理服务器（proxy server）</strong>，它是能够代表<strong>初始 Web 服务器（origin server）</strong> 来满足 HTTP 网络请求的实体。 <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/8d2c074cdd6a44e6aebdfe71508bfdb2.png" alt="img"></p></li><li><p>请求过程：</p><ol><li>浏览器创建一个到 Web 缓存器的 TCP 连接，并向 Web 缓存器中的对象发送一个 HTTP 请求</li><li>Web 缓存器进行检查，看看本地是否存储该对象副本。如果有，Web 缓存器向客户返回该对象</li><li>如果缓存器中没有该对象，它就打开一个与该对象的初始服务器的 TCP 连接。Web 缓存器向初始服务器发送请求，并得到初始服务器的响应</li><li>当 Web 缓存器接受对象后，在本地创建给对象的副本，并向客户发送响应报文返回该对象；</li></ol><ul><li>通过使用<!---->，Web 缓存器正在因特网中发挥着越来越重要的作用。</li></ul></li></ol><h3 id="_2-2-6-条件-get-方法" tabindex="-1"><a class="header-anchor" href="#_2-2-6-条件-get-方法"><span>2.2.6 条件 GET 方法</span></a></h3><blockquote><p>Conditional GET</p></blockquote><p>尽管高速缓存器能减少用户感受到的响应时间，但引入了一个新的问题，即存放在缓存器中的副本可能陈旧的。</p><p><strong>条件 GET 方法：</strong></p><ol><li>请求报文使用 GET 方法</li><li>请求报文中包含一个 If-Modified-Since:首部行；</li></ol><p>响应报文中状态行为 304 Not Modified 表示缓存器可以使用该对象的副本。</p><h2 id="_2-3-因特网中的电子邮件" tabindex="-1"><a class="header-anchor" href="#_2-3-因特网中的电子邮件"><span>2.3 因特网中的电子邮件</span></a></h2><blockquote><p>E-mail</p></blockquote><p>电子邮件三个主要组成部分：</p><ul><li>用户代理（User agent）</li><li>邮件服务器（mail server）</li><li>简单邮件传输协议（Simple Mail Transfer Protocol，SMTP）；</li></ul><p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/815e5f0b12f34b57a98b314903d5d9a2.png" alt="img"></p><p>用户代理</p><ul><li>撰写、编辑、阅读邮件</li><li>服务器上存储的传入和传出的消息；</li></ul><p>邮件服务器</p><ul><li>邮箱（mailbox）包括用户传入的消息</li><li>报文队列（message queue）中为待发送的邮件报文；</li></ul><p>SMTP 协议</p><ul><li>在邮箱服务器之间传输邮件报文；</li></ul><h3 id="_2-3-1-smtp" tabindex="-1"><a class="header-anchor" href="#_2-3-1-smtp"><span>2.3.1 SMTP</span></a></h3><p>假设 Alice 想给 Bob 发送一封简单的 ASCII 报文：</p><ol><li>Alice 调用她的邮件代理程序并提供 Bob 的邮件地址，撰写报文，然后指示用户代理发送该报文</li><li>Alice 的用户代理把报文发给她的邮件服务器，在那里该报文被放在报文队列中</li><li>运行在 Alice 的邮件服务器上的<strong>SMTP 客户端</strong>发现了该报文队列中的这个报文，它就创建一个到运行在 Bob 的邮件服务器上的 SMTP 服务器的<strong>TCP 连接</strong></li><li>经过一些<strong>初始 SMTP 握手</strong>后，SMTP 客户通过该 TCP 连接发送 Alice 的报文</li><li>在 Bob 的邮件服务器上，<strong>SMTP 的服务器端</strong>接受该报文。Bob 的邮件服务器然后将该报文放入 Bob 的邮箱中</li><li>在 Bob 方便的时候，他调用用户代理阅读该报文；</li></ol><p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/db4465cc7fbd4f8aa287496721067e64.png" alt="img"></p><ul><li>如果 Bob 的邮件服务器没有开机，该报文会保留在 Alice 的邮件服务器上并等待进行新的尝试，这意味着邮件并<strong>不在中间的某个邮件服务器存留</strong>。</li></ul><h3 id="_2-3-2-与-http-对比" tabindex="-1"><a class="header-anchor" href="#_2-3-2-与-http-对比"><span>2.3.2 与 HTTP 对比</span></a></h3><ol><li><ul><li><p>HTTP 主要是一个<strong>拉协议（pull protocol）</strong>，TCP 连接是由想接受文件的机器发起的；</p></li><li><p>SMTP 是一个<strong>推协议（push protocol）</strong>，TCP 连接是由发送文件的机器发起</p></li></ul></li><li><ul><li>SMTP 要求报文采用 7 比特 ASCII 码格式，如果含有非 7 比特 ASCII 字符，则这些数据必须按照 7 比特 ASCII 码进行编码</li><li>HTTP 不受这种限制</li></ul></li><li><ul><li>HTTP 把每个对象分别封装在不同的 HTTP 响应报文中</li><li>SMTP 则把所有报文对象放在一个报文中；</li></ul></li></ol><h3 id="_2-3-3-邮件报文格式" tabindex="-1"><a class="header-anchor" href="#_2-3-3-邮件报文格式"><span>2.3.3 邮件报文格式</span></a></h3><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-java"><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">To</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">:</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">发件人地址</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">From</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">:</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">收件人地址</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">Subject</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">:</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">邮件主题</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">...</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">邮件正文</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-3-4-邮件访问协议" tabindex="-1"><a class="header-anchor" href="#_2-3-4-邮件访问协议"><span>2.3.4 邮件访问协议</span></a></h3><blockquote><p>Mail accss protocol</p></blockquote><p>收件人的用户代理不能使用 SMTP 得到报文，因为取得报文是一个拉操作，而 SMTP 协议是一个推协议。通过引用一个特殊的邮件访问协议来解决这个问题，该协议将收件人邮件服务器上的报文传送给他的本地 PC。目前有一些流行的邮件访问协议，包括第三版的邮局协议（Post Office Protocol-Version 3，POP3）（不常用）、因特网邮件访问协议（Internet Mail Access Protocol，IMAP）以及 HTTP。</p><p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/e50384a522894d24b54f36a2e957985c.png" alt="img"></p><p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/430431614fd347d0ac080cbfcdd9fe32.png" alt="img"></p><h2 id="_2-4-dns-因特网的目录服务" tabindex="-1"><a class="header-anchor" href="#_2-4-dns-因特网的目录服务"><span>2.4 DNS：因特网的目录服务</span></a></h2><blockquote><p>Domain Name System</p></blockquote><h3 id="_2-4-1-dns-提供的服务" tabindex="-1"><a class="header-anchor" href="#_2-4-1-dns-提供的服务"><span>2.4.1 DNS 提供的服务</span></a></h3><blockquote><p>DNS:services</p></blockquote><p>识别主机的两种方式：通过<strong>主机名（hostname）或者 IP 地址（IP address）</strong>。人们喜欢记忆主机名标识方式，而路由器喜欢定长的、有着层次结构的 IP 地址。域名系统的主要任务：主机名到 IP 地址转换的目录服务。</p><p>DNS 是：</p><ol><li>一个由分层的<strong>DNS 服务器（DNS service）</strong> 实现的分布式数据库</li><li>一个使得主机能够查询分布式数据库的应用层协议；</li></ol><p>DNS 协议运行在 UDP 之下，使用<strong>53 号端口</strong>；</p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/76a638cb2faf4c1ba94a9ea8351ee09e.png" alt="img" style="zoom:50%;"><p>DNS 重要的服务：</p><ul><li>主机名到 IP 地址的转换（hostname to IP address translation）</li><li>主机别名（host aliasing）：应用程序调用 DNS 获取主机别名对应的<strong>规范主机名（canonical hostname）</strong> 以及主机的 IP 地址</li><li>邮件服务器别名（mail server aliasing）</li><li>负载分配（load distribution）：繁忙的站点被<strong>冗余分布在多台服务器</strong>上，每台服务器运行在不同的端系统上，每个都有着不同的 IP 地址。由于这些冗余的 Web 服务器，一个 IP 地址集合于<strong>一个规范主机名</strong>相联系。当客户对映射到某处到某地址集合的名字发出一个 DNS 请求时，该服务器用 IP 地址的整个集合进行响应，但在每个回答中循环这些地址次序。因为客户通常 <strong>总是向 IP 地址排在最前面的服务器发送 HTTP 请求报文</strong> ，所以 DNS 就在所有这些冗余的 Web 服务器之间循环分配了负载；</li></ul><h3 id="_2-4-2-dns-工作机理概述" tabindex="-1"><a class="header-anchor" href="#_2-4-2-dns-工作机理概述"><span>2.4.2 DNS 工作机理概述</span></a></h3><blockquote><p>Overview of How DNS Works</p></blockquote><p>集中式设计的问题包括：</p><ul><li>单点故障（a single point of failure）</li><li>通信容量（traffic volume）</li><li>远距离的集中式数据库（distant centralized database）</li><li>维护（maintenance）；</li></ul><h4 id="分布式-层次数据库" tabindex="-1"><a class="header-anchor" href="#分布式-层次数据库"><span>分布式，层次数据库</span></a></h4><p>分布式 DNS 服务器的层次结构：</p><ul><li>根 DNS 服务器（root DNS servers）</li><li>顶级域服务器（Top-Level Domain DNS servers）</li><li>权威 DNS 服务器（authoritative DNS servers）</li><li>本地服务器（local DNS servers）：不属于该服务器的层次结构，但它对 DNS 层次结构是至关重要的；</li></ul><p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/cc2076a514b24df099d8d39196875a9b.png" alt="img"></p><h4 id="查询方式" tabindex="-1"><a class="header-anchor" href="#查询方式"><span>查询方式</span></a></h4><ol><li>递归查询（Recursive query）</li></ol><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/281d17276a924bc6aa6c791a0407bfa9.png" alt="img" style="zoom:50%;"><ol><li>迭代查询（Iterative query）</li></ol><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/46a23ea6636e495eb097ec8202ce6ac0.png" alt="img" style="zoom:50%;"><p>从请求主机到本地的 DNS 服务器的查询是递归的，其余的查询是迭代的。</p><h4 id="dns-缓存" tabindex="-1"><a class="header-anchor" href="#dns-缓存"><span>DNS 缓存</span></a></h4><p>在某一个请求链中，当某 DNS 服务器接收一个 DNS 回答，它能映射在本地存储器中。由于主机和主机名与 IP 地址的映射并不是永久的，DNS 服务器在一段时间后将丢弃缓存的信息。</p><h3 id="_2-4-3-dns-记录和报文" tabindex="-1"><a class="header-anchor" href="#_2-4-3-dns-记录和报文"><span>2.4.3 DNS 记录和报文</span></a></h3><blockquote><p>DNS Record and Protocol Message</p></blockquote><h4 id="dns-记录" tabindex="-1"><a class="header-anchor" href="#dns-记录"><span>DNS 记录</span></a></h4><p>所有 DNS 服务器存储了<strong>资源记录（Resourse Record，RR）</strong>，资源记录是一个包含了下列字段的 4 元组：</p><ul><li>(Name, Value, Type, TTL)</li></ul><p>下面为不同类型 Type 的 Name 和 Value：</p><p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/0ee27080b3214ec0b4315342f3b070ff.png" alt="img"></p><h4 id="dns-报文" tabindex="-1"><a class="header-anchor" href="#dns-报文"><span>DNS 报文</span></a></h4><p>DNS 报文中各字段的语义如下：</p><p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/cee3b2b873df4e5b95ed7de4074d8cbb.png" alt="img"></p><h2 id="_2-5-p2p-文件分发" tabindex="-1"><a class="header-anchor" href="#_2-5-p2p-文件分发"><span>2.5 P2P 文件分发</span></a></h2><blockquote><p>Peer-to-Peer File Distribution</p></blockquote><p>CS 系统极大依赖于总是打开的基础设施服务器，P2P 对总是打开的服务器有最小的（或者没有）依赖。</p><h3 id="p2p-体系结构的扩展性" tabindex="-1"><a class="header-anchor" href="#p2p-体系结构的扩展性"><span>P2P 体系结构的扩展性</span></a></h3><blockquote><p>Scalability of P2P Architectures</p></blockquote><p>文件分发问题的示例图如下：</p><p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/5a7765737b944f149413bc16aafa5762.png" alt="img"></p><p>对于客户-服务器体系结构的分发时间如下：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>D</mi><mrow><mi>c</mi><mi>s</mi></mrow></msub><mo>=</mo><mi>max</mi><mo>⁡</mo><mo stretchy="false">{</mo><mfrac><mrow><mi>N</mi><mi>F</mi></mrow><msub><mi>u</mi><mi>s</mi></msub></mfrac><mo separator="true">,</mo><mfrac><mi>F</mi><msub><mi>d</mi><mrow><mi>m</mi><mi>i</mi><mi>n</mi></mrow></msub></mfrac><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">D_{cs}=\max\{\frac{NF}{u_s},\frac{F}{d_{min}}\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">cs</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.3174em;vertical-align:-0.4451em;"></span><span class="mop">max</span><span class="mopen">{</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8723em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1645em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">NF</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4451em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8723em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">min</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">F</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4451em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">}</span></span></span></span></p><p>对于 P2P 体系结构分发时间如下：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>D</mi><mrow><mi>P</mi><mn>2</mn><mi>P</mi></mrow></msub><mo>=</mo><mi>max</mi><mo>⁡</mo><mo stretchy="false">{</mo><mfrac><mi>F</mi><msub><mi>u</mi><mi>s</mi></msub></mfrac><mo separator="true">,</mo><mfrac><mi>F</mi><msub><mi>d</mi><mrow><mi>m</mi><mi>i</mi><mi>n</mi></mrow></msub></mfrac><mo separator="true">,</mo><mfrac><mrow><mi>N</mi><mi>F</mi></mrow><mrow><msub><mi>u</mi><mi>s</mi></msub><mo>+</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></msubsup><msub><mi>u</mi><mi>i</mi></msub></mrow></mfrac><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">D_{P2P}=\max\{\frac{F}{u_s},\frac{F}{d_{min}},\frac{NF}{u_s+\sum^N_{i=1}u_i}\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span><span class="mord mtight">2</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.527em;vertical-align:-0.6547em;"></span><span class="mop">max</span><span class="mopen">{</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8723em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1645em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">F</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4451em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8723em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">min</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">F</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4451em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8723em;"><span style="top:-2.5703em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1645em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="mop mtight"><span class="mop op-symbol small-op mtight" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8852em;"><span style="top:-2.1786em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-2.8971em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3214em;"><span></span></span></span></span></span></span><span class="mspace mtight" style="margin-right:0.1952em;"></span><span class="mord mtight"><span class="mord mathnormal mtight">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">NF</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.6547em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">}</span></span></span></span></p><p>P2P 和客户-服务器体系结构的分发时间随用户数量变化如下：</p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/b9372ac8cc0d411f9b37594daefffaf7.png" alt="img" style="zoom:50%;"><h3 id="bittorrent" tabindex="-1"><a class="header-anchor" href="#bittorrent"><span>BitTorrent</span></a></h3><p>参与一个特定文件分发的所有对等方的集合被称为一个<strong>洪流（torrent）</strong>。在一个洪流中的对等方彼此下载等长度的<strong>文件块（chunk）</strong> ，典型块长度为 256KB。当一个对等方下载块时，也为其他对等方上载了多个块。每个洪流具有一个基础设施节点，称为<strong>追踪器（tracker）</strong>。当一个对等方加入某洪流时，它向追踪器注册自己，并周期性地通知追踪器它仍在该洪流中。</p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/03e41d8bd1904964813ca6579ffef532.png" alt="img" style="zoom:50%;"><ul><li>决定请求哪些块的过程：<strong>最稀缺优先（rarest first）</strong> 技术</li><li>决定响应哪个请求：根据当前能够以最高速率的<strong>疏通（unchoked）</strong> 的对等方提供数据的邻居，给出优先权；</li></ul><h2 id="_2-6-视频流和内容分发网" tabindex="-1"><a class="header-anchor" href="#_2-6-视频流和内容分发网"><span>2.6 视频流和内容分发网</span></a></h2><blockquote><p>Video Streaming and Content Distribution Networks</p></blockquote><h3 id="_2-6-1-http-流和-dash" tabindex="-1"><a class="header-anchor" href="#_2-6-1-http-流和-dash"><span>2.6.1 HTTP 流和 DASH</span></a></h3><p>HTTP 流所有客户接受到相同编码的视频，但对不同用户或者不同时间，客户可用的带宽大小有很大不同。<strong>HTTP 的动态适应性流（Dynamic Adaptive Streaming over HTTP，DASH）</strong>：视频编码成几个不同的版本，其中每个版本具有不同的比特率，对应于不同的质量水平。客户动态地请求来自不同版本且长度为几秒的视频段数据块。</p><p>每个视频版本存储在 HTTP 服务器中，每个版本都有一个不同的 URL。HTTP 服务器也有一个<strong>告示文件（manifest file）</strong>，为每个版本提供了一个 URL 及其比特率。</p><h3 id="_2-6-2-内容分发网" tabindex="-1"><a class="header-anchor" href="#_2-6-2-内容分发网"><span>2.6.2 内容分发网</span></a></h3><p>为了应对向分布于全世界的用户分发巨量视频数据的挑战，几乎所有主要的视频流公司都利用<strong>内容分发网（Content Distribution Network，CDN）</strong>。CDN 管理分布在多个地理位置上的服务器，在它的服务器中存储视频的副本，并且所有试图将每个用户请求定向到一个将提供最好的用户体验的 CDN 位置。CDN 可以是<strong>专用 CDN（private CDN）</strong>，即它由内容提供商自己所拥有；另一种 CDN 可以是<strong>第三方 CDN（third-party CDN）</strong>，它代表多个内容提供商分发内容。</p><h4 id="cdn-操作" tabindex="-1"><a class="header-anchor" href="#cdn-操作"><span>CDN 操作</span></a></h4><p>当客户请求一个特定视频时，CDN 必须截获该请求，以便能够：</p><ol><li>确定此时适合用于该客户的 CDN 服务器集群</li><li>将客户的请求重定向到该集群的某台服务器；</li></ol><p>CDN 操作步骤如下：</p><p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/50759410e06e4cf9807285e0ba084a49.png" alt="img"></p><h2 id="_2-7-套接字编程-生成网络应用" tabindex="-1"><a class="header-anchor" href="#_2-7-套接字编程-生成网络应用"><span>2.7 套接字编程：生成网络应用</span></a></h2><blockquote><p>Socket Programming: Creating Network Applications</p></blockquote><h3 id="_2-7-1-udp-套接字编程" tabindex="-1"><a class="header-anchor" href="#_2-7-1-udp-套接字编程"><span>2.7.1 UDP 套接字编程</span></a></h3><p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/762107a9de794182ad2ad485410b4c3a.png" alt="img"></p><h3 id="_2-7-2-tcp-套接字编程" tabindex="-1"><a class="header-anchor" href="#_2-7-2-tcp-套接字编程"><span>2.7.2 TCP 套接字编程</span></a></h3><p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/fd93b824414149a8a4d09119ccdeabe0.png" alt="img"></p><h1 id="第三章-运输层" tabindex="-1"><a class="header-anchor" href="#第三章-运输层"><span>第三章 运输层</span></a></h1><h2 id="_3-1-概述和运输层服务" tabindex="-1"><a class="header-anchor" href="#_3-1-概述和运输层服务"><span>3.1 概述和运输层服务</span></a></h2><blockquote><p>Introduction and Transport-Layer Services</p></blockquote><p>运输层协议为运行在不同的主机上的应用进程之间提供了<strong>逻辑通信（logic communication）</strong> 功能从应用程序的角度看，通过逻辑通信，运行不同进程的主机好像直接相连一样。逻辑通信的概念如下：</p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/788d80d38f9248198ec9ad921db489d9.png" alt="piimg" style="zoom:50%;"><p>运输层协议是<mark>在端系统中</mark> 而不是在路由器中实现。在发送端，运输层将从发送应用程序接收到的报文转换成传输层分组，用因特网术语来讲该分组称为运输层<strong>报文段（segment）</strong>。</p><h3 id="_3-1-1-运输层和网络层的关系" tabindex="-1"><a class="header-anchor" href="#_3-1-1-运输层和网络层的关系"><span>3.1.1 运输层和网络层的关系</span></a></h3><blockquote><p>Relationship Between Transport and Network Layers</p></blockquote><p>在协议栈中，运输层刚好位于网络层之上。网络层提供了<strong>主机之间</strong>的逻辑通信，而运输层为运行在<strong>不同主机上的进程之间</strong>提供了逻辑通信。运输协议能够能够提供的服务常常受制于底层网络层协议的服务模型。如果网络层协议无法为主机之间发送的运输层报文段提供时延或带宽保证的话，运输层协议也就无法为进程之间发送的应用程序报文提供时延或带宽保证。</p><ul><li>运输层是<!---->(端口), 网络层是点到点(主机到主机)</li></ul><p>即使底层网络协议是不可靠的，也就是说网络层协议会使分组丢失、篡改和冗余，运输层协议也能为应用程序提供<strong>可靠的数据传输服务</strong>。另一方面，即使网络层不能保证运输层报文段的机密性，运输协议也能使用加密来确保应用程序报文不被入侵者读取。</p><h3 id="_3-1-2-internet-运输层概述" tabindex="-1"><a class="header-anchor" href="#_3-1-2-internet-运输层概述"><span>3.1.2 Internet 运输层概述</span></a></h3><blockquote><p>Overview of the Transport Layer in the Internet</p></blockquote><ol><li><p>因特网提供两种不同的可用的运输层协议。</p><ul><li><!----> : 为调用它的应用程序提供了一种<strong>不可靠</strong>、无连接的服务；</li><li><!---->: 为调用它的应用程序提供了一种<strong>可靠的</strong>、面向连接的服务。<img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230327085802967.png" alt="image-20230327085802967" style="zoom:67%;"> - 拥塞控制, 流量控制, 连接建立 </li></ul></li><li><p><strong>因特网</strong>网络层协议有一个名字叫<!---->，即网际协议，IP 的服务模型是<!---->, 所以 IP 被称为<!----></p></li><li><p>UDP 和 TCP 最基本的责任是，将两个端系统间 IP 的交付服务扩展为运行在端系统上的两个进程之间的交付服务。</p><ul><li>将主机间交付扩展到进程间交付被称为<!---->与<!---->。</li></ul></li></ol><h2 id="_3-2-多路复用与多路分解" tabindex="-1"><a class="header-anchor" href="#_3-2-多路复用与多路分解"><span>3.2 多路复用与多路分解</span></a></h2><blockquote><p>Multiplexing and Demultiplexing</p></blockquote><ol><li><p>运输层的多路复用与多路分解，也就是将由网络层提供的主机到主机的交付服务延伸到为运行在主机上的应用程序提供进程到进程的服务。</p><ul><li>一个进程（作为网络应用的一部分）有一个或多个<strong>套接字（socket）</strong>，它相当于从网络向进程传递数据和从进程向网络传递数据的门户。</li><li>进程交付过程：<img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/6a99648a16ed446597050ba5c943f70f.png" alt="img" style="zoom:50%;"></li></ul></li><li><p>多路分解和多路复用</p><ul><li><!---->：在接收端，运输层检查这些字段，标识出接收套接字，进而将报文段定向到该套接字，即将运输层报文段的数据交付到正确的套接字的工作；</li><li><!---->：在源主机从不同套接字中收集数据块，并为每个数据块封装上首部信息（这将在以后用于分解）从而生成报文段，然后将报文传递到网络层；<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>应用层一个端口</mtext><mo stretchy="false">(</mo><mtext>套接字</mtext><mo stretchy="false">)</mo><mtext>发送信息</mtext><mo><mover><mo><mo>⟶</mo></mo><mtext>运输层多路复用</mtext></mover></mo><mtext>网络层</mtext><mo><mover><mo><mo>⟶</mo></mo><mtext>运输层多路分解</mtext></mover></mo><mtext>分配到对于的端口</mtext><mo stretchy="false">(</mo><mtext>套接字</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">应用层一个端口(套接字)发送信息\stackrel{运输层多路复用}{\longrightarrow}网络层\stackrel{运输层多路分解}{\longrightarrow}分配到对于的端口(套接字)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.5393em;vertical-align:-0.25em;"></span><span class="mord cjk_fallback">应用层一个端口</span><span class="mopen">(</span><span class="mord cjk_fallback">套接字</span><span class="mclose">)</span><span class="mord cjk_fallback">发送信息</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.2893em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop">⟶</span></span></span><span style="top:-3.711em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord cjk_fallback mtight">运输层多路复用</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.011em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.3003em;vertical-align:-0.011em;"></span><span class="mord cjk_fallback">网络层</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.2893em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop">⟶</span></span></span><span style="top:-3.711em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord cjk_fallback mtight">运输层多路分解</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.011em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord cjk_fallback">分配到对于的端口</span><span class="mopen">(</span><span class="mord cjk_fallback">套接字</span><span class="mclose">)</span></span></span></span></p></li></ul></li><li><p>运输层多路复用要求：</p><ol><li><p>套接字由唯一标识符；</p></li><li><p>每个报文段有特殊字段来指示该报文段所要交付的套接字；</p><ul><li><p>这些特殊字段是<strong>源端口号字段（source port number field）和目的端口号字段（destination port number field）</strong>，如下图所示：<img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/3b375d4e35f1421d9461cee91ce36cb5.png" alt="img" style="zoom:67%;"></p></li><li><p>端口号是一个 16 比特的数，其大小在 0~65535 之间。0~1023 范围的端口号称为<strong>周知端口号（well-know port number）</strong>，是受限制的(可能被占用)。</p></li><li><p>常用的熟知端口 <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230327090553866.png" alt="image-20230327090553866" style="zoom:50%;"></p></li></ul></li></ol></li></ol><h3 id="udp-的-socket-表示" tabindex="-1"><a class="header-anchor" href="#udp-的-socket-表示"><span>UDP 的 socket 表示</span></a></h3><p>UDP 套接字采用二元组表示(源端口， 目的端口)</p><p>具体过程如下图所示：</p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/067887500ad444888dbc88eb84dd1314.png" alt="img" style="zoom:50%;"><h3 id="tcp-的-socket-表示" tabindex="-1"><a class="header-anchor" href="#tcp-的-socket-表示"><span>TCP 的 socket 表示</span></a></h3><p>TCP 套接字采用四元组表示(源 IP 地址， 源端口号， 目的 IP 地址， 目的端口号)</p><p>下图为两个客户使用相同的目的端口号（80）与同一个 Web 服务器应用通信：</p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/d6362b32bd0f424f97c605f43291468c.png" alt="img" style="zoom:50%;"><h2 id="_3-3-无连接运输-udp" tabindex="-1"><a class="header-anchor" href="#_3-3-无连接运输-udp"><span>3.3 无连接运输：UDP</span></a></h2><blockquote><p>Connectionless Transport: UDP</p></blockquote><ol><li><p>使用 UDP 时，在发送报文段之前，发送方和接收方的运送层实体之间没有握手，UDP 被称为<!---->。许多应用更适合用 UDP 的原因如下：</p><ul><li>无拥塞控制（no congestion control）: UDP 能尽可能快的传输报文</li><li>无须连接建立（no connection establishment) &amp; 无连接状态（no connection state）: 有连接的服务会增加时延, 发送和接受方无需维护连接状态</li><li>分组首部开销小（small header size）</li></ul></li><li><p>流行的因特网应用及其下面的运输协议如下图： <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/e46e5368b91840daa03d6cce5f2c3ac5.png" alt="img" style="zoom:50%;"></p></li></ol><h3 id="_3-3-1-udp-报文段结构" tabindex="-1"><a class="header-anchor" href="#_3-3-1-udp-报文段结构"><span>3.3.1 UDP 报文段结构</span></a></h3><blockquote><p>UDP Segment Structure</p></blockquote><ul><li>报文段包括上面提到的源端口号和目的端口号, 还有 <ul><li>长度字段，指明 UDP 报文段中的字节数（首部 ➕ 数据）；</li><li>检验和字段来检查在该报文段中是否出现差错。</li></ul></li><li>报文段结构如下图：<img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230504205455201.png" alt="image-20230504205455201" style="zoom:67%;"></li></ul><h3 id="_3-3-2-udp-检验和" tabindex="-1"><a class="header-anchor" href="#_3-3-2-udp-检验和"><span>3.3.2 UDP 检验和</span></a></h3><blockquote><p>UDP Checksum</p></blockquote><ol><li><p>目的 : 在传送的报文段中检查“差错”</p></li><li><p>校验和的计算</p><ul><li><p>校验和计算需要用到伪首部, UDP 首部, UDP 数据部分 <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230327092921174.png" alt="image-20230327092921174" style="zoom:67%;"></p><ul><li>伪首部是在计算校验和时临时添加在 UDP 数据报前的, 并不会向下(网络层)传送或是向上(应用层)递交</li></ul></li><li><p>计算流程: (以发送方为例)</p><ol><li><p>校验和字段先置 0</p></li><li><p>将伪首部, UDP 首部, UDP 数据部分以 16bit(字)为单位划分</p><ul><li>数据部分如不足 16 位补 0</li></ul></li><li><p>对 16 位字按位求和, 最高位进位必须加到最低位上(<!---->)</p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/ba5d191d59ef46eb8fda1dfbe05def0c.png" alt="img" style="zoom:67%;"></li><li><p>最后对结果求反码, 放入校验和字段</p></li></ol></li><li><p>接收方，全部的 16 比特字（<strong>包括检验和</strong>）加在一起，如果分组中没有差错，接收方处该和将是 1111111111111111，如果比特字中出现 0，那么就认为该分组出现差错。</p></li></ul></li></ol><h2 id="_3-4-可靠数据传输原理" tabindex="-1"><a class="header-anchor" href="#_3-4-可靠数据传输原理"><span>3.4 可靠数据传输原理</span></a></h2><blockquote><p>Principles of Reliable Data Transfer</p></blockquote><p>可靠数据传输的框架：为上层实体提供的服务抽象是：数据可以通过一条可靠的信道进行传输。如下图所示：</p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/ae00149c52e54773ae5f0f78a0ed3914.png" alt="img" style="zoom:50%;"><p>实现这种服务抽象是<strong>可靠数据传输协议（reliable data transfer protocol，rdt）</strong> 的责任，下图为可靠数据传输协议的相关接口（Interface）：</p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230327101859905.png" alt="image-20230327101859905" style="zoom:50%;"><h3 id="_3-4-1-构造可靠数据传输协议-别看" tabindex="-1"><a class="header-anchor" href="#_3-4-1-构造可靠数据传输协议-别看"><span>3.4.1 构造可靠数据传输协议 [别看]</span></a></h3><blockquote><p>Building a Reliable Data Transfer Protocol</p></blockquote><h4 id="经完全可靠信道的可靠数据传输-rdt1-0" tabindex="-1"><a class="header-anchor" href="#经完全可靠信道的可靠数据传输-rdt1-0"><span>经完全可靠信道的可靠数据传输：rdt1.0</span></a></h4><p>发送方和接收方的表示使用 <!----> 定义</p><ul><li>如果对一个事件没有动作，或没有就发生发生而采取了一个动作，我们将在横线上方或下方使用符号<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Λ</mi></mrow><annotation encoding="application/x-tex">\Lambda</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">Λ</span></span></span></span> ，以分别明确地表示缺少动作或事件。</li><li>——上方表示表示状态转换条件, ——下方表示状态转换的动作</li></ul><p>我们考虑最简单的情况，<strong>即底层信道是完全可靠的</strong>，我们称该协议为 rdt1.0，发送方和接收方的 FSM 定义如下：</p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/7b62bfc615854997b90911758394600c.png" alt="img" style="zoom:50%;"><h4 id="经具有比特差错信道的可靠数据传输-rdt2-0" tabindex="-1"><a class="header-anchor" href="#经具有比特差错信道的可靠数据传输-rdt2-0"><span>经具有比特差错信道的可靠数据传输：rdt2.0</span></a></h4><blockquote><p>底层信道更为实际的模型是分组中的比特可能受损的模型。</p></blockquote><ul><li><p>在分组传输、传播或缓存的过程中，这种比特差错通常会出现在网络的物理部件中。在接收方得到比特差错的信息时，需要发送方进行重传。</p></li><li><p>在计算机网络环境中，基于这种重传机制的可靠数据传输协议称为<strong>自动重传请求（Automatic Repeat reQuest，ARQ）协议</strong>。ARQ 协议中还需要另外三种协议来处理存在比特差错的情况：</p><ul><li>差错检测：发送方同时发送检测和（checksum）到接收端判断是否出现比特差错；</li><li>接收方反馈： <ul><li><!---->：接收方告诉发送方包数据无差错；</li><li><!---->：接收方告诉发送方包数据有错误；</li></ul></li><li>重传：接收方收到有差错的分组时，发送方将重传该分组文；</li></ul></li><li><p>rdt2.0 的 FSM 如下图：<img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230327102432964.png" alt="image-20230327102432964" style="zoom:67%;"></p><ul><li>当发送方处于等待 ACK 或 NAK 的状态时，它不能从上层获得更多的数据；这就是说，在等待 ACK/NAK 期间 rdt_send()事件不可能出现；仅当接收到 ACK 并离开该状态时才能发生这样的事件。 因此，发送方将不会发送一块新数据，除非发送方确信接收方已正确接收当前分组。由于这种行为，rdt2.0 这样的协议被称为<!---->。</li></ul></li></ul><h5 id="rdt2-1" tabindex="-1"><a class="header-anchor" href="#rdt2-1"><span>rdt2.1</span></a></h5><ul><li><p>rdt2.0 协议并没有考虑<strong>ACK 和 NAK 受损</strong>(受损之后)的情况，为了解决这一问题，就是在数据分组中添加一新字段，让发送方对其数据分组编号，即将发送数据分组的<!---->放在该字段。于是，接收方只需要检查序号即可确定收到的分组是否一次重传。</p></li><li><p>rdt2.1 的 FSM 如下图：</p><ol><li>发送方 : <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230327102933555.png" alt="image-20230327102933555" style="zoom:67%;"></li><li>接收方 : <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230327103042436.png" alt="image-20230327103042436" style="zoom:67%;"></li></ol></li><li><p>rdt 总结</p><ul><li>发送方 <ul><li>分组新增了序列号(只需要使用 0,1 两个序列号即可)</li><li>必须检查是否收到 ACK/NAK</li><li>状态增加, 反映出当前正在发送的分组是 0 还是 1</li></ul></li><li>接收方 <ul><li>必须检查接收到的分组是否冗余(根据状态的 0/1)</li><li>注意 : 接收方不可能知道最新发送的 ACK/NAK 是否已经被发送方正确接收 <!----></li></ul></li></ul></li></ul><h5 id="rdt2-2" tabindex="-1"><a class="header-anchor" href="#rdt2-2"><span>rdt2.2</span></a></h5><p>如果收到受损的分组，则接收方将发送一个否定确认。如果不发送 NAK，而是对上次正确接收的分组发送一个 ACK，我们也能实现与 NAK 一样的效果。</p><p>发送方接收到对同一个分组的两个 ACK，即**冗余 ACK（duplicate ACK）**后，就知道接收方没有正确接收到跟在被确定两次的分组后面的分组。</p><p>rdt2.2 的 FSM 如下图所示：</p><ul><li>发送方 : <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230327104455802.png" alt="image-20230327104455802" style="zoom:67%;"></li><li>接收方 : <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230327104522873.png" alt="image-20230327104522873" style="zoom:67%;"></li></ul><h4 id="经具有比特差错的丢包信道的可靠数据传输-rdt3-0" tabindex="-1"><a class="header-anchor" href="#经具有比特差错的丢包信道的可靠数据传输-rdt3-0"><span>经具有比特差错的丢包信道的可靠数据传输：rdt3.0</span></a></h4><ul><li><p>因为特别大的时延，发送方和接收方的信道中引入了<strong>冗余数据分组（duplicate data packet）</strong> 的可能性；</p></li><li><p>需要一个<strong>倒计数定时器（countdown timer）</strong>，实现基于时间的重传机制；</p></li><li><p>rdt3.0FSM 如下图：</p><ul><li>发送方 : <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230327104621590.png" alt="image-20230327104621590" style="zoom:67%;"></li><li>接收方 : <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230327104719450.png" alt="image-20230327104719450" style="zoom:67%;"></li></ul></li></ul><p>因为分组序号在 0 和 1 之间交替，因此 rdt3.0 有时被称为<strong>比特交替协议（alternating-bit protocol）</strong>。运行如下图所示：</p><p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/cd1a9d5ab48e4aea8a12b1d8d46366d3.png" alt="img"></p><ul><li>rdt3.0 说明 <ul><li>发送方发送完一个分组后，必须暂时保留已发送的分组的副本，以备重发。</li><li><strong>分组和确认都必须进行编号</strong>。</li><li>超时计时器的超时时间设定，应当比数据在分组传输的平均往返时间<strong>更长一些</strong>。</li><li><strong>发送方最终总是可以收到对所有发出的分组的确认</strong>。如果发送方不断重发分组但总是收不到确认，就说明通信线路太差，不能进行通信。</li><li>这种可靠传输协议常称为<!---->。意思是重发的请求是自动进行的，接收方不需要请求发送方重发某个出错的分组。</li></ul></li></ul><h3 id="_3-4-2-流水线可靠数据传输协议" tabindex="-1"><a class="header-anchor" href="#_3-4-2-流水线可靠数据传输协议"><span>3.4.2 流水线可靠数据传输协议</span></a></h3><blockquote><p>Pipelined Reliable Data Transfer Protocols</p></blockquote><ul><li><p>定义发送方（或信道）的利用率（utilization）为：发送方实际忙于将放送比特送进信道的那部分时间与发送时间之比。 对于一个等停协议的发送方利用率 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="#66ccff"><msub><mi>U</mi><mrow><mi>s</mi><mi>e</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>r</mi></mrow></msub><mo>=</mo><mfrac><mrow><mi>L</mi><mi mathvariant="normal">/</mi><mi>R</mi></mrow><mrow><mi>R</mi><mi>T</mi><mi>T</mi><mo>+</mo><mi>L</mi><mi mathvariant="normal">/</mi><mi>R</mi></mrow></mfrac></mstyle></mrow><annotation encoding="application/x-tex">\textcolor{#66ccff}{U_{sender}=\frac{L/R}{RTT+L/R}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord" style="color:#66ccff;"><span class="mord mathnormal" style="margin-right:0.10903em;color:#66ccff;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:#66ccff;"><span class="mord mtight" style="color:#66ccff;"><span class="mord mathnormal mtight" style="color:#66ccff;">se</span><span class="mord mathnormal mtight" style="color:#66ccff;">n</span><span class="mord mathnormal mtight" style="color:#66ccff;">d</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;color:#66ccff;">er</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel" style="color:#66ccff;">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.53em;vertical-align:-0.52em;"></span><span class="mord" style="color:#66ccff;"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight" style="color:#66ccff;"><span class="mord mtight" style="color:#66ccff;"><span class="mord mathnormal mtight" style="margin-right:0.13889em;color:#66ccff;">RTT</span><span class="mbin mtight" style="color:#66ccff;">+</span><span class="mord mathnormal mtight" style="color:#66ccff;">L</span><span class="mord mtight" style="color:#66ccff;">/</span><span class="mord mathnormal mtight" style="margin-right:0.00773em;color:#66ccff;">R</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="color:#66ccff;border-bottom-width:0.04em;"></span></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight" style="color:#66ccff;"><span class="mord mtight" style="color:#66ccff;"><span class="mord mathnormal mtight" style="color:#66ccff;">L</span><span class="mord mtight" style="color:#66ccff;">/</span><span class="mord mathnormal mtight" style="margin-right:0.00773em;color:#66ccff;">R</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> L/R:发送时延</p></li><li><p>解决该问题的方法是：不以停等方式运行，允许发送方发送多个分组而无须等待确认。 因为许多从发送方向接收方输送可以看成是填充到一条流水线中，故这种技术被称为<!----></p></li><li><p>下图为停等和流水线发送示意图：</p></li></ul><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/b41915c075bc4844b7a728a98c0ee99d.png" alt="img" style="zoom:50%;"><h3 id="_3-4-3-回退-n-帧" tabindex="-1"><a class="header-anchor" href="#_3-4-3-回退-n-帧"><span>3.4.3 回退 N 帧</span></a></h3><blockquote><p>Go-Back-N,GBN</p></blockquote><p>在回退 N 帧协议中，将基序号（base）定义为最早未确认分组的序号，将下一个序号（nextseqnum）定义为最小的未使用序号，则将序号范围分割成如下 4 段：</p><p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/d1123ebaa5f24819b0a69d6fa3ac3862.png" alt="img"></p><ul><li><code>[0,base-1]</code> : 已经发送并得到确认的分组；</li><li><code>[base,nextseqnum-1]</code> : 已经发送但未被确认的分组；</li><li><code>[nextseqnum,base+N-1]</code> : 能用于那些要被立即发送的分组；</li><li><code>[base+N,end]</code> : 不能使用；</li></ul><p>那些已被发送但还未被确认的分组的许可序号范围可以被看成一个在序号范围内长度未 N 的窗口。随着协议的运行，该窗口在序号空间向前滑动。因此，N 常被称为<strong>窗口长度（window size）</strong>，GBN 协议也常被称为<strong>滑动窗口协议（sliding-window protocol）</strong>。</p><p>为一个基于 ACK、无 NAK 的 GBN 协议的发送方和接收方两端的扩展 FSM 描述，因为加入了变量 base 和 nextseqnum 所以我们称其为扩展 FSM，下图为发送端的扩展 FSM 描述：</p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/b1d24272c4eb489eb7f3e9be35f1252a.png" alt="img" style="zoom:67%;"><p>下图为接收端的 FSM 描述：</p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/94f1de56c6824d3787692a9893f10377.png" alt="img" style="zoom:67%;"><p>在 GBN 协议中，接收方丢弃所有失序分组。这种方法的优点是接收缓存简单，即接收方不需要缓存任何失序分组。因此，虽然发送方必须维护窗口的上下边界及 nextseqnum 在该窗口的位置，但接收方需要维护的唯一信息就是下一个按序接收的分组序号。运行中的 GBN 如下图所示：</p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/b362e621d7fb45c494a143c840ed82c9.png" alt="img" style="zoom:50%;"><p>回退 N 帧(Go-Back-N)的优缺点</p><ul><li>优点:接收方丢弃所有失序分组，简单</li><li>缺点:发送方必须重发那些失序分组(哪怕这些分组正确到达接收方)，但重发可能丢失或出错，而需要更多重发，当通信线路质量不好时，GBN 协议会带来负面的影响。</li></ul><h3 id="_3-4-4-选择重传" tabindex="-1"><a class="header-anchor" href="#_3-4-4-选择重传"><span>3.4.4 选择重传</span></a></h3><blockquote><p>Selective Repeat，SR</p></blockquote><p>在 GBN 发送方有窗口 N 的基础上，接收方同时维护一个窗口 N，下图为 SR 发送方和接收方的序号空间：</p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/bcfca7471b0846f0a73c2d897059d963.png" alt="img" style="zoom:50%;"><ul><li>对于发送方 <ul><li>上层有数据需要发送:如果发送窗口未满，发送分组，缓存未收已发送未收到确认的分组</li><li>timeout(n): 重发分组 n，重启定时器</li><li>ACK(n)落在[sendbase,sendbase+N]: 表明序号为 n 的分组已经收到，如果 n=sendbase，向前滑动窗口 sendbase 指针到是当前最小的未被确认的分组序号</li><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230504214907716.png" alt="image-20230504214907716"></li></ul></li><li>对于接收方 <ul><li>分组 n 落在[rcvbase, rcvbase+N-1]且被正确接收: 发送 ACK(n) <ul><li>新分组:缓存</li><li>分组序号=rcv_base: 该分组与 rcv_base 序号之后的，之前缓存的连续分组，交付到上层,向前滑动窗口到下一个未收到分组的序号</li></ul></li><li>分组 n 落在[rcvbase-N,rcvbase-1]且被正确接收: ACK(m)，表明这是之前已经确认过的分组</li><li>其他: 忽略</li></ul></li></ul><p>SR 具体操作如下：</p><img src="https://img-blog.csdnimg.cn/5a52a266c8dd4d508c322907882c19cf.png#pic_center" alt="img" style="zoom:50%;"><h2 id="_3-5-面向连接的运输-tcp" tabindex="-1"><a class="header-anchor" href="#_3-5-面向连接的运输-tcp"><span>3.5 面向连接的运输：TCP</span></a></h2><blockquote><p>Connection-Oriented Transport: TCP</p></blockquote><h3 id="_3-5-1-tcp-连接" tabindex="-1"><a class="header-anchor" href="#_3-5-1-tcp-连接"><span>3.5.1 TCP 连接</span></a></h3><blockquote><p>TCP Connection</p></blockquote><ul><li><strong>面向连接（connection-oriented）</strong>：相互发送预备报文段，以建立确保数据传输的参数</li><li><strong>全双工服务（full-duplex service）</strong>：如果一台主机上的进程 A 与另一台主机上的进程 B 存在一条 TCP 连接，那么应用层数据就可以在从进程 B 流向进程 A 的同时，也从进程 A 流向进程 B</li><li><strong>点对点（point-to-point）</strong>：即在单个发送方与单个接收方之间的连接</li><li><strong>三次握手（three-way handshake）</strong>：客户先发送一个特殊 TCP 报文段，服务器用另一个特殊的 TCP 报文段来响应，最后客户再用第三个特殊报文段作为响应</li></ul><p>客户进程通过套接字，TCP 会将要发送的数据引导到该连接的发送缓存（send buffer），发送缓存是发起三次握手期间设置的缓存之一，TCP 发送缓存与接收缓存如下图所示：</p><p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/a34dd3884b8c4be99188e80061ea4b53.png" alt="img"></p><p>TCP 可以从缓存中取出并放入报文段中数据数量限制于<strong>最大报文段长度（Maximum Segment Size，MSS）</strong>，MSS 通常根据最初确认的由本地发送主机发送的最大链路层帧长度（即所谓的<strong>最大传输单元（Maximum Transmission Unit，MTU）</strong>）来设置。</p><h3 id="_3-5-2-tcp-报文段结构" tabindex="-1"><a class="header-anchor" href="#_3-5-2-tcp-报文段结构"><span>3.5.2 TCP 报文段结构</span></a></h3><blockquote><p>TCP Segment Structure</p></blockquote><p>TCP 报文段结构如下图：</p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/6be34602716c4c1aa4d64f6e5d944f9b.png" alt="img" style="zoom:50%;"><p>与 UDP 一样，首部包括<strong>源端口号（Source port）和目的端口号（Dest port）</strong>，它被用于多路复用和多路分解来自或送到上层应用的数据，也包括<strong>检验和字段（Internet checksum）</strong>，首部还包括以下字段：</p><ul><li>32bit 的<strong>序号字段（Sequence number）和 32bit 的确认号字段（Acknowledgement number）</strong>；</li><li>16bit 的<strong>接受窗字段（Receive window）</strong>：用于控制流量；</li><li>4bit 的<strong>首部长度字段（Header length）</strong>：指示了以 32bit 的字为单位的 TCP 首部长度；</li><li>可选和变长的<strong>选项字段（Options）</strong>：用于发送方与接收方协商最大报文段长度（MSS）时，或在高速网络环境下用作窗口调节因子时使用；</li><li>6bit 的<strong>标志字段（flag field）</strong>： <ul><li><code>ACK</code>：确认字段中的值是否有效；</li><li><code>RST</code>,<code>SYN</code>,<code>FIN</code>：用于连接建立和拆除；</li><li><code>CWR</code>,<code>ECE</code>：在明确拥塞通过中使用；</li><li><code>PSH</code>：被置位时，指示接收方立即将数据交给上层；</li><li><code>URG</code>：指示报文段中存放着被发送端上层实体置为“紧急”的数据；</li></ul></li><li>16bit 的<strong>紧急数据指针字段（Urgent data point）</strong>：指出紧急数据的最后一个字节；</li></ul><h4 id="序号和确认号" tabindex="-1"><a class="header-anchor" href="#序号和确认号"><span>序号和确认号</span></a></h4><blockquote><p>Sequence number and Acknowledgement number</p></blockquote><p>一个<strong>报文段的序号（sequence number for a segment）</strong> 是该报文段首字节的字节流编号，而不是建立在传送的报文段的序列之上</p><p>TCP 是全双工的，因此主机 A 在向主机 B 发送数据的同时，也许也接收来自主机 B 的数据。从主机 B 到达的每个报文段都有一个序号用于从 B 流向 A 的数据。主机 A 填充进报文段的确认号是主机 A 期望从主机 B 收到的下一字节的序号。如下图所示：</p><p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/618fe38dfdda4c82ace00b4779d46f57.png" alt="img"></p><h3 id="_3-5-3-往返时间的估计与超时" tabindex="-1"><a class="header-anchor" href="#_3-5-3-往返时间的估计与超时"><span>3.5.3 往返时间的估计与超时</span></a></h3><blockquote><p>Round-Trip Time Estimation and Timeout</p></blockquote><h4 id="估计往返时间" tabindex="-1"><a class="header-anchor" href="#估计往返时间"><span>估计往返时间</span></a></h4><ol><li><p>报文段的样本 RTT（表示为 SampleRTT），在任意时刻，仅为一个已发送的但目前尚未确认的报文段估计 SampleRTT，从而产生一个接近每个 RTT 的新 SampleRTT 值。另外，TCP 绝不为已重传的报文段计算 SampleRTT；它仅为传输一次的报文段测量。</p></li><li><p>TCP 维持一个<strong>SampleRTT 均值</strong>（称为<!---->），EstimatedRTT 更新方式如下：</p><ul><li><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="#66ccff"><mi>E</mi><mi>s</mi><mi>t</mi><mi>i</mi><mi>m</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>d</mi><mi>R</mi><mi>T</mi><mi>T</mi><mo>=</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>α</mi><mo stretchy="false">)</mo><mo>×</mo><mi>E</mi><mi>s</mi><mi>t</mi><mi>i</mi><mi>m</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>d</mi><mi>R</mi><mi>T</mi><mi>T</mi><mo>+</mo><mi>α</mi><mo>×</mo><mi>S</mi><mi>a</mi><mi>m</mi><mi>p</mi><mi>l</mi><mi>e</mi><mi>R</mi><mi>T</mi><mi>T</mi><mo separator="true">;</mo><mspace width="1em"></mspace><mi>α</mi><mtext>推荐值为</mtext><mi>α</mi><mo>=</mo><mn>0.125</mn></mstyle></mrow><annotation encoding="application/x-tex">\textcolor{#66ccff}{EstimatedRTT=(1-\alpha)\times EstimatedRTT+\alpha\times SampleRTT;\quad \alpha推荐值为\alpha=0.125}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;color:#66ccff;">E</span><span class="mord mathnormal" style="color:#66ccff;">s</span><span class="mord mathnormal" style="color:#66ccff;">t</span><span class="mord mathnormal" style="color:#66ccff;">ima</span><span class="mord mathnormal" style="color:#66ccff;">t</span><span class="mord mathnormal" style="color:#66ccff;">e</span><span class="mord mathnormal" style="color:#66ccff;">d</span><span class="mord mathnormal" style="margin-right:0.13889em;color:#66ccff;">RTT</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel" style="color:#66ccff;">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen" style="color:#66ccff;">(</span><span class="mord" style="color:#66ccff;">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin" style="color:#66ccff;">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;color:#66ccff;">α</span><span class="mclose" style="color:#66ccff;">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin" style="color:#66ccff;">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;color:#66ccff;">E</span><span class="mord mathnormal" style="color:#66ccff;">s</span><span class="mord mathnormal" style="color:#66ccff;">t</span><span class="mord mathnormal" style="color:#66ccff;">ima</span><span class="mord mathnormal" style="color:#66ccff;">t</span><span class="mord mathnormal" style="color:#66ccff;">e</span><span class="mord mathnormal" style="color:#66ccff;">d</span><span class="mord mathnormal" style="margin-right:0.13889em;color:#66ccff;">RTT</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin" style="color:#66ccff;">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;color:#66ccff;">α</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin" style="color:#66ccff;">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;color:#66ccff;">S</span><span class="mord mathnormal" style="color:#66ccff;">am</span><span class="mord mathnormal" style="margin-right:0.01968em;color:#66ccff;">pl</span><span class="mord mathnormal" style="color:#66ccff;">e</span><span class="mord mathnormal" style="margin-right:0.13889em;color:#66ccff;">RTT</span><span class="mpunct" style="color:#66ccff;">;</span><span class="mspace" style="color:#66ccff;margin-right:1em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;color:#66ccff;">α</span><span class="mord cjk_fallback" style="color:#66ccff;">推荐值为</span><span class="mord mathnormal" style="margin-right:0.0037em;color:#66ccff;">α</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel" style="color:#66ccff;">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord" style="color:#66ccff;">0.125</span></span></span></span></p></li><li><p>这种平均方法被称为指<strong>数加权移动平均（Exponential Weighted Moving Average，EWMA）</strong>。</p></li></ul></li><li><p>定义 RTT 偏差<!---->，用于估算 SampleRTT 一般会偏离 EstimatedRTT 的程度：</p><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="#66ccff"><mi>D</mi><mi>e</mi><mi>v</mi><mi>R</mi><mi>T</mi><mi>T</mi><mo>=</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>β</mi><mo stretchy="false">)</mo><mo>×</mo><mi>D</mi><mi>e</mi><mi>v</mi><mi>R</mi><mi>T</mi><mi>T</mi><mo>+</mo><mi>β</mi><mo>×</mo><mi mathvariant="normal">∣</mi><mi>S</mi><mi>a</mi><mi>m</mi><mi>p</mi><mi>l</mi><mi>e</mi><mi>R</mi><mi>T</mi><mi>T</mi><mo>−</mo><mi>E</mi><mi>s</mi><mi>t</mi><mi>i</mi><mi>m</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>d</mi><mi>R</mi><mi>T</mi><mi>T</mi><mi mathvariant="normal">∣</mi><mo separator="true">;</mo><mspace width="1em"></mspace><mi>β</mi><mtext>推荐值</mtext><mi>β</mi><mo>=</mo><mn>0.25</mn></mstyle></mrow><annotation encoding="application/x-tex">\textcolor{#66ccff}{DevRTT=(1-\beta)\times DevRTT+\beta\times |SampleRTT-EstimatedRTT|;\quad \beta推荐值\beta=0.25}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="color:#66ccff;">De</span><span class="mord mathnormal" style="margin-right:0.03588em;color:#66ccff;">v</span><span class="mord mathnormal" style="margin-right:0.13889em;color:#66ccff;">RTT</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel" style="color:#66ccff;">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen" style="color:#66ccff;">(</span><span class="mord" style="color:#66ccff;">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin" style="color:#66ccff;">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;color:#66ccff;">β</span><span class="mclose" style="color:#66ccff;">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin" style="color:#66ccff;">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="color:#66ccff;">De</span><span class="mord mathnormal" style="margin-right:0.03588em;color:#66ccff;">v</span><span class="mord mathnormal" style="margin-right:0.13889em;color:#66ccff;">RTT</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin" style="color:#66ccff;">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;color:#66ccff;">β</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin" style="color:#66ccff;">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord" style="color:#66ccff;">∣</span><span class="mord mathnormal" style="margin-right:0.05764em;color:#66ccff;">S</span><span class="mord mathnormal" style="color:#66ccff;">am</span><span class="mord mathnormal" style="margin-right:0.01968em;color:#66ccff;">pl</span><span class="mord mathnormal" style="color:#66ccff;">e</span><span class="mord mathnormal" style="margin-right:0.13889em;color:#66ccff;">RTT</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin" style="color:#66ccff;">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;color:#66ccff;">E</span><span class="mord mathnormal" style="color:#66ccff;">s</span><span class="mord mathnormal" style="color:#66ccff;">t</span><span class="mord mathnormal" style="color:#66ccff;">ima</span><span class="mord mathnormal" style="color:#66ccff;">t</span><span class="mord mathnormal" style="color:#66ccff;">e</span><span class="mord mathnormal" style="color:#66ccff;">d</span><span class="mord mathnormal" style="margin-right:0.13889em;color:#66ccff;">RTT</span><span class="mord" style="color:#66ccff;">∣</span><span class="mpunct" style="color:#66ccff;">;</span><span class="mspace" style="color:#66ccff;margin-right:1em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;color:#66ccff;">β</span><span class="mord cjk_fallback" style="color:#66ccff;">推荐值</span><span class="mord mathnormal" style="margin-right:0.05278em;color:#66ccff;">β</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel" style="color:#66ccff;">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord" style="color:#66ccff;">0.25</span></span></span></span></li><li>RTTD 初值取为测量到的 RTT 样本值的一半</li></ul></li></ol><h4 id="设置和管理重传超时间隔" tabindex="-1"><a class="header-anchor" href="#设置和管理重传超时间隔"><span>设置和管理重传超时间隔</span></a></h4><p>超时重发时间(<!---->)应该大于等于 EstimatedRTT，否则，将造成不必要的重传。</p><p>在 TCP 确定重传超时间隔的设置方法如下：</p><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="#66ccff"><mrow><mi>T</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>o</mi><mi>u</mi><mi>t</mi><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>a</mi><mi>l</mi><mi mathvariant="normal">/</mi><mi>R</mi><mi>T</mi><mi>O</mi></mrow><mo>=</mo><mi>E</mi><mi>s</mi><mi>t</mi><mi>i</mi><mi>m</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>d</mi><mi>R</mi><mi>T</mi><mi>T</mi><mo>+</mo><mn>4</mn><mo>×</mo><mi>D</mi><mi>e</mi><mi>v</mi><mi>R</mi><mi>T</mi><mi>T</mi></mstyle></mrow><annotation encoding="application/x-tex">\textcolor{#66ccff}{{TimeoutInterval / RTO} = EstimatedRTT + 4\times DevRTT}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord" style="color:#66ccff;"><span class="mord mathnormal" style="margin-right:0.13889em;color:#66ccff;">T</span><span class="mord mathnormal" style="color:#66ccff;">im</span><span class="mord mathnormal" style="color:#66ccff;">eo</span><span class="mord mathnormal" style="color:#66ccff;">u</span><span class="mord mathnormal" style="color:#66ccff;">t</span><span class="mord mathnormal" style="margin-right:0.07847em;color:#66ccff;">I</span><span class="mord mathnormal" style="color:#66ccff;">n</span><span class="mord mathnormal" style="color:#66ccff;">t</span><span class="mord mathnormal" style="margin-right:0.02778em;color:#66ccff;">er</span><span class="mord mathnormal" style="margin-right:0.03588em;color:#66ccff;">v</span><span class="mord mathnormal" style="color:#66ccff;">a</span><span class="mord mathnormal" style="margin-right:0.01968em;color:#66ccff;">l</span><span class="mord" style="color:#66ccff;">/</span><span class="mord mathnormal" style="margin-right:0.02778em;color:#66ccff;">RTO</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel" style="color:#66ccff;">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;color:#66ccff;">E</span><span class="mord mathnormal" style="color:#66ccff;">s</span><span class="mord mathnormal" style="color:#66ccff;">t</span><span class="mord mathnormal" style="color:#66ccff;">ima</span><span class="mord mathnormal" style="color:#66ccff;">t</span><span class="mord mathnormal" style="color:#66ccff;">e</span><span class="mord mathnormal" style="color:#66ccff;">d</span><span class="mord mathnormal" style="margin-right:0.13889em;color:#66ccff;">RTT</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin" style="color:#66ccff;">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord" style="color:#66ccff;">4</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin" style="color:#66ccff;">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="color:#66ccff;">De</span><span class="mord mathnormal" style="margin-right:0.03588em;color:#66ccff;">v</span><span class="mord mathnormal" style="margin-right:0.13889em;color:#66ccff;">RTT</span></span></span></span></li></ul><p>超时重传</p><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="#66ccff"><mi>T</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>o</mi><mi>u</mi><mi>t</mi><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>a</mi><mi>l</mi><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo><mo>=</mo><mi>γ</mi><mo>∗</mo><mi>T</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>o</mi><mi>u</mi><mi>t</mi><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>a</mi><mi>l</mi><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mstyle><mo separator="true">;</mo><mspace width="1em"></mspace><mi>γ</mi><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">\textcolor{#66ccff}{TimeoutInterval(i)=\gamma*TimeoutInterval(i)};\quad \gamma =2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;color:#66ccff;">T</span><span class="mord mathnormal" style="color:#66ccff;">im</span><span class="mord mathnormal" style="color:#66ccff;">eo</span><span class="mord mathnormal" style="color:#66ccff;">u</span><span class="mord mathnormal" style="color:#66ccff;">t</span><span class="mord mathnormal" style="margin-right:0.07847em;color:#66ccff;">I</span><span class="mord mathnormal" style="color:#66ccff;">n</span><span class="mord mathnormal" style="color:#66ccff;">t</span><span class="mord mathnormal" style="margin-right:0.02778em;color:#66ccff;">er</span><span class="mord mathnormal" style="margin-right:0.03588em;color:#66ccff;">v</span><span class="mord mathnormal" style="color:#66ccff;">a</span><span class="mord mathnormal" style="margin-right:0.01968em;color:#66ccff;">l</span><span class="mopen" style="color:#66ccff;">(</span><span class="mord mathnormal" style="color:#66ccff;">i</span><span class="mclose" style="color:#66ccff;">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel" style="color:#66ccff;">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6597em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;color:#66ccff;">γ</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin" style="color:#66ccff;">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;color:#66ccff;">T</span><span class="mord mathnormal" style="color:#66ccff;">im</span><span class="mord mathnormal" style="color:#66ccff;">eo</span><span class="mord mathnormal" style="color:#66ccff;">u</span><span class="mord mathnormal" style="color:#66ccff;">t</span><span class="mord mathnormal" style="margin-right:0.07847em;color:#66ccff;">I</span><span class="mord mathnormal" style="color:#66ccff;">n</span><span class="mord mathnormal" style="color:#66ccff;">t</span><span class="mord mathnormal" style="margin-right:0.02778em;color:#66ccff;">er</span><span class="mord mathnormal" style="margin-right:0.03588em;color:#66ccff;">v</span><span class="mord mathnormal" style="color:#66ccff;">a</span><span class="mord mathnormal" style="margin-right:0.01968em;color:#66ccff;">l</span><span class="mopen" style="color:#66ccff;">(</span><span class="mord mathnormal" style="color:#66ccff;">i</span><span class="mclose" style="color:#66ccff;">)</span><span class="mpunct">;</span><span class="mspace" style="margin-right:1em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span></li></ul><h3 id="_3-5-4-可靠数据传输" tabindex="-1"><a class="header-anchor" href="#_3-5-4-可靠数据传输"><span>3.5.4 可靠数据传输</span></a></h3><blockquote><p>Reliable Data Transfer</p></blockquote><p>TCP 在 IP 不可靠的尽力而为服务之上创建了一种<strong>可靠数据传输服务（reliable data transfer service）</strong>。为了减少多个定时器管理带来的相当大的开销，TCP 在即使有多个已发送但未确认的报文段的情况下，定时器的管理过程仅使用==<strong>单一</strong>== 的定时器。</p><p>简化的 TCP 发送方如下：</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-java"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">/* Assume sender is not constrained by TCP flow or congestion control, that data from above is less than MSS in size, and that data transfer is in one direction only. */</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">NextSeqNum</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">InitialSeqNumber</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">SendBase</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">InitialSeqNumber</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">loop</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> (</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">forever</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    switch</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">event</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        event</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">:</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> data received from application above</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">            create TCP segment with sequence number NextSeqNum</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">            if</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> (</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">timer currently not running</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">             start timer</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">            pass segment to IP</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">            NextSeqNum</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">NextSeqNum</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">+</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">length</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">data</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">            break</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        event</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">:</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> timer timeout</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">            retransmit not</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">-</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">yet</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">-</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">acknowledged segment with smallest sequence number</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">            start timer</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">            break</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        event</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">:</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> ACK received</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> with ACK field value of y</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">            if</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> (</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">y </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> SendBase</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">                SendBase</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">y</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">                if</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> (</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">there are currently any not</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">-</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">yet</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">-</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">acknowledged segments</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">                 start timer</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">            }</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">      break</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> /* end of loop forever */</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="超时间隔加倍" tabindex="-1"><a class="header-anchor" href="#超时间隔加倍"><span>超时间隔加倍</span></a></h4><p>当发生超时事件时，TCP 重传时都会将下一次的超时间隔设为先前值的两倍；当发生其他两个事件计时器重启时，TimeoutInterval 由最近的 EstimatedRTT 值与 DevRTT 值推算得到。这种修改提供了一个形式受限的拥塞控制。</p><h4 id="快速重传" tabindex="-1"><a class="header-anchor" href="#快速重传"><span>快速重传</span></a></h4><p>当比期望序号大的失序报文段到达，接收方立即发送<strong>冗余 ACK（duplicate ACK）</strong>，指示下一个期待字节的序号（其为间隔的低端的序号）。如果 TCP 发送方接收到对相同数据的 3 个冗余 ACK，TCP 就执行<strong>快速重传（fast retransmit）</strong>，即在该报文段的定时器过期之前重传丢失的报文段。快速重传示例如下图：</p><img src="https://img-blog.csdnimg.cn/b993d19d459849e59f57cb06c54ed303.png#pic_center" alt="img" style="zoom:50%;"><h4 id="选择确认" tabindex="-1"><a class="header-anchor" href="#选择确认"><span>选择确认</span></a></h4><blockquote><p>selective acknowledgment</p></blockquote><p>允许 TCP 接收方有选择地确认失序报文段，而不是积累地确认最后一个正确接收的有序报文。当该机制与选择重传机制结合起来使用时，TCP 看起来就很像通常的 SR 协议。因此，TCP 的差错恢复机制最好分类为 GBN 协议与 SR 协议的混合体。</p><h3 id="_3-5-5-流量控制" tabindex="-1"><a class="header-anchor" href="#_3-5-5-流量控制"><span>3.5.5 流量控制</span></a></h3><blockquote><p>Flow Control</p></blockquote><p>TCP 通过让发送方维护一个称为<strong>接收窗口（receive window）</strong> 的变量来提供流量控制。通俗的说，接收窗口用于给发送方一个指示——该接收方还有多少可用的缓存空间。因为 TCP 是全双工通信，在连接两端的发送方都各自维护一个接收窗口。</p><p>接收窗口（rwnd）和接收缓存（RcvBuffer）如下图所示：</p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/1b2ccecea2954407a8f831e6c3f6b713.png" alt="img" style="zoom:50%;"><h3 id="_3-5-6-tcp-连接管理" tabindex="-1"><a class="header-anchor" href="#_3-5-6-tcp-连接管理"><span>3.5.6 TCP 连接管理</span></a></h3><blockquote><p>TCP Connection Management</p></blockquote><h4 id="三次握手连接" tabindex="-1"><a class="header-anchor" href="#三次握手连接"><span>三次握手连接</span></a></h4><blockquote><p>three-way handshake</p></blockquote><p>TCP 三次握手：报文交换交换过程如下：</p><p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230504221906770.png" alt="image-20230504221906770"></p><ul><li>TCP 规定: <ul><li>SYN 报文段和 SYN+ACK 报文段都不能携带数据，但要消耗一个序号</li><li>ACK 报文段可以携带数据，但如果不携带数据，则不消耗序号，其序号下一个数据报文段仍可使用。</li></ul></li></ul><h4 id="四次握手关闭" tabindex="-1"><a class="header-anchor" href="#四次握手关闭"><span>四次握手关闭</span></a></h4><blockquote><p>four-way handshake</p></blockquote><p>由客户端关闭一条 TCP 连接的四次握手过程如下：</p><p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230504222156848.png" alt="image-20230504222156848"></p><h4 id="tcp-状态" tabindex="-1"><a class="header-anchor" href="#tcp-状态"><span>TCP 状态</span></a></h4><blockquote><p>TCP State</p></blockquote><p>客户 TCP 经历的典型的 TCP 状态序列如下图：</p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/9cb1134e28494a6ba1173402142a581a.png" alt="img" style="zoom:50%;"><ul><li>ESTABLISHED 状态：已建立连接状态，TCP 客户能发送和接收包含有效载荷数据；</li></ul><p>服务器端 TCP 经历的典型的 TCP 状态序列如下图：</p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/99e6420761a544e1b83a0254da082195.png" alt="img" style="zoom:50%;"><h2 id="_3-6-拥塞控制原理-略" tabindex="-1"><a class="header-anchor" href="#_3-6-拥塞控制原理-略"><span>3.6 拥塞控制原理&lt;略&gt;</span></a></h2><blockquote><p>Principles of Congestion Control</p></blockquote><h3 id="_3-6-1-拥塞原因与代价" tabindex="-1"><a class="header-anchor" href="#_3-6-1-拥塞原因与代价"><span>3.6.1 拥塞原因与代价</span></a></h3><blockquote><p>The Causes and the Costs of Congestion</p></blockquote><ul><li>当分组的到达速率接近链路容量时，分组经历巨大的排队时延；</li><li>发送方在遇到大时延时所进行的不必要重传会引起路由器利用其链路带宽来转发不必要的分组副本；</li><li>当一个分组沿一条路径被丢弃时，每个上游路由器用于转发该分组到丢弃该分组而使用的传输容量最终被浪费掉；</li></ul><h3 id="_3-6-2-拥塞控制方法" tabindex="-1"><a class="header-anchor" href="#_3-6-2-拥塞控制方法"><span>3.6.2 拥塞控制方法</span></a></h3><blockquote><p>Approaches to Congestion Control</p></blockquote><ul><li><strong>端到端拥塞控制（End-to-end congestion control）</strong>：在端到端拥塞控制方法中，网络层没有为运输层拥塞控制显示支持。即使网络中存在拥塞，端系统也必须通过对网络行为的观察来判断；</li><li><strong>网络辅助的拥塞控制（Network-assisted congestion control）</strong>：网络辅助的拥塞控制中，路由器向发送方提供关于网络中拥塞状态的显示反馈信息；</li></ul><h2 id="_3-7-tcp-拥塞控制" tabindex="-1"><a class="header-anchor" href="#_3-7-tcp-拥塞控制"><span>3.7 TCP 拥塞控制</span></a></h2><blockquote><p>TCP Congestion Control</p></blockquote><ul><li>运行在发送方的 TCP 拥塞控制机制跟踪一个额外的变量，即<!---->。</li><li>拥塞窗口对一个 TCP 发送方能向网络中发送流量的速率进行限制。发送方中未被确认的数据量不会超过 cwnd 和 rwnd 中的最小值，即： $ LastByteSent-LastByteACK\le \min{cwnd,rwnd}$</li></ul><p>因为 TCP 使用确认来触发（或计时）增大它的拥塞窗口长度，TCP 被说成是自计时（self-clocking）的。TCP 基于本地信息设置它们的发送速率的指导性原则：</p><ul><li>一个丢失的报文段表意味着拥塞，因此当丢失报文段时应当降低 TCP 发送方的速率；</li><li>一个确认报文段指示该网络正在向接收方交付发送方的报文段，因此，当对先前未确认报文段的确认到达时，能够增加发送方的速率；</li><li>带宽探测；</li></ul><h3 id="_3-7-1-tcp-拥塞控制算法" tabindex="-1"><a class="header-anchor" href="#_3-7-1-tcp-拥塞控制算法"><span>3.7.1 TCP 拥塞控制算法</span></a></h3><blockquote><p>TCP congestion control algorithm</p></blockquote><p>该算法主要包括 3 个部分：<strong>慢启动（slow-start）</strong>、<strong>拥塞避免（congestion avoidance）</strong>、<strong>快速恢复（fast recovery）</strong>。</p><ol><li><!---->状态，cwnd 的值以 1 个 MSS 开始, 并且每当传输的报文段首次被确认就增加 1 个 MSS, 这样, 每经过一个 RTT, cwnd 加倍<ul><li>TCP 发送速率起始很慢，但在慢启动阶段以<strong>指数增长</strong></li><li>TCP 慢启动如下图所示： <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/4f2bd17ca2d246d7b21cb6899ba4784e.png" alt="img" style="zoom:50%;"></li></ul></li><li><p>慢启动的结束</p><ul><li>引入<!---->, ssthresh 在 TCP 初始化时被设置成一个很大的值(通常为 65KB)</li><li>当 cwnd&gt;=ssthresh 时, 发送方进入<!---->状态</li><li>超时事件发生: <ol><li>ssthresh=当前 cwnd 值/2，cwnd =1 MSS;</li><li>重新进入<strong>慢启动</strong>状态</li></ol></li><li>收到 3 个冗余的 ACK: <ol><li>ssthresh=当前 cwnd 值/2，cwnd=ssthresh+3*MSS</li><li>发送方<strong>快速重发</strong>那些导致冗余 ACK 的丢失分组，进入<strong>快速恢复</strong>状态</li></ol></li></ul></li><li><!----> : 当收到三个相同的冗余 ACK 时, 不等待定时器超时, 而是直接重发引发冗余 ACK 的对应分组</li><li><!----><ul><li>每经过一个传输轮次(RTT)，cwnd 只增加 1MSS,cwnd 呈线性增长 <ul><li>具体实现时常用的计算方法:收到一个对先前未确认报文段的确认，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>w</mi><mi>n</mi><mi>d</mi><mo>=</mo><mi>c</mi><mi>w</mi><mi>n</mi><mi>d</mi><mo>+</mo><mi>M</mi><mi>S</mi><mi>S</mi><mo>∗</mo><mo stretchy="false">(</mo><mi>M</mi><mi>s</mi><mi>s</mi><mi mathvariant="normal">/</mi><mi>c</mi><mi>w</mi><mi>n</mi><mi>d</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">cwnd=cwnd+MSS* (Mss/ cwnd)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">c</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">c</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">MSS</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal">ss</span><span class="mord">/</span><span class="mord mathnormal">c</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mclose">)</span></span></span></span></li></ul></li><li>如何结束拥塞避免? <ul><li>超时事件发生: <ul><li><code>ssthresh=当前cwnd值/2</code>，cwnd= 1MSS; 重新进入慢启动状态</li></ul></li><li>收到 3 个冗余的 ACK: <!----><ul><li><code>ssthresh=当前cwnd值/2</code>，cwnd=ssthresh+3*MSS</li><li>发送方快速重发那些导致冗余 ACK 的丢失分组，进入快速恢复状态</li></ul></li></ul></li></ul></li><li><!----><ul><li>快速恢复 : 收到冗余 ACK, cwnd=cwnd+ 1MSS</li><li>如何结束快速恢复? <ul><li>超时事件发生: <ul><li>ssthresh=当前 cwnd 值/2，cwnd= 1 MSS;</li><li>重新进入慢启动状态</li></ul></li><li>收到一个对先前未确认报文段的确认: <ul><li>降低 cwnd，cwnd=ssthresh</li><li>进入拥塞避免状态</li></ul></li></ul></li></ul></li><li><p>三个状态变换 FSM 如下图：</p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230413105127542.png" alt="image-20230413105127542" style="zoom:50%;"></li><li><p>拥塞控制方式</p><ul><li>加性增、乘性减（Additive-Increase，Multiplicative-Decrease，AIMD）</li><li><mark>加性增</mark> :在拥塞避免阶段，每一个 RTT 时间后，拥塞窗口(cwnd)值增加一个 MSS(最大报文段长度)，直到检测到丢包</li><li><mark>乘性减</mark> :丢包后将拥塞窗口(cwnd)减少到原来的一半</li><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230617121533518.png" alt="image-20230617121533518"></li></ul></li></ol><h4 id="对-tcp-吞吐量的宏观描述" tabindex="-1"><a class="header-anchor" href="#对-tcp-吞吐量的宏观描述"><span>对 TCP 吞吐量的宏观描述</span></a></h4><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>一条连接的平均吞吐量</mtext><mo>=</mo><mfrac><mrow><mn>0.75</mn><mo>×</mo><mi>W</mi></mrow><mrow><mi>R</mi><mi>R</mi><mi>T</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">一条连接的平均吞吐量=\frac{0.75\times W}{RRT}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">一条连接的平均吞吐量</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2173em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8723em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">RRT</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0.75</span><span class="mbin mtight">×</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">W</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p><h1 id="第四章-网络层" tabindex="-1"><a class="header-anchor" href="#第四章-网络层"><span>第四章 网络层</span></a></h1><h2 id="_4-1-概述" tabindex="-1"><a class="header-anchor" href="#_4-1-概述"><span>4.1 概述</span></a></h2><ol><li><p>网络层: 从发送主机到接收主机传输数据段</p><ul><li>发送端: 将数据段封装到数据报</li><li>接收端: 向传输层交付数据段</li><li>网络层协议运行于每一台主机/路由器中 <ul><li>路由器检查所有通过他的 IP 数据报首部字段</li></ul></li></ul></li><li><p>网络层核心功能–转发与路由</p><ul><li><p>转发: 将分组从<strong>路由器输入</strong>端口移动到适当的<strong>路由器输出</strong>端口</p></li><li><p>路由选择: 决定分组从原到目的地所采用的路径 — 路径选择算法</p></li></ul></li></ol><h3 id="_4-1-2-连接建立" tabindex="-1"><a class="header-anchor" href="#_4-1-2-连接建立"><span>4.1.2 连接建立</span></a></h3><ul><li>在某些网络体系结构中第三个核心功能: <ul><li>ATM,帧中继,X.25</li></ul></li><li>在数据分组传输之前，两台主机之间需要创建虚拟连接 <ul><li>路由器参与连接建立</li></ul></li><li>网络层和运输层的连接服务的对比: <ul><li>网络层:在两台主机之间</li><li>传输层:在两个进程之间</li></ul></li></ul><h3 id="_4-1-3-网络层服务模型" tabindex="-1"><a class="header-anchor" href="#_4-1-3-网络层服务模型"><span>4.1.3 网络层服务模型</span></a></h3><ol><li><p>网络层为传输层提供什么样的服务</p><ul><li><p>对于单个分组</p><ul><li>确保交付</li><li>具有时延上界的确保交付</li></ul></li><li><p>对分组流</p><ul><li>有序分组交付 <ul><li>确保最小带宽</li><li>确保最大时延抖动</li><li>安全性服务</li></ul></li></ul></li></ul></li><li><p>几种服务模型</p><table><thead><tr><th>网络体系结构</th><th>服务模型</th><th>带宽保证</th><th>无丢包保证</th><th>有序</th><th>有时</th><th>拥塞指示</th></tr></thead><tbody><tr><td>因特网</td><td>尽力而为</td><td>无</td><td>无</td><td>任何可能的顺序</td><td>不维护</td><td>无</td></tr><tr><td>ATM<br>Asynchronous Transfer Mode<br>异步传输模式</td><td>CBR<br>Constant Bit Rate</td><td>保证恒定速率</td><td>是</td><td>有序</td><td>维护</td><td>拥塞不出现</td></tr><tr><td>ATM</td><td>ABR<br>Available Bit Rate</td><td>保证最小速率</td><td>无</td><td>有序</td><td>不维护</td><td>提供拥塞提示</td></tr></tbody></table><ul><li>ATM 使用虚电路建立数据传输通道, TCP/IP 协议取代了 ATM 在某些领域的应用 但是如需要高带宽、低延迟和可靠性高的数据传输 (如视频传输、实时通信等) 的业务中，ATM 技术仍然具有优势。</li></ul></li><li><p>网络体系结构中, 网络层提供的服务类型可以归纳为两类</p><ul><li>无连接服务—数据报网络</li><li>有连接服务—虚电路网络</li></ul></li><li><p>网络层服务与运输层的区别</p><ul><li>网络层:提供主机到主机的服务，在端系统和网络核心实现</li><li>传输层:进程到进程的服务，仅在端系统实现</li></ul></li></ol><h2 id="_4-2-虚电路和数据报网络" tabindex="-1"><a class="header-anchor" href="#_4-2-虚电路和数据报网络"><span>4.2 虚电路和数据报网络</span></a></h2><blockquote><p>虚电路网络提供网络层连接服务</p><p>数据报网络提供网络层无连接服务</p><p>与运输层服务的类比:</p><ul><li>服务:主机到主机</li><li>实现:在网络核心实现</li></ul></blockquote><h3 id="_4-2-1-虚电路网络" tabindex="-1"><a class="header-anchor" href="#_4-2-1-虚电路网络"><span>4.2.1 虚电路网络</span></a></h3><ol><li><!----> (Virtual Circuit, <!---->)<ul><li><p>从源端到目的端，建立的一条类似于电路交换的路径，路径上的每一个路由器，维护虚电路的连接状态</p></li><li><p>数据传输采用分组交换形式，每个分组携带虚电路标识符 VCID</p></li><li><p>链路、路由器资源(带宽、缓存等)可以面向虚电路进行资源预留</p></li></ul></li><li><p>虚电路组成</p><ul><li>一条虚电路包括: <ol><li>从源到目的地的一条路径(逻辑连接)</li><li>虚电路号:沿着该路径的每段链路的编号</li><li>沿着该路径的每个路由器中转发表，记录了经过 该路由器的每一条虚电路</li></ol></li><li>属于一条虚电路的分组携带一个虚电路号 每到达一段链路，分组携带的虚电路号必须改变 <ul><li>新的虚电路号从连接链路的路由器的转发表获得</li></ul></li></ul></li><li><p>虚电路转发表</p><ul><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230505193718946.png" alt="image-20230505193718946" style="zoom:67%;"> 每一个路由器都需要维护虚电路的连接状态信息 </li></ul></li><li><p>虚电路信令协议</p><ul><li>用于建立、维护和拆除 VC</li><li>应用于典型的虚电路网络:ATM、帧中继、X.25 中</li><li>没有用于今天的因特网中</li><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230505193943719.png" alt="image-20230505193943719" style="zoom:67%;"></li></ul></li></ol><h3 id="_4-2-2-数据报网络" tabindex="-1"><a class="header-anchor" href="#_4-2-2-数据报网络"><span>4.2.2 数据报网络</span></a></h3><ol><li><p>数据报网络概述</p><ul><li>在网络层无连接</li><li>分组携带目的主机地址</li><li>路由器根据分组目的地址转发分组 <ul><li>基于路由选择协议构造转发表</li><li>每个分组独立选路 <ul><li>相同源和目的地址情况下，可能采用不同的路径</li></ul></li></ul></li><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230505194056865.png" alt="image-20230505194056865" style="zoom:67%;"></li></ul></li><li><p>转发表</p><ul><li>转发表不可能列出所有的目的地址, 而是给出地址范围</li><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230505194530872.png" alt="image-20230505194530872" style="zoom:67%;"></li></ul></li><li><p>最长前缀匹配优先</p><ul><li><!---->: 在查找给定目的地址的转发表项时，使用与目标地址匹配的最长地址前缀</li><li><blockquote><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230505195245446.png" alt="image-20230505195245446" style="zoom:80%;"><p>例子:</p><ul><li><p>DA: 11001000 00010111 0001<mark>0110 10100001</mark></p><p>接口 0</p></li><li><p>DA: 11001000 00010111 0001<mark>1000 10101010</mark><br> 接口 1</p></li></ul></blockquote></li></ul></li></ol><blockquote><p>总结 数据报网络 or 虚电路网络</p><ul><li>因特网(数据报网络) <ul><li>在计算机间交换数据 <ul><li>“弹性”服务，无严格的定时要求</li></ul></li><li>“智能”端系统(计算机 <ul><li>能够适应，执行控制，差错控制</li><li>网络内部简单，“边缘”复杂许多链路类型</li></ul></li><li>不同特点、难以提供统一服务</li></ul></li><li>ATM(虚电路网络) <ul><li>从电话网络演化而来</li><li>类似人类交谈: <ul><li>严格定时，可靠性要求高</li><li>需要有保障的服务</li><li>“哑”端系统</li><li>电话，网络边缘简单; 网络内部复杂</li></ul></li></ul></li></ul></blockquote><h2 id="_4-3-路由器的构成-略" tabindex="-1"><a class="header-anchor" href="#_4-3-路由器的构成-略"><span>4.3 路由器的构成&lt;略&gt;</span></a></h2><ul><li>如题 略</li></ul><h2 id="_4-4-网际协议–ip-★" tabindex="-1"><a class="header-anchor" href="#_4-4-网际协议–ip-★"><span>4.4 网际协议–IP ★</span></a></h2><blockquote><p>Internet Protocol—IP</p></blockquote><h3 id="_4-4-0-ip-协议概述" tabindex="-1"><a class="header-anchor" href="#_4-4-0-ip-协议概述"><span>4.4.0 IP 协议概述</span></a></h3><ul><li><p>网际协议 IP 是 TCP/IP 体系中两个最重要的协议之一，也是最重要的互联网标准协议之一。</p></li><li><p>与 IP 协议配套是用的四个协议：</p><ul><li><strong>地址解析协议 ARP</strong>：是解决同一个局域网上的主机或路由器的 IP 地址和硬件地址的映射问题。</li><li><strong>逆地址解析协议 RARP</strong>：是解决同一个局域网上的主机或路由器的硬件地址和 IP 地址的映射问题。</li><li><strong>网际控制报文协议 ICMP</strong>：提供差错报告和询问报文，以提高 IP 数据交付成功的机会</li><li><strong>网际组管理协议 IGMP</strong>：：用于探寻、转发本局域网内的组成员关系。</li></ul></li><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230505201422879.png" alt="image-20230505201422879" style="zoom:80%;"></li><li><p>互联网服务被定义成<mark>不可靠的</mark> 、<mark>尽力而为</mark> 、<mark>无连接分组交付</mark> 系统。</p><ul><li>服务是不可靠的，因为分组可能丢失、重复、延迟或不按序交付等，但服务不检测这些情况，也不提醒发送方和接收方。</li><li>服务是尽力而为的，互联网并不随意地丢弃分组;只有资源用完或底层网络出现故障时才可能出现不可靠性。</li><li>服务是无连接的，因为每个分组都是独立对待的。分组序列可能经过不同的传输路径或者有的丢失有的到达。</li></ul></li></ul><h3 id="_4-4-1-ip-数据报" tabindex="-1"><a class="header-anchor" href="#_4-4-1-ip-数据报"><span>4.4.1 IP 数据报</span></a></h3><h4 id="ip-数据报格式" tabindex="-1"><a class="header-anchor" href="#ip-数据报格式"><span>IP 数据报格式</span></a></h4><p>一个 IP 数据报由首部（20 字节+可选字段）和数据两部分组成<br><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230417175646494.png" alt="image-20230417175646494" style="zoom:50%;"></p><ol><li><p>总长度 16 位</p><ul><li><p>指首部和数据部分长度之和(单位为字节)</p></li><li><p>2<sup>16</sup> - 1=65535B, 但是以太网帧的最大传输单元(<!---->)为 1500B, 当一个 IP 数据报成帧时, 不能超过 MTU 的值, 只能进行分片</p></li></ul></li><li><p>标识 16 位</p><ul><li>用于分片时标识片来自同一个数据报 (见下 [IP 分片和重新组装](# IP 分片和重新组装))</li></ul></li><li><p>标志 3 位</p><ul><li>标志分片情况 (见下 [IP 分片和重新组装](# IP 分片和重新组装))</li></ul></li><li><p>段偏移 13 位</p><ul><li>指出分片后在原分组中的相对位置</li></ul></li><li><p>生存时间(TTL-Time To Live) 8 位</p><ul><li>数据报在网络中可以通过的路由器数的最大值, 标识分组在网络中的寿命。 路由器在转发分组前, 先将 TTL-1 若 TTL=0, 丢弃分组</li><li>TTL 缺省值为 30 或更多，除非出现路由循环一般够用 <ul><li>考题: 防止路由循环, IP 数据报采取什么方式</li></ul></li></ul></li><li><p>协议 8 位</p><ul><li>指出分组携带数据使用什么协议(即数据部分应该上交给哪个协议进行处理); 如 TCP(值为 6), UDP(值为 17)</li></ul></li><li><p>首部校验和 16 位</p><ul><li>只校验分组首部, 不校验数据部分</li></ul></li><li><p>原地址字段 4B 32 位 : 发送方的 IP 地址 目的地址字段 4B 32 位 : 接收方的 IP 地址</p></li></ol><h4 id="ip-分片和重新组装" tabindex="-1"><a class="header-anchor" href="#ip-分片和重新组装"><span>IP 分片和重新组装</span></a></h4><ol><li><p>为什么进行分片: IP 数据报长度&gt;帧 MTU</p></li><li><p>字段意义</p><ul><li><p>Fragmentation Identifier-分片<!----></p><ul><li>16bits，用于标识来自于同一个 IP 数据报的分片数据</li></ul></li><li><p>Fragmentation Flag-分片<!----></p><ul><li>3bits，从左到右分别为: <ul><li>预留，为 0</li><li>DF，<strong>为 1 表示:禁止分片</strong>; 为 0 表示:允许分片</li><li>MF，为 1 表示:之后还有更多分片; 为 0 表示:是最后一个分片的数据报</li></ul></li></ul></li><li><p>Fragmentation Offset-<!----></p><ul><li>19bits，标识一个分片在整个数据报中的位置 <ul><li><mark>其值 ×8B</mark> 为实际的偏移值, 即偏移量以 8 个字节为偏移单位</li></ul></li></ul></li></ul></li><li><blockquote><p>【例】 4000 字节数据报, MTU(<!---->)=1500 字节</p></blockquote><ul><li>每个分片含有数据部分 1480 字节</li><li>偏移:1480/8=185</li><li>标识符 ID 均=X</li><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230417180407288.png" alt="image-20230417180407288" style="zoom:50%;"></li></ul></li></ol><h4 id="分组转发" tabindex="-1"><a class="header-anchor" href="#分组转发"><span>分组转发</span></a></h4><ol><li>从数据报的首部提取目的主机的 IP 地址 D, 得出目的网络地址为 N。</li><li>若网络 N 与此路由器直接相连，则把数据报直接交付目的主机 D；否则是间接交付，执行(3)。</li><li>若路由表中有目的地址为 D 的特定主机路由，则把数据报传送给路由表中所指明的下一跳路由器；否则，执行(4)。</li><li>若路由表中有到达网络 N 的路由，则把数据报传送给路由表指明的下一跳路由器；否则，执行(5)。</li><li>若路由表中有一个默认路由，则把数据报传送给路由表中所指明的默认路由器；否则，执行(6)</li><li>报告转发分组出错。</li></ol><h3 id="_4-4-2-ipv4-编址" tabindex="-1"><a class="header-anchor" href="#_4-4-2-ipv4-编址"><span>4.4.2 IPv4 编址</span></a></h3><h4 id="一-ip-编址-概述" tabindex="-1"><a class="header-anchor" href="#一-ip-编址-概述"><span>一. IP 编址:概述</span></a></h4><ul><li>IP 地址: 对主机、路由器接口的 32-bit 标识符 <ul><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230505202503512.png" alt="image-20230505202503512"></li></ul></li><li>接口: 在主机/路由器和物理链路之间的连接 <ul><li>路由器通常具有多个接口</li><li>主机可能具有多个接口</li><li>每个接口都需要进行 IP 编址，即对应一个 IP 地址</li></ul></li></ul><h4 id="二-子网" tabindex="-1"><a class="header-anchor" href="#二-子网"><span>二. 子网</span></a></h4><ul><li><p>IP 地址:</p><ul><li>子网部分(高阶比特)</li><li>主机部分(低阶比特)</li></ul></li><li><p>什么是子网?</p><ul><li>IP 地址具有相同子网部分的设备接口</li><li>能够物理上互相到达 而没有中间路由器</li></ul></li><li><p>子网判定方法</p><ul><li><p>为了确定子网，从其主机或路由器分离每个接口，生成网络孤岛。 每个网络孤岛被称为一个子网</p></li><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230505202814937.png" alt="image-20230505202814937" style="zoom:80%;"></li><li><blockquote><p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230505203803444.png" alt="image-20230505203803444" style="zoom:67%;"> 问: 有多少个子网?</p></blockquote><ul><li>6 个 从上到下 ①223.1.1.0 ②223.1.9.0 ③223.1.7.0 ④223.1.8.0 ⑤223.1.2.0 ⑥223.1.3.0</li></ul></li></ul></li></ul><h4 id="三-ip-编址-分类的-ip-地址" tabindex="-1"><a class="header-anchor" href="#三-ip-编址-分类的-ip-地址"><span>三. IP 编址:分类的 IP 地址</span></a></h4><blockquote><p><strong>IP 地址</strong>就是给每个连接在互联网上的主机（或路由器）分配一个在全世界范围是唯一的 32 位的标识符。 由互联网名字与号码指派公司 ICANN 进行分配。</p></blockquote><ol><li><p>什么是 IP 编址</p><ul><li>采用两级的 IP 地址来描述互联网上的设备接口: <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230505204231341.png" alt="image-20230505204231341" style="zoom:67%;"></li><li><!---->(net-icl): 标志主机(或路由器）所在的特定网络</li><li><!---->(host-icl): 标志该主机(或路由器)的接口</li><li>主机号在网络号所指明的网络范围内必须是唯一的</li></ul></li><li><p>所有的 IPv4 地址可分为以下 5 类</p><ul><li><p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230505204737914.png" alt="image-20230505204737914"> 注意开头, 便于区分分类</p></li><li><p>五类 IP 地址的指派范围 <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230505204808839.png" alt="image-20230505204808839" style="zoom:80%;"></p></li><li><p>A 类 : 1B 网络地址 + 3B 主机地址</p><ul><li>网络地址的最高位必须是<code>0</code>，可指派的网络数为<mark>2<sup>7</sup>-2</mark> ，减 2 的原因是 0.0.0.0 对应“本网络”，另外一个是 127.0.0.1 是本地软件的回环地址，用于测试自己电脑 IP 地址是否可用。</li><li>可用地址范围<code>1.0.0.0~126.255.255.255</code></li><li>最大主机数为 2<sup>24</sup>-2=16777214 台，减 2 的原因是全 0 的主机号字段代表该 IP 地址是”本主机“，全 1 表示”所有的“，表示该网络上的所有主机</li></ul></li><li><p>B 类 : 2B 网络地址 + 2B 主机地址</p><ul><li>网络地址的最高位必须是<code>10</code>，可指派的网络数为<mark>2<sup>14</sup>-1</mark> ，因为最高位为 10，所以不存在全 0 全 1 的情况，但是 B 类网络地址 128.0.0.0 是不指派的，可指派最小网络地址是 128.1.0.0</li><li>地址范围<code>128.0.0.0~191.255.255.255</code></li><li>最大主机数为 2<sup>16</sup>-2=65534 台，减 2 同样是全 0 全 1 情况</li></ul></li><li><p>C 类 : 3B 网络地址 + 1B 主机地址</p><ul><li>网络地址的最高位必须是<code>110</code>，可指派的网络数为<mark>2<sup>21</sup>-1</mark> ，192.0.0.0 不指派，最小可指派网络地址是 192.0.1.0</li><li>地址范围<code>192.0.0.0-223.255.255.255</code></li><li>最大主机数为 2<sup>8</sup>-2=254 台，减 2 同样是全 0 全 1 情况。</li></ul></li></ul></li><li><p>特殊的 IP 地址</p><ul><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230505204936552.png" alt="image-20230505204936552" style="zoom:80%;"></li><li>私有地址: <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230505205003426.png" alt="image-20230505205003426" style="zoom:67%;"> (用于 NAT)</li></ul></li><li><ul><li><p>采用分级 IP 地址结构的优点:</p><ul><li><p>IP 地址管理机构在分配 IP 地址时只分配网络号，而剩下的主机号则由得到该网络号的单位自行分配。 方便对 IP 地址的管理。</p></li><li><p>路由器仅根据目的主机所连接的网络号来转发分组(而不考虑目的主机号)。</p></li></ul></li><li><p>采用分级 IP 地址结构的缺点:</p><ul><li>IP 地址空间的利用率有时很低。</li><li>给每一个物理网络分配一个网络号会使路由表变得太大因而使网络性能变坏。</li><li>两级的 IP 地址不够灵活。</li></ul></li></ul></li></ol><h3 id="_4-4-3-子网划分" tabindex="-1"><a class="header-anchor" href="#_4-4-3-子网划分"><span>4.4.3 子网划分</span></a></h3><ol><li><p>从 1985 年起，从 IP 地址的主机号 host-id 借用若干个位作为子网号 subnet-id，增加了一个<!---->，使两级的 IP 地址变成为三级的 IP 地址。这种做法叫做<!----></p><p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230505210923312.png" alt="image-20230505210923312"></p></li><li><p>子网划分后的 传输流程</p><ul><li>划分子网纯属一个单位内部的事务。单位对外仍然表现为没有划分子网的网络。 <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230508165040206.png" alt="image-20230508165040206" style="zoom:80%;"></li></ul><ol><li>凡是从其他网络发送给此单位某个主机的 IP 数据报，仍然是根据 IP 数据报的目的网络号 net-id，先找到连接在本单位网络上的路由器。</li><li>然后此路由器在收到 IP 数据报后，再按目的网络号 net-id 和子网号 subnet-id 找到目的子网。</li><li>最后将 IP 数据报直接交付目的主机。</li></ol></li></ol><h4 id="子网掩码" tabindex="-1"><a class="header-anchor" href="#子网掩码"><span>子网掩码</span></a></h4><ol><li><p>意义: 从一个 IP 数据报的首部并无法判断源主机或目的主机所连接的网络是否进行了子网划分。 使用<!---->可以找出 IP 地址中的子网部分。</p></li><li><p>子网掩码规则:</p><ul><li>子网掩码左边部分的一连串 1，对应于网络号和子网号</li><li>子网掩码右边部分的一连串 0，对应于主机号</li><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230508165244114.png" alt="image-20230508165244114" style="zoom:80%;"></li><li>A,B,C 三类地址默认的子网掩码 <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230508170300015.png" alt="image-20230508170300015" style="zoom:50%;"></li><li><code>(IP地址) AND (子网掩码) = 网络地址</code><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230508170429569.png" alt="image-20230508170429569" style="zoom:80%;"></li></ul></li><li><blockquote><p>已知 IP 地址是 141.14.72.24，子网掩码是 255.255.192.0。试求网络地址</p></blockquote><ul><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230508171040998.png" alt="image-20230508171040998" style="zoom:80%;"></li></ul><blockquote><p>上例中，若子网掩码改为 255.255.224.0，试求网络地址，讨论所得结果</p></blockquote><ul><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230508171119326.png" alt="image-20230508171119326" style="zoom:80%;"></li><li>不同的子网掩码得出相同的网络地址。但不同的掩码的效果是不同的。</li></ul></li><li><p>总结: 子网掩码是一个网络的重要属性</p><ul><li>路由器在和相邻路由器交换路由信息时，必须把自己所在网络(或子网)的子网掩码告诉相邻路由器。</li><li>路由器的路由表中的每一个项目，除了要给出目的网络地址外，还必须同时给出该网络的子网掩码。</li></ul></li></ol><h4 id="子网划分" tabindex="-1"><a class="header-anchor" href="#子网划分"><span>子网划分</span></a></h4><blockquote><p>有 <!---->和<!---->两种子网划分方法</p></blockquote><ol><li><blockquote><p>【例】 学院新建 4 个机房，每个房间有 25 台机器，给定一个网络地址块:192.168.10.0，现在需要将其划分为 4 个子网 【固定长度子网划分】</p></blockquote><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mi>n</mi></msup><mo>−</mo><mn>2</mn><mo>≥</mo><mn>25</mn><mo stretchy="false">(</mo><mtext>主机数</mtext><mo stretchy="false">)</mo><mtext> </mtext><mo>→</mo><mtext> </mtext><msup><mn>2</mn><mn>5</mn></msup><mo>−</mo><mn>2</mn><mo>≥</mo><mn>15</mn></mrow><annotation encoding="application/x-tex">2^n-2\geq 25(主机数)\ →\ 2^5-2 \geq 15</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7477em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7804em;vertical-align:-0.136em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">25</span><span class="mopen">(</span><span class="mord cjk_fallback">主机数</span><span class="mclose">)</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7804em;vertical-align:-0.136em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">15</span></span></span></span> 所以主机位数 n 为 5 位</li><li>192.168.10.0 → C 类 8 位主机号</li><li>子网 3 位 掩码: <code>255.255.255.224(1110 0000)</code></li><li>所以我们的子网地址和子网主机地址如下: 子网 1:<code>192.168.10.32</code> 掩码:<code>255.255.255.224</code> 主机 IP:<code>192.168.10.33~62</code> 子网 2: <code>192.168.10.64</code> 掩码:<code>255.255.255.224</code> 主机 IP:<code>192.168. 10.65~94</code> 子网 3: <code>192.168.10.96</code> 掩码:<code>255.255.255.224</code>主机 IP:<code>192.168. 10. 97~126</code> 子网 4:<code>192.168.10.128</code> 掩码:<code>255.255.255.224</code>主机 IP: <code>192.168.10. 129~158</code> 子网 5:<code>192.168.10 .160</code> 掩码: <code>255.255.255.224</code>主机 IP:<code>192.168.10.161~190</code> 子网 6:192.168.10.192 掩码:<code>255.255.255.224</code> 主机 IP:<code>192.168.10.193~222</code></li></ul></li><li><blockquote><p>【例】 一家公司目前有 5 个部门 A 至 E，其中:A 部门有 50 台 PC，B 部门 20 台，C 部门 30 台，D 部门 15 台，E 部门 20 台，企业信息经理分配了一个总的网络地址 192. 168.2.0/24 给你，作为网络管理员，请问如何为每个部门划分单独的子网段? 【变长子网划分】</p></blockquote><ul><li>答:<code>192.168.2.0/24</code> 该范围为:<code>192.168.2.0~192.168.2.255</code></li><li>A 部门(50 台) <!----><ul><li>IP 范围:<code>192.168.2.0~192.168.2.63</code> 子网掩码:<code>255.255.255.192(1100 0000)</code></li><li>其中<code>192.168.2.0</code>为网络地址，<code>192.168.2.63</code>为广播地址, 不可用</li></ul></li><li>B 部门 <ul><li>IP 范围:<code>192.168.2.64~192.168.2.95</code>子网掩码:<code>255.255.255.224(1110 0000)</code></li><li>其中<code>192.168.2.64</code>为网络地址，<code>192.168.2.95</code>为广播地址</li></ul></li><li>C 部门 <ul><li>IP 范围:<code>192.168.2.96(01110 0000)~192.168.2.127(0111 1111)</code>子网掩码:<code>255.255.255.224</code></li><li>其中<code>192.168.2.96</code>为网络地址，<code>192.168.2.127</code>为广播地址</li></ul></li><li>D 部门 <ul><li>IP 范围:<code>192.168.2.128(1000 0000)~192.168.2.159(1001 1111)</code>子网掩码:<code>255.255.255.224</code></li><li>其中<code>192.168.2.128</code>为网络地址，<code>192.168.2.159</code>为广播地址</li></ul></li><li>E 部门 <ul><li>IP 范围:<code>192.168.2.160~192.168.2.191</code>子网掩码:<code>255.255.255.224</code></li><li>其中<code>192.168.2.160</code>为网络地址，<code>192.168.2.191</code>为广播地址</li></ul></li><li>冗余 IP 范围为<code>192.168.2.192-192.168.2.255/255.255.255.192</code></li></ul></li></ol><h4 id="子网划分的分组转发算法" tabindex="-1"><a class="header-anchor" href="#子网划分的分组转发算法"><span>子网划分的分组转发算法</span></a></h4><ol><li><p>分组转发流程</p><ol><li>从收到的分组的首部提取<strong>目的 IP 地址 D</strong>。</li><li>先用各网络的<strong>子网掩码和 D 逐位相“与”</strong>，看是否和相应的网络地址匹配。 若匹配，则将分组直接交付。 否则就是间接交付，执行(3)。</li><li>若路由表中有目的地址为 D 的<strong>特定主机路由</strong>，则将分组传送给指明的下一跳路由器; <!----> 否则，执行(4)。</li><li>对路由表中的每一行，将子网掩码和 D 逐位相“与”。若结果与该行的目的网络地址匹配，则将分组传送给该行指明的下一跳路由器; <!----> 否则，执行(5)。</li><li>若路由表中有一个默认路由，则将分组传送给路由表中所指明的默认路由器; 否则，执行(6)。</li><li>报告转发分组出错。</li></ol><ul><li><strong>相与</strong>: 网络号+子网号部分的掩码是 1, 与运算后结果不变, 主机号部分掩码为 1, 与运算后变 0, 指向网络</li></ul></li><li><blockquote><p>【例】已知互联网和路由器 R 中的路由表。主机 H1 向 H,发送分组。试讨论 R 收到 H 向 H 发送的分组后查找路由表的过程。 <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230515195728928.png" alt="image-20230515195728928"></p></blockquote><ul><li>H1 先检查目的主机(<code>128.30.36.0</code>)是否在本网络(<code>128.20.33.0/25</code>) 是, 直接交付; 否, 递交给路由器 R1, 由 R1 逐项查找路由表 <ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>225.225.225.128</mn><mi mathvariant="normal">&amp;</mi><mn>128.30.33.138</mn><mo>=</mo><mn>128.30.33.128</mn><mo mathvariant="normal">≠</mo><mn>128.30.33.0</mn></mrow><annotation encoding="application/x-tex">225.225.225.128 \&amp; 128.30.33.138 = 128.30.33.128\neq 128.30.33.0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">225.225.225.128&amp;128.30.33.138</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord">128.30.33.128</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="inner"><span class="mord"><span class="mrel"></span></span></span><span class="fix"></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">128.30.33.0</span></span></span></span> 不是本网络</li></ul></li><li>递交给 R1, R1 对路由表逐个进行与 <ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>225.225.225.128</mn><mi mathvariant="normal">&amp;</mi><mn>128.30.33.138</mn><mo>=</mo><mn>128.30.33.128</mn><mo mathvariant="normal">≠</mo><mn>128.30.33.0</mn></mrow><annotation encoding="application/x-tex">225.225.225.128 \&amp; 128.30.33.138 = 128.30.33.128\neq 128.30.33.0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">225.225.225.128&amp;128.30.33.138</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord">128.30.33.128</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="inner"><span class="mord"><span class="mrel"></span></span></span><span class="fix"></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">128.30.33.0</span></span></span></span> 不一致</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>225.225.225.128</mn><mi mathvariant="normal">&amp;</mi><mn>128.30.33.138</mn><mo>=</mo><mn>128.30.33.128</mn><mo mathvariant="normal">≠</mo><mn>128.30.33.0</mn></mrow><annotation encoding="application/x-tex">225.225.225.128 \&amp; 128.30.33.138 = 128.30.33.128\neq 128.30.33.0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">225.225.225.128&amp;128.30.33.138</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord">128.30.33.128</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="inner"><span class="mord"><span class="mrel"></span></span></span><span class="fix"></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">128.30.33.0</span></span></span></span> 匹配一致</li></ul></li></ul></li></ol><h3 id="_4-4-4-cidr-无类型域间路由" tabindex="-1"><a class="header-anchor" href="#_4-4-4-cidr-无类型域间路由"><span>4.4.4 CIDR 无类型域间路由</span></a></h3><ol><li><!---->(<strong>C</strong>lassless <strong>I</strong>nter<strong>D</strong>omain <strong>R</strong>outing,CIDR)<ul><li>任意长度的 IP 地址子网部分</li><li>消除传统的有类地址划分(A、B、C、D、E、F)</li><li>地址格式: <code>a.b.c.d/x</code>,其中 x 是子网部分的比特长度</li><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230515204437621.png" alt="image-20230515204437621"></li></ul></li><li>CIDR 优点 <ul><li>提高 IPV4 地址空间分配效率</li><li>提高路由效率，使得路由信息通告更高效 <ul><li>构造超网(supernetting)/路由聚合</li><li>路由聚合有利于减少路由器之间的路由选择信息的交换，从而提高了整个互联网的性能</li></ul></li></ul></li></ol><h4 id="cidr-路由聚合" tabindex="-1"><a class="header-anchor" href="#cidr-路由聚合"><span>CIDR 路由聚合</span></a></h4><ol><li><p>路由聚合:将几个相邻子网的连续网络地址进行汇总，以单个 CIDR 网络地址形式表示聚合之后的网络。</p></li><li><p>利用 CIDR 实现路由聚合至少要满足两个基本条件</p><ul><li>待汇总地址的网络号拥有相同的高位</li><li>待汇总地址是连续的</li><li>待汇总网络地址的数目必须是 2 的整数幂次</li></ul></li><li><blockquote><p>例:某公司分配到 4 个 C 类网络: 192.168.1.0; 192.168.2.0;192.168.3.0; 192.168.4.0，如何把 4 个 C 类网络组合成一个超网?超网的网络 Ib 和子网掩码是多少?</p></blockquote><ul><li>首先将 4 个 C 类网络的网络 TID 转换为二进制数表示，其中 192.168 对应二进制形式为 11000000.10101000: <ul><li>192.168.1.0: <strong>192.168.0000 0</strong>001. 0000 0000</li><li>192.168.2.0: <strong>192.168.0000 0</strong>010. 0000 0000</li><li>192.168.3.0: <strong>192.168.0000 0</strong>011. 0000 0000</li><li>192.168.4.0: <strong>192.168.0000 0</strong>100. 0000 0000</li></ul></li><li>根据二进制的网络 I，选择具有相同高位的部分作为超网的网络 ID <strong>11000000.10101000.0000 0</strong>xxx.xxxx xxxx</li><li>根据网络 ID 计算掩码为 11111111.11111111.111 11000.00000000，对应的点分十进制表达为:255.255.248.0</li><li>所以汇聚后的超网是<code>192.168.0.0/21</code>，其中网络 ID 为:<code>192.168.0.0</code>，掩码为:<code>255.255.248.0</code></li></ul></li><li><blockquote><p>例:有两组连续的 C 类网络地址块如下，能否汇聚成一个超网? A: 201.66.32.0 - 201.66.47.0 B: 201.66.71.0 - 201.66.86.0</p></blockquote><ul><li>答:A 和 B 都是连续地址块，且网络地址数满足第二个条件</li><li>对于 A: 202.66.32.0 = <strong>202.66.0010</strong>0000.0 202.66.47.0 = <strong>202.66.0010</strong>1111.0 所以，可以聚合成超网<code>202.66.32.0/20</code>，掩码为<code>255.255.240.0</code></li><li>对于 B: 202.66.71.0 = <strong>202.66.010</strong>00111.0 202.66.86.0 = <strong>202.66.010</strong>10110.0 取网络相同的高位部分作为网络 ID，如果聚合成超网，则表示为<code>202.66.64.0/19</code>: <ul><li>但是:这样的网络 ID 所表示的超网，包含了实际中并不存在的子网(路由黑洞)，所以不能聚合。</li></ul></li></ul></li><li><p>ISP 与路由聚合</p><ul><li>组织或机构向 ISP 申请, 从 ISP 的地址空间中分配得到 <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230517075728429.png" alt="image-20230517075728429" style="zoom:50%;"></li><li>路由聚合允许有效的通告选路信息 <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230517075915003.png" alt="image-20230517075915003" style="zoom:50%;"></li><li>地址匹配时会按照<!---->, ISPs-R-Us 具有到组织 1 的更具体的路由 <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230517080041469.png" alt="image-20230517080041469" style="zoom:50%;"></li><li>ISP 通过 <!---->(<strong>I</strong>nternet <strong>C</strong>orporation for <strong>A</strong>ssigned <strong>N</strong>ames and <strong>N</strong>umbers, <strong>ICANN</strong>)</li></ul></li></ol><h3 id="_4-4-5-dhcp-动态主机配置协议-略" tabindex="-1"><a class="header-anchor" href="#_4-4-5-dhcp-动态主机配置协议-略"><span>4.4.5 DHCP 动态主机配置协议&lt;略&gt;</span></a></h3><blockquote><p>问题:主机怎样获得 IP 地址?</p><ul><li>由系统管理员在文件中硬编码（静态配置) Wintel:控制面板-&gt;网络-&gt;配置-&gt;TCP/IP-&gt;性质 UNIX:/etc/rc.config</li><li><!---->(Dynamic Host Configuration Protocol, DHCP):动态地从服务器得到:IP 地址、子网掩码、默认网关地址、DNS 服务器名称与 IP 地址<ul><li>“即插即用”、地址续订、重用、支持移动 IP</li></ul></li></ul></blockquote><ol><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230517081847187.png" alt="image-20230517081847187" style="zoom:50%;"> → <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230517081906936.png" alt="image-20230517081906936" style="zoom:50%;"></li><li>DHCP 流程总结: <ul><li>主机广播“DHCP 发现”报文</li><li>DHCP 服务器以“DHCP 提供”报文向客户做出响应</li><li>主机发送“DHCP 请求”报文请求 IP 地址 DHCP 服务器用“DHCP ACK”报文进行相应，发送 IP 地址</li></ul></li><li>DHCP 除了分配主机 IP 地址，还能使主机获取更多其他信息: <ul><li>客户机的第一跳路由器 IP 地址</li><li>本地 DNS 服务器主机名和 IP 地址</li><li>子网掩码(用于指示网络号与主机地址部分)</li></ul></li></ol><h3 id="_4-4-6-nat-网络地址转换" tabindex="-1"><a class="header-anchor" href="#_4-4-6-nat-网络地址转换"><span>4.4.6 NAT 网络地址转换</span></a></h3><ol><li><!---->: 通过 NAT 路由器, 将本地网络与外部网络进行转换<img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230517083409436.png" alt="image-20230517083409436" style="zoom:50%;"></li><li><p>动机:<strong>本地网络对外只使用一个 IP 地址，外部仅关注该地址</strong></p><ul><li>对 ISP 无需分配地址范围:对所有设备只用一个 IP 地址</li><li>能够改变本地网络中的设备地址，而不必通知外部</li><li>能够改变 ISP 而不需更改本地网络的设备地址</li><li>本地网络内部结构外部不可见，增强安全性</li></ul></li><li><p>NAT 路由器实现方式</p><ul><li><strong>转发数据报</strong>: 每个外出的数据报用 (NAT IP 地址,新 port #) 代替 (源 IP 地址, port #) <ul><li>远程的客户机/路由器的响应，将用(NATIP 地址，new port #)作为目的地址</li></ul></li><li><strong>记住</strong>: (在 NAT 转换表中)每个(源 IP 地址, port #)到(NAT IP 地址,新 port #)转换对</li><li><strong>入数据报</strong>: 对每个入数据报的地址字段用存储在 NAT 表中的(源 IP 地址, port #)替代对应的(NAT IP 地址,新 port #)</li><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230517085453693.png" alt="image-20230517085453693" style="zoom:67%;"></li></ul></li><li><p>16bit 端口号字段: 用一个 LAN 侧地址, 同时支持 60000 并行连接</p></li><li><p>NAT 存在的问题</p><ul><li>应当用于进程编址而非主机编址</li><li>路由器的处理上升为第三层</li><li>违反了端到端通信原则</li><li>NAT 妨碍了 P2P 应用程序</li><li>地址短缺应当由 IPv6 来解决, 而非 NAT</li></ul></li></ol><h4 id="nat-穿越问题" tabindex="-1"><a class="header-anchor" href="#nat-穿越问题"><span>NAT 穿越问题</span></a></h4><blockquote><p>外部客户端如何连接内网服务器</p><p>互连网络服务器本地局域网 10.0.0.1, 外部仅可见 NAT 转换后的地址: 138.76.29.7 <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230519004058673.png" alt="image-20230519004058673" style="zoom:67%;"></p></blockquote><ol><li><!---->:在 NAT 路由器静态配置 NAT 转换表，将特定端口号传入的连接请求转发到服务器。<ul><li>例如(<code>138.76.29.7, port 2500</code>)总是转发到(<code>10.0.0.1, port 80</code>)</li></ul></li><li><!---->:通用即插即用(UPnP)因特网网关设备(IGD)协议。<ul><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230519004807276.png" alt="image-20230519004807276" style="zoom:50%;"></li><li><p>允许内部网络 NAT 化的主机:</p><ul><li>获取公共 IP 地址(138.76.29.7)</li><li>自动增加/移除（公共 IP 地址，公共端口号)和(私有 IP 地址，私有端口号)之间的映射 <ul><li>自动化静态 NAT 端口映射配置</li></ul></li></ul></li><li><p>使得外部主机能使用 TCP/UDP 向 NAT 化的主机发起通信会话</p></li></ul></li><li><p>解决方案 3:中继代理(例如 Skype)</p><ul><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230519004826166.png" alt="image-20230519004826166" style="zoom:50%;"></li><li><p>NAT 化的客户端建立到中继代理服务器的连接</p></li><li><p>外部网络的客户端也连接到中继代理服务器</p></li><li><p>中继代理服务器在两个连接之间转发数据报</p></li></ul></li></ol><h2 id="_4-5-互联网控制消息协议–icmp" tabindex="-1"><a class="header-anchor" href="#_4-5-互联网控制消息协议–icmp"><span>4.5 互联网控制消息协议–ICMP</span></a></h2><ol><li>引入—为什么需要 ICMP <ul><li>Internet 可能发生的差错，导致数据报传输失败 <ul><li>通信线路、处理器、目的主机关机</li><li>数据报生命期变为 0</li><li>Router 拥塞 等等</li></ul></li><li>必须报告错误对于同一个网络 <ul><li>可以利用特殊硬件来报告错误</li><li>对于互联网络 <ul><li>发送方很难判断传送失败的原因，如错误发生在哪里</li><li>IP 协议本身没有处理错误的机制</li></ul></li></ul></li></ul></li><li>为了提高 IP 数据报交付成功的机会，网际层使用<!---->让主机或路由器向源端<strong>报告差错情况</strong>和<strong>提供有关异常情况</strong>的报告。 <ul><li>但 ICMP 协议并没有指定对错误所应采取的措施，而是把差错交给应用程序或其他协议处理 <ul><li>大部分由传输协议(TCP、UDP)处理</li></ul></li></ul></li><li><strong>常用的 ICMP 报文类型</strong><ol><li>ICMP 差错报告报文(划线表示不再使用) <ul><li><code>目的不可达(Destination Unreachable-type3)</code></li><li><s>源抑制(Source Quench-type4)</s></li><li><code>超时（Time Exceeded-1ype11)</code></li><li><code>参数问题（Parameter Problem-Type12)</code></li><li><code>重定向（Redirect-Type5)</code></li></ul></li><li>ICMP 询问报文(划线表示不再 使用) <ul><li><code>回送请求和应答报文 (Echo Request/Reply-Type0/8)</code></li><li><code>时间戳请求和应答报文(TimeStamp Request/Reply-Type13/14)</code></li><li><s>掩码地址请求和应答报文(Address Mask Request/Relpy-1ype17/18)</s></li><li><s>路由器询问和通告报文(Router Advertisement/Solicitation-Type9/10)</s></li></ul></li><li>编码: <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230525211909787.png" alt="image-20230525211909787" style="zoom:67%;"></li></ol></li><li>ICMP 报文的格式 <ul><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230525211424702.png" alt="image-20230525211424702" style="zoom:50%;"> ICMP封装在IP数据报内部 </li></ul></li></ol><h3 id="_4-5-1-icmp-差错报告报文" tabindex="-1"><a class="header-anchor" href="#_4-5-1-icmp-差错报告报文"><span>4.5.1 ICMP 差错报告报文</span></a></h3><ol><li><strong>不会发送 ICMP 报文的情况</strong><ul><li>对 ICMP 差错报告报文不再发送 ICMP 差错报告报文</li><li>对<strong>第一个分片</strong>的数据报片的所有<strong>后续</strong>数据报片, 都不发送 ICMP 差错报告报文</li><li>对具有<strong>多播地址</strong>的数据报都不发送 ICMP 差错报告报文</li><li>对具有<strong>特殊地址</strong> (如 127.0.0.0 或 0.0.0.0) 的数据报不发送 ICMIP 差错报告报文</li></ul></li><li>ICMP 差错报告报文的数据字段的内容 <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230525212403911.png" alt="image-20230525212403911" style="zoom:67%;"></li></ol><h3 id="_4-5-2-icmp-询问报文" tabindex="-1"><a class="header-anchor" href="#_4-5-2-icmp-询问报文"><span>4.5.2 ICMP 询问报文</span></a></h3><ol><li><strong>Echo Request/Reply 查询消息</strong><ul><li>工作原理: 主机或路由器可以向指定目的主机或路由器发送一个 Echo Request 报文，收到请求的目的机器向发送端返回一个 Echo Reply 报文，应答报文包含了请求报文中的数据拷贝。</li><li>报文格式 <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230525213609081.png" alt="image-20230525213609081" style="zoom:50%;"></li><li>可以用于检测目的站的可达性与状态 (Ping) <ul><li>Ping 允许用户向目标主机/路由器发送一个或多个 ICMPEcho Request 消息，计算从探测开始到收到 ICMP EchoReply 消息所花费的时间，来测试两个设备之间的网络连接是否正常。</li><li>Ping 能正确获得响应的四点保证 <ul><li>源主机与目的主机之间的 Router 工作正常</li><li>源主机为 IP 数据报选路的软件工作正常</li><li>目的主机正在运行,IP 和 ICMP 正常工作</li><li>返回路径上 Router 有正确路由</li><li>目标主机没有设置防火墙过滤 ICMP Echo/Request 消息</li></ul></li></ul></li></ul></li><li>Time Exceeded(超时)错误消息 <ul><li>Time-To-Live Exceeded in Transit ([IP 数据报-生命周期字段](# IP 数据报格式)) <ul><li>当 TTL 为 0，而数据报还没有到达最终目的地 Router 只能抛弃该数据报，并发送这条 ICMP 消息</li></ul></li><li>Fragment Reassenbly Time Exceeded <ul><li>没有在收到数据报第一个分片的 TTL 时间终止前收到所有的分片，则发送该消息(Unix,60 秒)，该消息将导致源发送端重发整个数据报</li></ul></li><li>报文格式 <ul><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230525221435210.png" alt="image-20230525221435210"></li></ul></li></ul></li><li>使用 Traceroute 进行路径发现 <ul><li>Time Exceeded(超时)错误消息还可以与 UDP 报文配合, 用户 Traceroute 路由发现</li><li>具体操作 <ol><li>发送端向目的主机发送 UDP 数据包==(TTL 为 1)== ，第一跳路由器对 TTL 进行减量运算后 TTL=0，数据报会被丢弃，第一跳路由器向发送端返回 ICMP Time Exceeded 错误消息-&gt;获得第一跳路由器地址</li><li>依此类推发送 TTL=2，TTL=3,....的 UDP 数据包，直到某个 UDP 数据包到达目的生机，目的主机返回<code>ICMP Port Unreachable消息</code></li><li>发送端主机记录下到达目的主机所用的往返时间 <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230525221806252.png" alt="image-20230525221806252" style="zoom:67%;"></li></ol></li><li>几点说明 <!----><ul><li>当 UDP 数据包到达目的主机后，即使 TTL=1，目的主机也不会丢弃该数据报，因而不会返回 ICMP Time Exceeded 错误消息</li><li>为了能通知源主机数据报已经到达目的主机，Traceroute 选择一个很大的(大于 30000)、目的主机上任何一个进程都不会使用的 UDP 目的端口号，设置为 UDP 数据包的端口号</li><li>这样，当数据报到达目的主机后，目的端将返回一条 ICMP <code>Port Unreachable错误消息</code></li><li>大部分 UNIX 缺省版本的 Traceroute 一次性发送 3 个 UDP 数据报，每个数据报的目的端口号都在增加</li><li>其他操作系统的 Traceroute 发送 TTL 增量为 1 的 ICMP <code>Echo Request查询消息</code></li><li>存在被防火墙阻断的可能</li></ul></li></ul></li></ol><h2 id="_4-6-选路算法" tabindex="-1"><a class="header-anchor" href="#_4-6-选路算法"><span>4.6 选路算法</span></a></h2><h3 id="_4-6-0-图的概念-选路" tabindex="-1"><a class="header-anchor" href="#_4-6-0-图的概念-选路"><span>4.6.0 图的概念&amp;选路</span></a></h3><ol><li>选路协议: 目的: 决定从原到目的地通过网络的“好的路径”(路由器序列)</li><li>选路算法中的图论 <ul><li>结点–路由器; 边–物理链路; 边权–时延, 费用或拥塞等级</li></ul></li><li>好的路径: 费用最小路径</li></ol><h3 id="_4-6-1-选路算法分类" tabindex="-1"><a class="header-anchor" href="#_4-6-1-选路算法分类"><span>4.6.1 选路算法分类</span></a></h3><ol><li>全局 or 分散的信息 <ul><li>全局的: 所有路由器具有完全的拓扑和链路费用信息 <ul><li>“链路状态”算法</li></ul></li><li>分散的: 路由器只知道物理相连的邻居的链路费用 <ul><li>通过迭代计算, 与邻居交换信息</li><li>“距离矢量”算法</li></ul></li></ul></li><li>静态 or 动态 <ul><li>静态: 路由随时间缓慢变化, 手工配置, 优先级高</li><li>动态: 路由更快地变化 <ul><li>周期的自动更新</li><li>适应链路费用变化</li></ul></li></ul></li></ol><h3 id="_4-6-2-dijkstra-链路状态路由算法" tabindex="-1"><a class="header-anchor" href="#_4-6-2-dijkstra-链路状态路由算法"><span>4.6.2 Dijkstra 链路状态路由算法</span></a></h3><ol><li>Dijkstra 算法 <ul><li>所有结点知道网络拓扑、链路费用 <ul><li>信息传递经“链路状态广播”(洪泛)完成</li><li>所有结点具有相同信息</li></ul></li><li>从一个结点(源)到所有其他结点计算最低费用路径 <ul><li>给出对这些结点的转发表</li></ul></li><li>迭代: k 次迭代后，得知到 k 个目的地的最低费用路径</li></ul></li><li>算法定义 <ul><li>c(x,y):从结点 x 到 y 的链路费用;如果不是直接邻居=∞</li><li>D(v):从源到目的地 v 路径费用的当前值</li><li>p(v):从源到 v 沿路径的，v 的前序结点</li><li>N&#39;:已知在最小费用路径中的结点集合</li></ul></li><li>算法思路 <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230526193202876.png" alt="image-20230526193202876" style="zoom:50%;"></li><li>例 <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230526193406697.png" alt="image-20230526193406697" style="zoom:80%;"> <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230526193423522.png" alt="image-20230526193423522" style="zoom:67%;"></li><li>算法复杂度 O(nlogn)</li><li>路径计算可能存在振荡问题 <ul><li>假设链路费用是该链路承担的流量 <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230526193620807.png" alt="image-20230526193620807" style="zoom:80%;"></li></ul></li></ol><h3 id="_4-6-3-bellmanford-距离矢量算法" tabindex="-1"><a class="header-anchor" href="#_4-6-3-bellmanford-距离矢量算法"><span>4.6.3 BellmanFord 距离矢量算法</span></a></h3><ol><li><p>算法思路</p><ul><li>结点 x 需要维护下列信息: <ul><li>对于每个直接相连的邻居 v，x 到 v 的费用 c(x,y)</li><li>结点 x 的距离向量，即<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>D</mi><mi>x</mi></msub><mo>=</mo><mo stretchy="false">{</mo><msub><mi>D</mi><mi>x</mi></msub><mo stretchy="false">(</mo><mi>y</mi><mo stretchy="false">)</mo><mtext>，</mtext><mi>f</mi><mi>o</mi><mi>r</mi><mtext> </mtext><mi>e</mi><mi>a</mi><mi>c</mi><mi>h</mi><mtext> </mtext><mi>n</mi><mi>o</mi><mi>d</mi><mi>e</mi><mtext> </mtext><mi>y</mi><mo>∈</mo><mi>N</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">D_x=\{D_x(y)，for\ each\ node\ y \in N\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mord cjk_fallback">，</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal" style="margin-right:0.02778em;">or</span><span class="mspace"> </span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord mathnormal">h</span><span class="mspace"> </span><span class="mord mathnormal">n</span><span class="mord mathnormal">o</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">}</span></span></span></span>，表示 x 到结点集合 N 中所有目的地为结点 v 的费用的估计值 <ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>D</mi><mi>x</mi></msub><mo stretchy="false">(</mo><mi>y</mi><mo stretchy="false">)</mo><mo>=</mo><mi>m</mi><mi>i</mi><mi>n</mi><mo stretchy="false">{</mo><mi>c</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>v</mi><mo stretchy="false">)</mo><mo>+</mo><msub><mi>D</mi><mi>v</mi></msub><mo stretchy="false">(</mo><mi>y</mi><mo stretchy="false">)</mo><mi mathvariant="normal">∣</mi><mtext>对</mtext><mi>x</mi><mtext>的所有邻居</mtext><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">D_x(y)=min\{c(x,v)+D_v(y)|对x的所有邻居\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">min</span><span class="mopen">{</span><span class="mord mathnormal">c</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mord">∣</span><span class="mord cjk_fallback">对</span><span class="mord mathnormal">x</span><span class="mord cjk_fallback">的所有邻居</span><span class="mclose">}</span></span></span></span></li></ul></li><li>结点 x 的每个邻居的距离向量<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>D</mi><mi>v</mi></msub><mo>=</mo><mo stretchy="false">{</mo><msub><mi>D</mi><mi>v</mi></msub><mo stretchy="false">(</mo><mi>y</mi><mo stretchy="false">)</mo><mtext>，</mtext><mi>f</mi><mi>o</mi><mi>r</mi><mtext> </mtext><mi>e</mi><mi>a</mi><mi>c</mi><mi>h</mi><mtext> </mtext><mi>n</mi><mi>o</mi><mi>d</mi><mi>e</mi><mtext> </mtext><mi>y</mi><mo>∈</mo><mi>N</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">D_v=\{D_v(y)，for\ each\ node\ y \in N\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mord cjk_fallback">，</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal" style="margin-right:0.02778em;">or</span><span class="mspace"> </span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord mathnormal">h</span><span class="mspace"> </span><span class="mord mathnormal">n</span><span class="mord mathnormal">o</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">}</span></span></span></span></li></ul></li><li>算法思路 <ul><li>每个结点<strong>周期性</strong>的向邻居发送自己的距离向量 Dx</li><li>当结点 x 接收到任何一个邻居 v 新的距离向量，使用 B-F 方程更新自己的距离向量: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>D</mi><mi>x</mi></msub><mo stretchy="false">(</mo><mi>y</mi><mo stretchy="false">)</mo><mo>←</mo><mi>m</mi><mi>i</mi><mi>n</mi><mo stretchy="false">{</mo><mi>c</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>v</mi><mo stretchy="false">)</mo><mo>+</mo><msub><mi>D</mi><mi>v</mi></msub><mo stretchy="false">(</mo><mi>y</mi><mo stretchy="false">)</mo><mtext>，</mtext><mi>f</mi><mi>o</mi><mi>r</mi><mtext> </mtext><mi>e</mi><mi>a</mi><mi>c</mi><mi>h</mi><mtext> </mtext><mi>n</mi><mi>o</mi><mi>d</mi><mi>e</mi><mtext> </mtext><mi>y</mi><mo>∈</mo><mi>N</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">D_x(y)\leftarrow min\{c(x,v)+D_v(y)，for\ each\ node\ y \in N\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">min</span><span class="mopen">{</span><span class="mord mathnormal">c</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mord cjk_fallback">，</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal" style="margin-right:0.02778em;">or</span><span class="mspace"> </span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord mathnormal">h</span><span class="mspace"> </span><span class="mord mathnormal">n</span><span class="mord mathnormal">o</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">}</span></span></span></span></li><li>如果有 Dv 导致 Dx 更新，则结点 x 向所有邻居发送更新后的 Dx</li><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230526195110681.png" alt="image-20230526195110681" style="zoom:80%;"></li></ul></li></ul></li><li><ul><li><p><strong>迭代、异步</strong>: 每次本地的迭代由 ① 本地链路费用改变 ②Dv 从邻居更新报文</p></li><li><p><strong>分布式</strong>: 每个节点仅当 Dv 改变时通知邻居</p></li></ul></li><li><p>例： <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230526195849646.png" alt="image-20230526195849646" style="zoom:80%;"></p></li></ol><h4 id="距离矢量算法-链路费用改变" tabindex="-1"><a class="header-anchor" href="#距离矢量算法-链路费用改变"><span>距离矢量算法-链路费用改变</span></a></h4><ul><li><p>如果结点检测到链路费用改变：更新路由信息，重新计算距离向量如果距离向量改变，通告邻居</p></li><li><p>好消息传播得快</p><ul><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230526200420761.png" alt="image-20230526200420761"></li></ul><ol><li>时刻 t0: y 检测到链路费用变化(4→1)，更新其 DV，并将此变化通告它的邻居</li><li>时刻 t1: z 接收到来自 y 的更新报文，并据此更新了 z 自己的距离表; z 计算出到 x 的新的最低费用，向其邻居发送了它新的 DV</li><li>时刻 t2: y 接收到的更新消息，更新它的距离表，y 的最低费用没有改变，因此 y 不发送任何报文给 z，算法进入静止状态</li></ol></li><li><p>坏消息传播得慢–计数到无穷</p><ul><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230526201119317.png" alt="image-20230526201119317" style="zoom:80%;"></li></ul><ol><li>时刻 t0: y 检测到链路费用变化(4→60), 但是计算 y 到 x 的最短路径的开销值为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>D</mi><mi>y</mi></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mi>m</mi><mi>i</mi><mi>n</mi><mo stretchy="false">{</mo><mn>60</mn><mo>+</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mstyle mathcolor="orange"><mo stretchy="false">(</mo><msub><mi>D</mi><mi>y</mi></msub><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mstyle><mo>+</mo><mn>5</mn><mstyle mathcolor="orange"><mo stretchy="false">(</mo><msub><mi>D</mi><mi>z</mi></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mstyle><mo stretchy="false">}</mo><mo>=</mo><mn>6</mn></mrow><annotation encoding="application/x-tex">D_y(x)=min\{60+0, 1\textcolor{orange}{(D_y(z))}+5\textcolor{orange}{(D_z(x))}\}=6</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">min</span><span class="mopen">{</span><span class="mord">60</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mopen" style="color:orange;">(</span><span class="mord" style="color:orange;"><span class="mord mathnormal" style="margin-right:0.02778em;color:orange;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:orange;"><span class="mord mathnormal mtight" style="margin-right:0.03588em;color:orange;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mopen" style="color:orange;">(</span><span class="mord mathnormal" style="margin-right:0.04398em;color:orange;">z</span><span class="mclose" style="color:orange;">))</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">5</span><span class="mopen" style="color:orange;">(</span><span class="mord" style="color:orange;"><span class="mord mathnormal" style="margin-right:0.02778em;color:orange;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:orange;"><span class="mord mathnormal mtight" style="margin-right:0.04398em;color:orange;">z</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen" style="color:orange;">(</span><span class="mord mathnormal" style="color:orange;">x</span><span class="mclose" style="color:orange;">))</span><span class="mclose">}</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">6</span></span></span></span> , <!---->, 通知 z</li><li>时刻 t1: z 收到通知, 计算出到 x 的新的最小开销<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>D</mi><mi>z</mi></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mi>m</mi><mi>i</mi><mi>n</mi><mo stretchy="false">{</mo><mn>50</mn><mo>+</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mstyle mathcolor="orange"><mo stretchy="false">(</mo><msub><mi>D</mi><mi>z</mi></msub><mo stretchy="false">(</mo><mi>y</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mstyle><mo>+</mo><mn>6</mn><mstyle mathcolor="orange"><mo stretchy="false">(</mo><msub><mi>D</mi><mi>y</mi></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mstyle><mo stretchy="false">}</mo><mo>=</mo><mn>7</mn></mrow><annotation encoding="application/x-tex">D_z(x)=min\{50+0, 1\textcolor{orange}{(D_z(y))}+6\textcolor{orange}{(D_y(x))}\}=7</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.04398em;">z</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">min</span><span class="mopen">{</span><span class="mord">50</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mopen" style="color:orange;">(</span><span class="mord" style="color:orange;"><span class="mord mathnormal" style="margin-right:0.02778em;color:orange;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:orange;"><span class="mord mathnormal mtight" style="margin-right:0.04398em;color:orange;">z</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen" style="color:orange;">(</span><span class="mord mathnormal" style="margin-right:0.03588em;color:orange;">y</span><span class="mclose" style="color:orange;">))</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord">6</span><span class="mopen" style="color:orange;">(</span><span class="mord" style="color:orange;"><span class="mord mathnormal" style="margin-right:0.02778em;color:orange;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:orange;"><span class="mord mathnormal mtight" style="margin-right:0.03588em;color:orange;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mopen" style="color:orange;">(</span><span class="mord mathnormal" style="color:orange;">x</span><span class="mclose" style="color:orange;">))</span><span class="mclose">}</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">7</span></span></span></span> 通知 y</li><li>时刻 r2: y 收到通知, 计算得到 D<sub>y</sub>(x)=8, 通知 z</li><li>…</li></ol></li><li><p>解决无穷计数问题</p><ol><li>设置迭代次数限制(=16 次结束)</li><li>毒性逆转 <ul><li>如果 Z 路由通过 Y 得到 X: Z 通告 Y，自己到 X 的距离是 o，因此 Y 不能经 z 路由到 X</li><li>这只能解决上面的特殊问题, 3 个结点以上的环路不能被毒性逆转技术检测出来</li></ul></li></ol></li></ul><h2 id="_4-7-互联网中的选路" tabindex="-1"><a class="header-anchor" href="#_4-7-互联网中的选路"><span>4.7 互联网中的选路</span></a></h2><h3 id="_4-7-1-等级选路" tabindex="-1"><a class="header-anchor" href="#_4-7-1-等级选路"><span>4.7.1 等级选路</span></a></h3><blockquote><p>真实的互联网中 ① 路由表不能存储所有的目的地 ② 不能随意地进行路由信息交换和路由选择 ③ 网络管理员需要保护内部网络细节</p><p>→ 进行<!----></p></blockquote><ol><li><!---->(Autonomous System): 一组处于相同管理控制下的路由器聚合<ul><li>一个 AS 由全局唯一的 AS 号(ASN)标识, ASN 有 ICANN 区域管理注册局分配</li><li>同一个 AS 中的路由器运行<strong>相同的路由选择算法</strong></li><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230526210856738.png" alt="image-20230526210856738" style="zoom:67%;"></li></ul></li><li><!---->: 位于 AS 边缘, 通过链路连接其他 AS 的网关路由器</li><li>选路协议 <ul><li>内部路由选择协议（IGP） <ul><li>RIP</li><li>OSPF</li></ul></li><li>外部路由选择协议（EGP) <ul><li>BGP</li></ul></li></ul></li></ol><h3 id="_4-7-2-内部网关路由选择协议" tabindex="-1"><a class="header-anchor" href="#_4-7-2-内部网关路由选择协议"><span>4.7.2 内部网关路由选择协议</span></a></h3><ol><li><p>Internet 采用层次路由</p></li><li><p>AS 内部路由协议也称为<!----></p></li><li><p>最常见的 AS 内部路由协议</p><ul><li><p>路由信息协议 RIP(Routing Information Protocol)</p></li><li><p>开放最短路径优先 OSPF(Open Shortest Path First)</p></li></ul></li></ol><h4 id="rip" tabindex="-1"><a class="header-anchor" href="#rip"><span>RIP</span></a></h4><ul><li><p>距离度量为<strong>跳的数量</strong>(最大=15 跳，16 表示不可达，仅适用于小型互联网); <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230526214615336.png" alt="image-20230526214615336" style="zoom:67%;"></p></li><li><p>距离矢量每 30 秒邻居之间经通告报文交换各自的路由表</p><ul><li>结点检测到网络拓扑变化后，向邻居通告拓扑变化后的信息</li><li>在 180 sec 后，如果没有收到邻居通告--&gt;该邻居/链路被标记为不可达路由，距离设置为 16</li></ul></li><li><blockquote><p>【例】已知路由器 R6 有表 4-9(a)所示的路由表。现在收到相邻路由器 R4 发来的路由更新信息，如表 4-9(b)所示。试更新路由器 R6 的路由表。 <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230617125214735.png" alt="image-20230617125214735" style="zoom:67%;"></p></blockquote></li><li><blockquote><p>【例】路由表更新 <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230617125324383.png" alt="image-20230617125324383" style="zoom:67%;"></p><ul><li>下一跳不同，跳数相同，按照课本要求，不进行替换</li></ul></blockquote></li><li><p>RIP 协议的优缺点：</p><ul><li>RIP 存在的一个问题是当网络出现故障时，要经过比较长的时间才能将此信息传送到所有的路由器。</li><li>RIP 协议最大的优点就是实现简单，开销较小。</li><li>RIP 限制了网络的规模，它能使用的最大距离为 15（16 表示不可达）。</li><li>路由器之间交换的路由信息是路由器中的完整路由表，因而随着网络规模的扩大，开销也就增加。</li></ul></li></ul><h4 id="ospf" tabindex="-1"><a class="header-anchor" href="#ospf"><span>OSPF</span></a></h4><ul><li><!----> ： 为克服 RIP 的缺点而提出来的。<ul><li>“开放”：公共可用</li><li>“最短路径优先”：使用了 Dijkstra 提出的最短路径算法 SPF</li></ul></li><li>OSPF 是基于链路状态（和哪些路由器相邻，以及相应的费用、距离、时延、带宽等）的，而不像 RIP 那样是基于距离向量的</li><li>OSPF 采用 SPF 算法计算路由，从算法上保证了不会产生路由环路</li><li>OSPF<strong>不限制网络规模</strong>，更新效率高，<strong>收敛速度快</strong></li><li>OSPF 有以下五种分组类型 <ol><li>问候（Hello）分组，用来发现和维护邻居路由器的可达性。</li><li>数据库描述（Database Description）分组，向邻居路由器给出自己的链路状态数据库中的所 有链路状态项目的摘要信息</li><li>链路状态请求（Link State Request）分组，向邻居路由器请求发送某些链路状态项目的详细 信息</li><li>链路状态更新（Link State Updata）分组，路由器使用这种分组将其链路状态进行洪泛发 送，即用洪泛法对全网更新链路状态。</li><li>链路状态确认（Link State State Acknowledgment）分组，对链路状态更新分组的确认分 组。</li></ol></li></ul><h3 id="_4-7-3-边界网关路由选择协议-bgp" tabindex="-1"><a class="header-anchor" href="#_4-7-3-边界网关路由选择协议-bgp"><span>4.7.3 边界网关路由选择协议（BGP）</span></a></h3><ul><li><!----><ul><li>在不同的自治系统内，度量路由的“代价”（距离，带宽，费用等）可能不同。因此，对于自治 系统之间的路由选择，使用“代价”作为度量来寻找最佳路由是不行的。 自治系统之间的路由选择必须考虑相关策略（政治，经济，安全等）</li></ul></li><li>BGP 之能是力求寻找一条能够到达目的网络且比较好的路由，而非寻找一条最佳路由</li><li>BGP-4 有以下四种报文 <ul><li>OPEN（打开）报文：用来与相邻的另一个 BGP 发言人建立关系，使通信初始化</li><li>UPDATE（更新）报文：用来通告某一路由的信息，以及列出要撤销的多条路由</li><li>KEEPALIVE（保活）报文：用来周期性地证实邻站的连通性</li><li>NOTIFICATION（通知）报文：用来发送检测到的差错</li></ul></li></ul><h1 id="第五章-数据链路层" tabindex="-1"><a class="header-anchor" href="#第五章-数据链路层"><span>第五章 数据链路层</span></a></h1><blockquote><p>链路层服务原则</p><ul><li>差错检测,纠错</li><li>共享广播信道:多路访问</li><li>链路层编址</li><li>局域网:以太网，虚拟局域网 VLAN</li></ul></blockquote><h2 id="_5-1-概述与服务" tabindex="-1"><a class="header-anchor" href="#_5-1-概述与服务"><span>5.1 概述与服务</span></a></h2><ol><li>链路层术语 <ul><li><!---->: 主机和路由器</li><li><!---->: 沿通信路径的相邻节点的连接<ul><li>分为 有线链路; 无线链路; 局域网</li><li>数据链路层经一条链路, 从一个节点传输数据到相邻节点</li></ul></li><li>链路层分组称为<!---->, 封装数据报</li></ul></li><li>链路协议: <ul><li>可能使用不同的链路协议, 经过不同的链路, 传输数据报 <ul><li>如第一段链路是以太网, 中间链路是帧中继, 最后链路是 802.11</li></ul></li><li>每个链路协议提供不同的服务 <ul><li>如 能/不能经过链路提供可靠数据传输</li></ul></li></ul></li><li>链路层服务 <ul><li><!---->:<ul><li>将数据报封装进帧，加上首部和尾部</li><li>用特殊比特流实现帧同步（涉及透明传输问题)</li></ul></li><li>链路访问: <ul><li>如果共享媒体:多路访问，协调多个节点的帧传输</li><li>位于帧首部的“MAC”地址标识源、目的地</li></ul></li><li>相邻节点间的可靠交付 <ul><li>类似于运输层的确认和重传</li><li>在高差错率的无线链路较为常用 在比特差错低的链路很少使用 (光纤，某些双绞线)</li><li>同时使用链路级和端到端可靠性</li></ul></li><li>流量控制: <ul><li>发送节点和接收节点之间“步调”一致</li></ul></li><li>差错检测: <ul><li>差错由信号衰减、噪声所致</li><li>接收方检测差错的存在 <ul><li>信号发送方负责重传或丢弃帧</li></ul></li></ul></li><li>纠错: <ul><li>接收方识别和纠正比特差错，而不采取重传</li></ul></li><li>半双工和全双工通信控制: <ul><li>使用半双工,链路的两端节点能够传输数据，但只能交替进行</li><li>使用全双工，链路的两端节点能够同时双向传输数据</li></ul></li></ul></li><li><a name="网络适配器">链路层的实现方式–网络适配器</a><ul><li>链路层主体在每个节点(主机/路由器)的<!---->中实现 <ul><li>网络适配器核心是链路层控制器, 实现链路层功能: 成帧, 链路接入, 差错检测等</li><li>网络适配器类型: 以太网卡, PCMCIA 卡, 802.11 卡</li></ul></li><li>适配器与主机系统总线连接, 是软硬件的结合</li><li>适配器通信 <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230526221748680.png" alt="image-20230526221748680" style="zoom:67%;"></li></ul></li></ol><h2 id="_5-2-差错检测和纠错" tabindex="-1"><a class="header-anchor" href="#_5-2-差错检测和纠错"><span>5.2 差错检测和纠错</span></a></h2><h3 id="_5-2-1-差错检测的基本原理" tabindex="-1"><a class="header-anchor" href="#_5-2-1-差错检测的基本原理"><span>5.2.1 差错检测的基本原理</span></a></h3><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230527122203439.png" alt="image-20230527122203439" style="zoom:50%;"><ul><li>EDC: 差错检测和纠错 bits(冗余码) D: 需要进行差错检测的数据 (可能包括首部字段)</li><li>差错检测并非 100%可靠 <ul><li>虽然发生的概率很低，但协议确实有可能漏掉某些差错</li><li>较大的 EDC 字段能产生更好的检测和纠正</li></ul></li></ul><h3 id="_5-2-2-奇偶校验" tabindex="-1"><a class="header-anchor" href="#_5-2-2-奇偶校验"><span>5.2.2 奇偶校验</span></a></h3><ol><li>单比特奇偶校验: 检测单个比特差错 <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230527122429706.png" alt="image-20230527122429706" style="zoom:67%;"></li><li>二维比特奇偶校验: 检测和<strong>纠正</strong>单个比特差错 <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230527122510116.png" alt="image-20230527122510116" style="zoom:50%;"></li></ol><h3 id="_5-2-3-校验和" tabindex="-1"><a class="header-anchor" href="#_5-2-3-校验和"><span>5.2.3 校验和</span></a></h3><ol><li><p>回顾–传输层校验和</p><ul><li>发送方 <ul><li>将待校验内容划分为 16 比特整数序列来处理</li><li>求和: 对 16 比特序列补码求和 (最高位进位 1 回卷至最低位相加)</li><li>校验和: 求和结果取反</li><li>发送方将校验和的值放入 UDP、TCP 的校验和字段</li></ul></li><li>接收方 <ul><li>对接收到的数据计算校验和</li><li>检查计算的校验和是否等于校验和字段的值: <ul><li>不等-检测到差错</li><li>相等-没有检测到差错.尽管如此，还可能有错。详情见后……</li></ul></li></ul></li></ul></li><li><!----><ul><li>将<!---->看作一个二进制数, 选择 r+1 位比特模式<!----> <!----><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230527153733971.png" alt="image-20230527153733971"></li><li>发送方需要得到一个 r 位 CRC 比特<!----> 使得<!---->这个二进制数 能够被 G<mark>模二整除</mark></li><li>接收方知道生成式 G, 使用&lt;D, R&gt;除以 G 若余数全 0,则表示没有差错; 否则说明检测到一个小于 r+1 比特的突发差错;</li></ul></li><li><blockquote><p>例: 待发送的信息为 101001(<!---->)，生成多项式为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><msup><mi>x</mi><mn>3</mn></msup><mo>+</mo><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">G(x) = x^3+x^2+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">G</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>，计算冗余校验码(<!---->)</p></blockquote><ul><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/Screenshot_20230527_155825.jpg" alt="Screenshot_20230527_155825" style="zoom:33%;"> 校验码为<code>101001 001</code></li></ul></li><li><blockquote><p>接收到的信息为 101101001，生成多项式为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><msup><mi>x</mi><mn>3</mn></msup><mo>+</mo><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">G(x) = x^3+ x^2+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">G</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>，判断传输是否误码</p></blockquote><ul><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/Screenshot_20230527_162309.jpg" alt="Screenshot_20230527_162309" style="zoom:33%;"> 存在误码</li></ul></li></ol><h2 id="_5-3-多路访问协议" tabindex="-1"><a class="header-anchor" href="#_5-3-多路访问协议"><span>5.3 多路访问协议</span></a></h2><ol><li>多路访问链路—两类链路 <ol><li>点对点链路 <ul><li>用于拨号接入的 PP</li><li>在以太网交换机和主机之间的点对点链路</li></ul></li><li>广播链路(共享线路/媒体) <ul><li>传统的以太网</li><li>向上游的 HFC</li><li>802.11 无线 LAN</li></ul></li></ol></li></ol><h3 id="_5-3-1-mac-多路控制访问协议" tabindex="-1"><a class="header-anchor" href="#_5-3-1-mac-多路控制访问协议"><span>5.3.1 MAC 多路控制访问协议</span></a></h3><ol><li><p>引入—多路访问遇到的问题</p><ul><li>节点之间的介质有多个并行传输 <ul><li>如果节点同时收到多个信号 发生 <!----></li><li>碰撞会导致接受失败</li></ul></li></ul></li><li><!----><ul><li>采用分布式算法决定节点如何共享信道，例如:决定节点何时能够开始传输信号</li><li>共享信道的通信必须通过信道本身传输! <ul><li>不用带外信道来协调</li></ul></li></ul></li><li><p>一个理想的多路访问控制协议应该做到</p><ul><li><blockquote><p>给定一个速率为 R bps 的广播信道</p></blockquote><ol><li>当只有一个节点传输数据时，它能够以速率 R 发送</li><li>当 M 个节点要传输数据时，每个节点能以平均速率<strong>R/M</strong>发送</li><li>完全分散控制: <ul><li>无特殊节点来协调传输</li><li>无同步时钟、时隙</li></ul></li><li>简单</li></ol></li></ul></li><li><p>MAC 协议分类: <!----></p></li></ol><h3 id="_5-3-2-信道划分" tabindex="-1"><a class="header-anchor" href="#_5-3-2-信道划分"><span>5.3.2 信道划分</span></a></h3><ul><li>信道划分: 将信道划分为较小的“段”(时隙, 频率, 编码), 为节点分配一部分专用</li></ul><ol><li>时分多路访问(TMDA) <ul><li>节点“周期性”访问信道 <ul><li>每个站点在每个周期中获得固定长度的时隙(长度=分组传输时间)</li><li>不使用的时隙进入空闲状态</li></ul></li><li>例子: 6 个站点的 LAN, 时隙 1、3、4 有分组, 时隙 2、5、6 空闲 <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230528002725615.png" alt="image-20230528002725615" style="zoom:50%;"></li></ul></li><li>频分多路访问(FDMA) <ul><li>信道频谱划分为若干带 <ul><li>每个站点分配一个固定的频带未有数据传输的频带为空闲状态</li></ul></li><li>例子:6 个站点的 LAN, 频带 1、3、4 有分组, 频带 2、5、6 空闲 <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230528002839615.png" alt="image-20230528002839615" style="zoom:50%;"></li></ul></li><li>波分多路复用 <ul><li>在一根光线中, 使用多种不同频率的光信号</li></ul></li><li>码分多路复用 <ul><li>使用不同的编码来区分各路原始信号</li></ul></li></ol><h3 id="_5-3-3-随机访问" tabindex="-1"><a class="header-anchor" href="#_5-3-3-随机访问"><span>5.3.3 随机访问</span></a></h3><ol><li>引入当站点有分组要发送 <ul><li>以信道全部速率 R 传输</li><li>节点间无优先权协调</li><li>两个或更多节点传输数据 →“碰撞”, 需要重传</li></ul></li><li>随机访问 MAC 协议定义了: <ul><li>如何检测碰撞</li><li>如何从碰撞中恢复(例如，一段延迟后重新传输)</li></ul></li><li>典型的随机访问 MAC 协议: <ul><li>时隙 ALOHA</li><li>纯 ALOHA</li><li>CSMA,CSMA/CD, CSMA/CA</li></ul></li></ol><h4 id="aloha-协议" tabindex="-1"><a class="header-anchor" href="#aloha-协议"><span>ALOHA 协议</span></a></h4><p>ALOHA 协议: Additive Link On-line HAwaii system, 分为 <!----> 和 <!----></p><blockquote><p>简化计算, 假设每一个帧都是定长的, 发送时间为 T<sub>0</sub></p></blockquote><h5 id="纯-aloha" tabindex="-1"><a class="header-anchor" href="#纯-aloha"><span>纯 ALOHA</span></a></h5><ol><li>基本思想: <ul><li>当节点需要发送数据(帧)时, 可以不进行任何检测就直接发送</li><li>当发生碰撞(没有收到确认), 节点以<strong>概率 p 重传</strong>该帧, 否则等待一个帧的传输时间(T<sub>0</sub>); 之后, 节点继续以概率 p 重传, 否则以 1-p 的概率等待</li></ul></li><li><!---->假设网络负载(T<sub>0</sub>时间内所有站点发送成功的 和 未成功重传的帧数)为 G, 则纯 ALOHA 网络的吞吐量(T<sub>0</sub>时间内成功发送的平均帧数)为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mi>G</mi><msup><mi>e</mi><mrow><mo>−</mo><mn>2</mn><mi>G</mi></mrow></msup></mrow><annotation encoding="application/x-tex">S=Ge^{-2G}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8413em;"></span><span class="mord mathnormal">G</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">2</span><span class="mord mathnormal mtight">G</span></span></span></span></span></span></span></span></span></span></span></span> G=0.5 是, S≈0.184 (这是吞吐量 S 能达到的极大值)<ul><li>说明纯 ALOHA 的吞吐量较低</li></ul></li><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230528191732069.png" alt="image-20230528191732069" style="zoom:50%;"></li></ol><h5 id="时隙-aloha" tabindex="-1"><a class="header-anchor" href="#时隙-aloha"><span>时隙 ALOHA</span></a></h5><ol><li>时隙 ALOHA 协议 基本思想 <ul><li>前提 <ul><li>将所有节点在<strong>时间上同步</strong></li><li>将时间划分为等长时隙(Slot), 节点只能在时隙开始时传输帧</li><li>如果 ≥2 个节点在时隙中传输，所有节点将检测到碰撞</li></ul></li><li>操作 <ul><li>当节点获得新帧，将在下一个时隙中传输</li><li>如果无碰撞，节点能够在下一个时隙继续发送新帧</li><li>如果碰撞，节点在每个后继时隙中以<strong>概率 p 重传</strong>帧，直到发送成功</li></ul></li></ul></li><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230528191950800.png" alt="image-20230528191950800" style="zoom:50%;"></li><li>优缺点 <ul><li>优点 <ul><li>单个活跃节点能够连续以信道的最高速率全速传输</li><li>高速分散:仅节点中的时隙需要同步</li><li>简单</li></ul></li><li>缺点 <ul><li>碰撞，浪费时隙存在空闲时隙</li><li>节点必须能够在小于分组传输时长的时间内检测到碰撞的发生</li><li>需要时钟同步</li></ul></li></ul></li></ol><ul><li>效率 <ul><li><!---->时隙 ALOHA 中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mi>G</mi><msup><mi>e</mi><mrow><mo>−</mo><mi>G</mi></mrow></msup></mrow><annotation encoding="application/x-tex">S=Ge^{-G}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8413em;"></span><span class="mord mathnormal">G</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mathnormal mtight">G</span></span></span></span></span></span></span></span></span></span></span></span>,当 G=1 时, S≈0.368 极大值</li><li><!----> 假定 N 个节点有很多帧要发送，每个节点在每个时隙以概率 p 发送数据对于一个给定节点，在一个时隙中成功发送的概率<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>=</mo><mi>p</mi><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>p</mi><msup><mo stretchy="false">)</mo><mrow><mi>N</mi><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">=p(1-p)^{N-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0913em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span> 任何节点成功发送的概率<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>=</mo><mi>N</mi><mi>p</mi><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>p</mi><msup><mo stretchy="false">)</mo><mrow><mi>N</mi><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">=Np(1-p)^{N-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">Np</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0913em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span><ul><li>效率最大化: 求得 P*使得<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mi>p</mi><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>p</mi><msup><mo stretchy="false">)</mo><mrow><mi>N</mi><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">Np(1-p)^{N-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">Np</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0913em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span> 最大</li><li>对许多节点，当 N 趋近无穷大，取<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mi>p</mi><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>p</mi><msup><mo stretchy="false">)</mo><mrow><mi>N</mi><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">Np(1-p)^{N-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">Np</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0913em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span>极限，得到 1/e = 0.37</li><li>最好情况:信道用于有效数据传输的时间是 37%</li></ul></li></ul></li></ul><h4 id="csma-协议" tabindex="-1"><a class="header-anchor" href="#csma-协议"><span>CSMA 协议</span></a></h4><blockquote><p>CSMA: Carrier Sense Multiple Access 载波监听多路访问</p></blockquote><ul><li>CSMA 基本思想: 在传输前侦听 <ul><li>侦听: 当一个站检测到的信号电压摆动值超过一定的门限值时，就认为总线上至少有两个站同时在发送数据，表明产生了碰撞 <ul><li>侦听到信道空闲:传输整个帧</li><li>侦听到信道忙,推迟传输</li></ul></li></ul></li><li>碰撞还是会发生: <ul><li><strong>传播时延</strong>意味着两个节点可能无法在准备发送数据时 “听到”对方正在进行数据传输</li><li>碰撞发生后继续发送数据帧:浪费信道资源</li></ul></li></ul><h5 id="csma-cd-协议" tabindex="-1"><a class="header-anchor" href="#csma-cd-协议"><span>CSMA/CD 协议</span></a></h5><blockquote><p>CSMA/CD: 载波侦听多路访问/带碰撞检测</p></blockquote><ol><li><p>CSMA/CD</p><ul><li>在短时间内检测到碰撞发生</li><li>碰撞的数据传输被放弃，减少信道浪费</li><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230528202802169.png" alt="image-20230528202802169" style="zoom:50%;"></li></ul></li><li><p>碰撞检测的条件</p><ul><li>有线局域网容易实现:测量信号强度，比较传输的信号和接收的信号</li><li>在无线局域网中困难:由于信号衰减等因素，接收方接收到的信号强度不足</li></ul></li><li><p>CSMA/CD 协议的争用期</p><ul><li><blockquote><p>假设网络带宽:R bps，数据帧最小长度 L(bits)，信号在信道上的传播速度: V(m/s)，通信双方距离为 D(m)</p><p>双方何时检测到冲突?</p></blockquote><ul><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230528202907771.png" alt="image-20230528202907771" style="zoom:67%;"></li></ul></li><li><p>端到端往返时延<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mi>τ</mi></mrow><annotation encoding="application/x-tex">2\tau</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.1132em;">τ</span></span></span></span>称为<!---->，或<!----></p></li><li><p>结论:</p><ol><li>只有当 A 经过争用期这段时间还没有检测到碰撞，才能肯定这次发送不会失败</li><li>A 发送数据帧的最短长度 L 必须满足:<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="#66ccff"><mi>L</mi><mi mathvariant="normal">/</mi><mi>R</mi><mo>≥</mo><mo stretchy="false">(</mo><mn>2</mn><mi>D</mi><mi mathvariant="normal">/</mi><mi>V</mi><mo stretchy="false">)</mo><mo>→</mo><mi>L</mi><mo>≥</mo><mo stretchy="false">(</mo><mn>2</mn><mi>D</mi><mi mathvariant="normal">/</mi><mi>V</mi><mo stretchy="false">)</mo><mo>∗</mo><mi>R</mi></mstyle></mrow><annotation encoding="application/x-tex">\textcolor{#66ccff}{L/R≥(2D/V)→L≥(2D/V)*R}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="color:#66ccff;">L</span><span class="mord" style="color:#66ccff;">/</span><span class="mord mathnormal" style="margin-right:0.00773em;color:#66ccff;">R</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel" style="color:#66ccff;">≥</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen" style="color:#66ccff;">(</span><span class="mord" style="color:#66ccff;">2</span><span class="mord mathnormal" style="margin-right:0.02778em;color:#66ccff;">D</span><span class="mord" style="color:#66ccff;">/</span><span class="mord mathnormal" style="margin-right:0.22222em;color:#66ccff;">V</span><span class="mclose" style="color:#66ccff;">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel" style="color:#66ccff;">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8193em;vertical-align:-0.136em;"></span><span class="mord mathnormal" style="color:#66ccff;">L</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel" style="color:#66ccff;">≥</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen" style="color:#66ccff;">(</span><span class="mord" style="color:#66ccff;">2</span><span class="mord mathnormal" style="margin-right:0.02778em;color:#66ccff;">D</span><span class="mord" style="color:#66ccff;">/</span><span class="mord mathnormal" style="margin-right:0.22222em;color:#66ccff;">V</span><span class="mclose" style="color:#66ccff;">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin" style="color:#66ccff;">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;color:#66ccff;">R</span></span></span></span></li></ol></li></ul></li></ol><h3 id="_5-3-4-轮询访问" tabindex="-1"><a class="header-anchor" href="#_5-3-4-轮询访问"><span>5.3.4 轮询访问</span></a></h3><blockquote><ul><li>信道划分 MAC 协议: <ul><li>在高负载时高效、公平地共享信道</li><li>低负载时低效:信道访问延时，当仅有 1 个活跃节点传输数据时，也仅分配了 1N 带宽!</li></ul></li><li>随机访问 MAC 协议 <ul><li>低负载时效率高:单个节点能够完全利用信道资源</li><li>高负载:碰撞开销</li></ul></li><li>“轮流”访问 MAC 协议 <ul><li>兼有这方面的优点!</li></ul></li></ul></blockquote><ol><li><!----><ul><li>主节点“邀请”从节点依次传输数据</li><li>通常使用“沉默的从设备</li><li>存在问题: <ul><li>轮询开销</li><li>等待时延</li><li>单点故障 (主节点)</li></ul></li></ul></li><li>令牌传递 <ul><li><!---->:一种特殊的数据帧</li><li>控制令牌从一个节点顺序地传递到下一个</li><li>存在问题: <ul><li>令牌开销</li><li>等待时延</li><li>单点故障(令牌)</li></ul></li></ul></li></ol><blockquote><p>MAC 协议小结</p><p>信道划分:通过时间、频率或编码</p><p>随机访问(动态的)</p><ul><li>ALOHA,S-ALOHA,CSMA,CSMA/CD</li><li>CSMA/CD 用在以太网中</li><li>CSMA/CA 用在 802.11 中</li></ul><p>轮流</p><ul><li>主节点轮询;令牌传递</li><li>典型应用:蓝牙、FDDI、令牌环</li></ul></blockquote><h2 id="_5-4-lan-局域网" tabindex="-1"><a class="header-anchor" href="#_5-4-lan-局域网"><span>5.4 LAN 局域网</span></a></h2><h3 id="_5-4-1-链路层寻址与-arp" tabindex="-1"><a class="header-anchor" href="#_5-4-1-链路层寻址与-arp"><span>5.4.1 链路层寻址与 ARP</span></a></h3><ol><li><p>IP 地址与 MAC 地址</p><ul><li><p>32-bit IP 地址:</p><ul><li><p><mark>网络层地址</mark></p></li><li><p>用于使数据报到达目的 IP 子网，支持分组转发</p></li></ul></li><li><!----><ul><li><p><mark>数据链路层地址</mark></p></li><li><p>用于使数据报从一个物理接口到达另一个物理连接的接口(同一个网络内)</p></li><li><p>48 bit MAC 地址(对多数 LAN)固化于适配器 ROM 中，有些可以软件设置</p></li><li><p>例如: b0-df-c1-20-49-b0</p></li></ul></li></ul></li><li><p>LAN 地址 / MAC 地址</p><ul><li>在 LAN 中的每个<a href="#%E7%BD%91%E7%BB%9C%E9%80%82%E9%85%8D%E5%99%A8">适配器</a>都具有独一无二的 LAN 地址 <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230529140644922.png" alt="image-20230529140644922" style="zoom:50%;"></li><li>MAC 地址分配由 IEEE 管理; 制造商购买部分 MAC 地址空间(前 24 比特，确保惟一性)</li><li>类比: <ul><li>MAC 地址:像居民身份证号 身份证号 ↔ 居民 MAC 地址 ↔ 适配器</li><li>IP 地址:像邮政地址 邮政地址 ↔ 住址 IP 地址 ↔ 节点所在子网</li></ul></li><li>MAC 扁平地址 → 可移动性 <ul><li>能够将 LAN 卡从一个 LAN 移动到另一个 LAN</li></ul></li><li>IP 层次地址 <ul><li>取决于节点所在的子网</li></ul></li></ul></li></ol><h4 id="arp-地址解析协议" tabindex="-1"><a class="header-anchor" href="#arp-地址解析协议"><span>ARP 地址解析协议</span></a></h4><blockquote><p>引入问题: 在同一个局域网内, 已知节点 IP 地址, 如何获取节点的 MAC 地址 <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230529141134330.png" alt="image-20230529141134330" style="zoom:67%;"></p><ul><li>LAN 上的每个 IP 节点(主机/路由器)都有<!----></li></ul></blockquote><ol><li><!----><ul><li>结构: &lt;IP 地址; MAC 地址: TTL&gt;</li><li>IP/MAC 地址映射 TTL(time to live 寿命): 地址映射过期时间(通常为 20min)</li></ul></li><li><p>使用方式</p><blockquote><p>主机 A 要向同一个局域网内的主机 B 发送数据报，并且 B 的 MAC 地址<strong>不在 A 的 ARP 表</strong>中</p></blockquote><ol><li>A <mark>广播 ARP 请求</mark> 分组, 请求包含 B 的 IP 地址 <ul><li>目的地 MAC 地址=<code>FF-FF-FF-FF-FF-FF</code></li><li>在 LAN 上的所有机器都会接收到 ARP 请求</li><li><!----></li></ul></li><li>B 接收到 ARP 分组, 用它的 MAC 地址回应 A <ul><li>应答帧发送到 A 的 MAC 地址(<mark>单播</mark> )</li></ul></li><li>A 在它的 ARP 表中缓存(保存)IP-MAC 地址对，直到信息超时 <ul><li>超时后被删除</li></ul></li><li>ARP 是“即插即用”: <ul><li>节点自动创建它们的 ARP 表, 无需网络管理员干预</li></ul></li></ol></li><li><p>选路到另一个 LAN</p><blockquote><p>目的:主机 A 经路由器 R 向主机 B 发送数据报</p><ul><li>假设 A 知道 B 的 IP 地址</li><li>假设 A 知道第一跳路由器 R 的 IP 地址和 MAC 地址</li></ul></blockquote><ol><li><p>A 生成具有源 IP 地址 A、目的 IP 地址 B 的数据报</p><p>A 使用 ARP 解析得到 R 的左侧接口(111.111.111.110)的 MAC 地址 E6-E9-00-17-BB-4B，生成数据帧 <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230529150617283.png" alt="image-20230529150617283" style="zoom:67%;"></p></li><li><p>A 发送数据帧到 R R 接收数据帧，解封装数据报，发送到网络层 <!----><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230529150908861.png" alt="image-20230529150908861" style="zoom:67%;"></p></li><li><p>R 以源 IP 地址 A，目的地址 B 转发数据报 R 使用 B 的 MAC 地址为目的地址，创建数据帧封装 A-to-B IP 数据报, 发送数据帧给 B <!----><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230529150936803.png" alt="image-20230529150936803" style="zoom:67%;"></p></li><li><p>B 接收数据帧，解封装数据报，上交到网络层</p></li></ol></li></ol><h3 id="_5-4-2-以太网" tabindex="-1"><a class="header-anchor" href="#_5-4-2-以太网"><span>5.4.2 以太网</span></a></h3><ol><li><!---->: 使用范围最广的(“占统治地位的”)有线 LAN<!---->技术<ul><li>优点: <ul><li>100Mbs 网卡百元以内</li><li>最先广泛使用的 LAN 技术</li><li>比令牌 LAN 和 ATM 更便宜、配置更简单</li><li>满足用户对网络速率的要求: 10 Mbps - 10 Gbps</li></ul></li></ul></li><li>以太网拓扑结构 <ul><li>逻辑拓扑: 总线拓扑, 广播式局域网, 所有节点都在同一个冲突域</li><li>逻辑拓扑: 星型拓扑/拓展星型结构, 以集线器/交换机为中心 <ul><li>基于集线器的星型结构以太网，本质上还是广播式局域网</li><li>基于交换机的星型结构以太网，每个交换机接口都是一个单独的冲突域</li></ul></li><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230529155757631.png" alt="image-20230529155757631" style="zoom:67%;"></li></ul></li><li>以太网提供的服务 <ul><li>以太网提供的服务是不可靠交付，即尽最大努力的交付。 <ul><li>无连接:在发送和接收适配器之间没有握手</li><li>不可靠:接收适配器不向发送适配器发送确认或否定确认</li></ul></li><li>当接收方收到有差错的数据帧时就丢弃此帧，其他什么也不做。差错的纠正由高层来决定。</li><li>如果高层发现丢失了一些数据而进行重传，但以太网不知道这是一个重传的帧，而是当作一个新的数据帧发送。</li></ul></li></ol><h4 id="以太网-v2-的帧结构" tabindex="-1"><a class="header-anchor" href="#以太网-v2-的帧结构"><span>以太网 V2 的帧结构</span></a></h4><ul><li>发送适配器在以太网帧(或其他网络层协议分组)中封装 IP 数据报</li></ul><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230529160314695.png" alt="image-20230529160314695" style="zoom:67%;"><ul><li>前同步码 (8 字节): <ul><li>模式为前 7 个字节是 10101010，第 8 个字节为 10101011</li><li>用于同步接收方，发送方时钟速率</li></ul></li><li>源/目的地址(各 6 字节): <ul><li>如果适配器接收具有匹配的目的地址或广播地址(如 ARP 分组)的帧,它将帧中的数据提交给网络层协议</li><li>否则,适配器丢弃帧</li></ul></li><li>类型（2 字节)∶ 指示帧中封装的是哪个高层协议分组 (大多数为 IP, 但也可以支持其他类型如 Novell IPX 和 AppleTalk)</li><li>数据（46~1500 字节)∶ 指示上层协议载荷，有效的 MAC 帧长度 64 字节~1518 字节。</li><li>CRC(4 字节)∶ 在接收方核对，如果检测到差错，该帧就被丢弃</li></ul><h4 id="以太网的-csma-cd" tabindex="-1"><a class="header-anchor" href="#以太网的-csma-cd"><span>以太网的 CSMA/CD</span></a></h4><blockquote><p>回顾</p><p>端到端往返时延<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mi>τ</mi></mrow><annotation encoding="application/x-tex">2\tau</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.1132em;">τ</span></span></span></span>称为争用期，或碰撞窗口</p><p>结论:</p><ul><li>只有当 A 经过争用期这段时间还没有检测到碰撞，才能肯定这次发送不会失败。</li><li>A 发送数据帧的最短长度 L 必须满足:<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi mathvariant="normal">/</mi><mi>R</mi><mo>≥</mo><mo stretchy="false">(</mo><mn>2</mn><mi>D</mi><mi mathvariant="normal">/</mi><mi>V</mi><mo stretchy="false">)</mo><mo>→</mo><mi>L</mi><mo>&gt;</mo><mo stretchy="false">(</mo><mn>2</mn><mi>D</mi><mi mathvariant="normal">/</mi><mi>V</mi><mo stretchy="false">)</mo><mo>∗</mo><mi>R</mi></mrow><annotation encoding="application/x-tex">L/R≥(2D/V)→L&gt;(2D/V)*R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">L</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">L</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span></span></span></li></ul><p>10Mbps 以太网争用期定义为 51.2us</p><ul><li>理想情况下，电磁波在电缆中的传输速率为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo>∗</mo><msup><mn>10</mn><mn>5</mn></msup><mi>k</mi><mi>m</mi><mi mathvariant="normal">/</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">2*10 ^5km/s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span></span></span></span></span><span class="mord mathnormal">km</span><span class="mord">/</span><span class="mord mathnormal">s</span></span></span></span></li><li>早期的 10Mbps 以太网最多只能有 5 个网段，4 个中继器器，而其中只允许 3 个网段有设备，其他两个只是传输距离的延长，因此 10Mbps 以太网连接的极限距离是 2500 米。</li><li>所以往返时延<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>25</mn><mi>μ</mi><mi>S</mi><mo>+</mo></mrow><annotation encoding="application/x-tex">25μS+</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord">25</span><span class="mord mathnormal">μ</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord">+</span></span></span></span>中继器的额外时延，预估时延取为 45μs，再加上 48bit 的人为干扰信号 (<mark>强化碰撞</mark> ) 耗时 4.8μs，所以 IEEE 将 10Mbps 以太网的争用期定义为 51.2us。</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>10</mn><mi>M</mi><mi>b</mi><mi mathvariant="normal">/</mi><mi>s</mi><mo>∗</mo><mn>51.2</mn><mi>μ</mi><mi>S</mi><mo>=</mo><mn>512</mn><mi>b</mi><mi>i</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">10Mb/s*51.2μS=512bit</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">10</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal">b</span><span class="mord">/</span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord">51.2</span><span class="mord mathnormal">μ</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">512</span><span class="mord mathnormal">bi</span><span class="mord mathnormal">t</span></span></span></span>，512/8=64 字节，即最小帧长度 64 字节</li></ul></blockquote><ol><li>强化碰撞 <ul><li>发送数据的站点检测到冲突时: <ul><li>立即停止发送数据;</li><li>再继续发送若干比特(32 或 48bit)的人为干扰信号(jamming signal)，以便让所有用户都知道现在已经发生碰撞</li></ul></li></ul></li><li>最小帧间间隔 <ul><li>以太网还规定帧间最小间隔为 9.6 us(对于 10Mbps 以太网相当于 96 比特时间)。</li><li>站点在检测到总线开始空闲后，还要等待 9.6 us 才能再次发送数据。</li><li>目的:为了使刚刚接收到数据帧的接收方的缓存来得及清理，做好接收下一帧的准备。</li></ul></li><li>以太网的 CSMA/CD 协议 <ul><li><strong>总线拓扑</strong>和使用<strong>集线器</strong>的星型拓扑以太网，显然多个节点同时发送时会出现帧碰撞，因此对于这种广播式以太网，使用 CSMA/CD 协议</li><li>对于基于<strong>交换机</strong>的星型结构以太网，采用的是存储转发分组交换，且现代交换机是全双工，不会再有碰撞发生，无需使用 CSMA/CD 协议</li><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230529171532798.png" alt="image-20230529171532798" style="zoom:50%;"></li></ul></li><li><!---->: 发生碰撞的站点在停止发送数据后，要推迟(退避)一个**随机时间**才能再发送数据。<!----><ol><li>确定基本退避时间，一般为争用期<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mi>τ</mi></mrow><annotation encoding="application/x-tex">2\tau</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.1132em;">τ</span></span></span></span></li><li>从整数集合<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">{</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo stretchy="false">(</mo><msup><mn>2</mn><mi>k</mi></msup><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\{0,1,.... (2^k-1)\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0991em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">....</span><span class="mopen">(</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)}</span></span></span></span>中随机地取出一个数，记为<strong>r</strong>。 退避等待时间=r 倍的基本退避时间。</li><li>参数 k 的计算公式:<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>=</mo><mi>M</mi><mi>i</mi><mi>n</mi><mo stretchy="false">{</mo><mtext>重传次数</mtext><mo separator="true">,</mo><mn>10</mn><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">k = Min\{重传次数,10\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal">in</span><span class="mopen">{</span><span class="mord cjk_fallback">重传次数</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">10</span><span class="mclose">}</span></span></span></span></li><li>当重发达 16 次仍不能成功时丢弃该帧，并向高层报告。</li><li>例: <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230529171917275.png" alt="image-20230529171917275" style="zoom:50%;"></li></ol></li></ol><h4 id="以太网信道利用率" tabindex="-1"><a class="header-anchor" href="#以太网信道利用率"><span>以太网信道利用率</span></a></h4><ol><li>以太网的信道被占用的情况: <ul><li>争用期长度为 2r，即端到端传播时延的两倍。假设检测到碰撞后不发送干扰信号。</li><li>帧长为 L(bit)，数据发送速率为 C (b/s)，因而帧的发送时间为 L/C=T<sub>0</sub>(s)。</li></ul></li><li>一个帧从开始发送，经过可能发生的碰撞后，重传多次，直到发送成功且信道转为空闲(即再经过时间<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>τ</mi></mrow><annotation encoding="application/x-tex">\tau</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.1132em;">τ</span></span></span></span>使得信道上无信号在传播)时为止，是发送一帧所需的平均时间 <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230531122849222.png" alt="image-20230531122849222"></li><li>要提高以太网的信道利用率，就必须减小<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>τ</mi></mrow><annotation encoding="application/x-tex">\tau</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.1132em;">τ</span></span></span></span>与 T 之比。 在以太网中定义<!---->，它是以太网单程端到端时延<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>τ</mi></mrow><annotation encoding="application/x-tex">\tau</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.1132em;">τ</span></span></span></span>与帧的发送时间 T<sub>0</sub>之比: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>=</mo><mfrac><mi>τ</mi><msub><mi>T</mi><mn>0</mn></msub></mfrac></mrow><annotation encoding="application/x-tex">a=\frac{\tau}{T_0}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1405em;vertical-align:-0.4451em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6954em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.1389em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.1132em;">τ</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4451em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><ul><li>a→0 表示一发生碰撞就立即可以检测出来，并立即停止发送，因而信道利用率很高。</li><li>a 越大，表明争用期所占的比例增大，每发生一次碰撞就浪费许多信道资源，使得信道利用率明显降低</li></ul></li><li><!----><ul><li>当数据率一定时，以太网的连线长度受到限制，否则<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>τ</mi></mrow><annotation encoding="application/x-tex">\tau</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.1132em;">τ</span></span></span></span>的数值会太大。</li><li>以太网的帧长不能太短，否则 T<sub>0</sub>的值会太小，使 a 值太大。</li><li>在理想情况下，以太网上的各站发送数据都不会产生碰撞，即总线一旦空闲就有某一个站立即发送数据。</li><li>发送一帧占用线路的时间是<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mn>0</mn></msub><mo>+</mo><mi>τ</mi></mrow><annotation encoding="application/x-tex">T_0+ \tau</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.1132em;">τ</span></span></span></span>，而帧本身的发送时间是 T<sub>0</sub>。 于是理想情况下极限信道利用率<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="#66ccff"><msub><mi>S</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub><mo>=</mo><mfrac><msub><mi>T</mi><mn>0</mn></msub><mrow><msub><mi>T</mi><mn>0</mn></msub><mo>+</mo><mi>τ</mi></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mrow><mn>1</mn><mo>+</mo><mi>a</mi></mrow></mfrac></mstyle></mrow><annotation encoding="application/x-tex">\textcolor{#66ccff}{S_{max}=\frac{T_0}{T_0+\tau}=\frac{1}{1+a}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord" style="color:#66ccff;"><span class="mord mathnormal" style="margin-right:0.05764em;color:#66ccff;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:#66ccff;"><span class="mord mtight" style="color:#66ccff;"><span class="mord mathnormal mtight" style="color:#66ccff;">ma</span><span class="mord mathnormal mtight" style="color:#66ccff;">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel" style="color:#66ccff;">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.3335em;vertical-align:-0.4451em;"></span><span class="mord" style="color:#66ccff;"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8884em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight" style="color:#66ccff;"><span class="mord mtight" style="color:#66ccff;"><span class="mord mtight" style="color:#66ccff;"><span class="mord mathnormal mtight" style="margin-right:0.13889em;color:#66ccff;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.1389em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight" style="color:#66ccff;"><span class="mord mtight" style="color:#66ccff;">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mbin mtight" style="color:#66ccff;">+</span><span class="mord mathnormal mtight" style="margin-right:0.1132em;color:#66ccff;">τ</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="color:#66ccff;border-bottom-width:0.04em;"></span></span><span style="top:-3.4101em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight" style="color:#66ccff;"><span class="mord mtight" style="color:#66ccff;"><span class="mord mtight" style="color:#66ccff;"><span class="mord mathnormal mtight" style="margin-right:0.13889em;color:#66ccff;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.1389em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight" style="color:#66ccff;"><span class="mord mtight" style="color:#66ccff;">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4451em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel" style="color:#66ccff;">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2484em;vertical-align:-0.4033em;"></span><span class="mord" style="color:#66ccff;"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight" style="color:#66ccff;"><span class="mord mtight" style="color:#66ccff;"><span class="mord mtight" style="color:#66ccff;">1</span><span class="mbin mtight" style="color:#66ccff;">+</span><span class="mord mathnormal mtight" style="color:#66ccff;">a</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="color:#66ccff;border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight" style="color:#66ccff;"><span class="mord mtight" style="color:#66ccff;"><span class="mord mtight" style="color:#66ccff;">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4033em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></li></ul></li></ol><h4 id="不同的以太网技术" tabindex="-1"><a class="header-anchor" href="#不同的以太网技术"><span>不同的以太网技术</span></a></h4><ul><li>许多不同的以太网技术 <ul><li>通用的 MAC 协议和帧格式</li><li>不同的速率: 2 Mbps,10 Mbps,100 Mbps, 1Gbps, 10Gbps</li><li>不同的物理介质: 光纤，电缆</li><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230531140504561.png" alt="image-20230531140504561" style="zoom:80%;"></li></ul></li><li>以太网技术的发展 <ul><li>传统以太网最初使用粗同轴电缆，后来演进到使用较便宜细同轴电缆，最后发展为使用更便宜和灵活的双绞线。</li><li>T 表示双绞线(Twisted Pair)，如 10Base-T 和 100Base-T; 10BASE-T 的通信距离稍短，节点连接到一台集线器:“星型拓扑”; 每个站到集线器的距离不超过 100 m</li><li>10/100 Mbps 速率，后者被称为“快速以太网”</li><li>10BASE-T 无屏蔽双绞线星形以太网的出现，既降低成本，又提高可靠性, 为以太网在局域网中统治地位奠定牢固的基础。</li></ul></li></ul><h3 id="_5-4-3-链路层交换机" tabindex="-1"><a class="header-anchor" href="#_5-4-3-链路层交换机"><span>5.4.3 链路层交换机</span></a></h3><ol><li>广播域与冲突域 <ul><li><!---->是一个<strong>逻辑</strong>上的计算机组，接收同样广播消息的节点集合。<ul><li>如:在该集合中的任何一个节点传输一个广播帧，则所有其他能收到这个帧的节点都被认为是该广播域的一部分。</li><li>所以类似 Hub、二层交换机等节点都被认为都是同一个广播域。而路由器，第三层交换机则连接不同的广播域。</li></ul></li><li><!---->是一种<strong>物理</strong>分段，是指连接在同一物理介质上的所有站点的集合<ul><li>同一冲突域中的设备互联时，同一时刻只允许一个设备发送的数据从共享的物理通道中通过，其他设备发送的数据则要等到这个通道处于&quot;空闲&quot;时才可以通过，否则会出现冲突。</li><li>连接同一冲突域的设备有集线器，中继器或者其他进行简单复制信号的设备。</li></ul></li></ul></li><li>集线器互联 <ul><li>主干集线器互联 LAN 网段</li><li>扩展局域网范围，但单独碰撞域会合并为一个大的碰撞域 <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230531141314694.png" alt="image-20230531141314694" style="zoom:50%;"></li><li>不能互联使用不同以太网技术的局域网(如 10BaseT 和 100BaseT)</li></ul></li></ol><h4 id="链路层交换机" tabindex="-1"><a class="header-anchor" href="#链路层交换机"><span>链路层交换机</span></a></h4><ol><li>链路层交换机 <ul><li>功能: <ul><li>存储并转发以太网帧</li><li>检查帧首部并基于 MAC 目的地址选择性地转发帧</li></ul></li><li>优点: <ul><li>透明，主机不知道交换机的存在</li><li>即插即用,自学习，交换机不必配置</li></ul></li><li>缺点: <ul><li>主机和路由器 ARP 表较大，生成可观的 ARP 处理量和流量大</li><li>交换机组成的网络是一个广播域，无法防范广播风暴(转发广播帧)</li></ul></li></ul></li><li>连接方式 <ul><li>主机直接连接到交换机接口</li><li>交换机输出接口设有缓存</li><li>全双工通信</li><li>交换:A-to-A&#39;和 B-to-B&#39;可以同时发送，无碰撞(每一个交换机接口都是独立的冲突域)，不再需要 MAC 协议</li><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230531142100121.png" alt="image-20230531142100121" style="zoom:67%;"></li></ul></li></ol><h4 id="交换机连接-lan" tabindex="-1"><a class="header-anchor" href="#交换机连接-lan"><span>交换机连接 LAN</span></a></h4><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230531142213009.png" alt="image-20230531142213009" style="zoom:80%;"><ul><li>当交换机接口直接连接了集线器，而集线器又连接了多台主机时, 每个集线器连接的局域网需要使用 MAC 协议。</li></ul><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230531142307359.png" alt="image-20230531142307359" style="zoom:80%;"><ul><li>交换机将子网分割成 LAN，LAN 成为分离的碰撞域</li><li>交换机过滤分组: LAN 内的数据帧通常不在其他 LAN 上转发</li></ul><h4 id="交换机转发表" tabindex="-1"><a class="header-anchor" href="#交换机转发表"><span>交换机转发表</span></a></h4><blockquote><p><s>不就是 ARP 吗???</s> 不是啊</p></blockquote><ol><li><p>交换机的<!----></p><ul><li>转发表结构: <code>[MAC地址, 接口, 生存期]</code></li><li>超过生存期的表项被删除</li><li>收到数据帧时，交换机“得知”发送方在哪个接口</li><li>交换机中记录了“发送方—接口”的映射关系</li></ul></li><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230531143108376.png" alt="image-20230531143108376" style="zoom:50%;"></li><li><p>例: 交换机与集线器互联 <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230531144135386.png" alt="image-20230531144135386" style="zoom:67%;"></p><ol><li>交换机从 C 接收帧 <ul><li>注意到交换机表中 c 位于接口 1(添加 C 的表项)</li><li>因为 D 不在表中,交换机将向接口 2 和 3 转发帧（洪泛)</li></ul></li><li>D 接收帧</li></ol><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230531144341372.png" alt="image-20230531144341372" style="zoom:67%;"><ol start="3"><li>交换机从 D 接收帧 <ul><li>注意到在交换机表中 D 位于接口 2**(添加表项 D)<!---->**</li><li>因为 C 在表中,交换机仅向接口 1 转发帧</li></ul></li><li>C 接收帧</li></ol></li><li><p>交换机与交换机互联—自学习与转发</p><ul><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230531144540362.png" alt="image-20230531144540362" style="zoom:67%;"></li><li>当 A 向 G 发送数据帧时，S1 如何知道必须通过 S4 转发?而 S4 如何知道通过 S3 转发? <ul><li>也是通过自学习生成交换表</li></ul></li></ul></li></ol><h4 id="交换机-vs-路由器" tabindex="-1"><a class="header-anchor" href="#交换机-vs-路由器"><span>交换机 vs 路由器</span></a></h4><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230531145159098.png" alt="image-20230531145159098" style="zoom:67%;"><ul><li>两者都是存储转发设备 <ul><li>路由器:网络层设备(检查网络层首部)</li><li>交换机:链路层设备(检查链路层首部)</li></ul></li><li>两者都有转发表: <ul><li>路由器使用选路算法维护转发表，依靠 IP 地址</li><li>交换机使用洪泛、自学习维护转发表，依靠 MAC 地址</li></ul></li><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230531145557943.png" alt="image-20230531145557943" style="zoom:67%;"> - 集线器和交换机适用于LAN(局域网) </li></ul><h3 id="_5-4-4-vlan-虚拟局域网" tabindex="-1"><a class="header-anchor" href="#_5-4-4-vlan-虚拟局域网"><span>5.4.4 VLAN 虚拟局域网</span></a></h3><ol><li>引入 <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230531150025312.png" alt="image-20230531150025312" style="zoom:67%;"> 左图网络拓扑存在的问题: <ol><li>管理用户:CS 用户移动到 EE，但他可能希望继续连接 CS 的交换机?</li><li>可能造成交换机部署上的浪费(如机构内部存在多个小组，但每个小组组规模很小)</li><li>单个广播域缺乏流量隔离: <ul><li>所有的二层广播流量(例如携带 ARP 和 DHCP 的报文、或那些目的 MAC 地址还未被交换机学习到的帧) 仍然必须跨越整个机构网络</li><li>带来安全性、效率问题</li></ul></li></ol></li><li><!---->: 支持 VLAN 功能的交换机(ES)允许在一个单一的物理 LAN 上定义多个虚拟局域网<ul><li>这样, 单个物理交换机就可以操作多个虚拟交换机</li></ul></li><li><!----><ul><li>交换机端口分组(通过交换机管理软件)</li><li>流量隔离:只能在属于相同 VLAN 的端口之间交付帧 <ul><li>也可以根据端点的 MAC 地址定义 VLAN，而不是交换端口</li></ul></li><li>动态成员:端口可以动态的在 VLAN 之间分配 <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230531151622661.png" alt="image-20230531151622661" style="zoom:67%;"></li><li>VLAN 之间转发:通过路由器完成</li></ul></li><li>跨越多个多交换机的 VLAN <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230531152125483.png" alt="image-20230531152125483" style="zoom:80%;"><ul><li>干线端口:发送到任何 VLAN 的帧，经过干线端口和链路，转发到其他物理交换机 <ul><li>交换机内 VLAN 转发的帧不能是 802.1 帧 (必须携带 VLANID 信息)</li><li>定义了扩展的以太网 802.1Q 协议用于跨越 VLAN 干线的帧</li></ul></li></ul></li><li>802.1QVLAN 帧格式 <ul><li>标准的以太网帧+4 字节的 VLAN 标签组成。</li><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230531152308982.png" alt="image-20230531152308982"></li></ul></li></ol><h2 id="_5-5-ppp-点对点协议" tabindex="-1"><a class="header-anchor" href="#_5-5-ppp-点对点协议"><span>5.5 PPP 点对点协议</span></a></h2><blockquote><p>广域网使用的协议主要在网络层, 常见的两种广域网链路层协议是 PPP 协议和 HDLC 协议</p></blockquote><ol><li><p>点对点链路层控制</p><ul><li>一个发送方、一个接收方、一段链路:比广播链路容易处理: <ul><li>无需媒体访问控制</li><li>不需要明确的 MAC 寻址</li><li>如拨号链路、ISDN 链路</li></ul></li><li>流行的点对点 DLC 协议: <ul><li><!----></li><li>HDLC:高级数据链路控制(数据链路过去被认为位于协议栈的“高层”!)</li></ul></li></ul></li><li><p>PPP 设计要求</p><ul><li><!---->:在数据链路帧中封装网络层数据报<ul><li>同时承载任何网络层协议分组(不止是 IP)</li><li>向上层实现多路分解</li></ul></li><li><!---->:在数据字段必须承载任何比特模式差错检测:不纠错，丢弃差错帧</li><li><!---->:检测、向网络层通告链路故障</li><li><!---->:如 PPPOE，允许多个连接在以太网的用户共享一条到 ISP 的宽带链路。</li><li><!---->:网络层实体能够协商或配置彼此的网络地址</li></ul></li><li><p>PPP 数据帧</p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230531153222968.png" alt="image-20230531153222968" style="zoom:80%;"><ul><li>标志:定界符(成帧)</li><li>地址:不起作用(仅是一个选项)</li><li>控制:不起作用﹔以后可能有多种控制字段</li><li>协议:该帧交付的高层协议(如 PPP-LCP, IP, IPCP 等)信息:上层协议的分组数据</li><li>校验:实现差错检测的冗余循环校验</li></ul></li></ol><h4 id="ppp-数据传输-帧定界" tabindex="-1"><a class="header-anchor" href="#ppp-数据传输-帧定界"><span>PPP 数据传输 （帧定界）</span></a></h4><blockquote><p>考虑:发送方向接收方发送了若干数据帧，接收方如何从比特流中区分出数据帧?</p><ul><li>解决方案:使用帧定界符，PPP 为 0x7E(01111110)</li></ul><p>考虑:如果数据字段中出现了和帧定界符 01111110 一样的比特流，接收方会误判为上一个帧结束了，如何解决?</p><ul><li>解决方案:采用透明传输，即按某种规则对数据进行“转义”</li></ul></blockquote><ol><li>PPP 异步传输的字符填充法 <ul><li>对于发送方的转义规则为: <ul><li>信息字段中出现的每一个<code>0x7E</code>字节序列，转变成为 2 字节序列<code>[0x7D,0x5E]</code>。</li><li>信息字段中出现的一个<code>0x7D</code>的字节序列，转变成为 2 字节序列<code>[0x7D, 0x5D]</code>。</li><li>信息字段中出现 ASCII 码的控制字符(即数值小于 0x20 的字符)，转变为 2 字节序列（0x7D 字节，该字符与 0X20 异或值)</li><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230531155534944.png" alt="image-20230531155534944" style="zoom:80%;"></li></ul></li><li>总结: <code>7E</code>开始/结束符; <code>原7E</code>→<code>7D 5E</code>; <code>原7D</code>→ <code>7D 5D</code></li></ul></li><li>PPP 同步传输的零比特填充 <ul><li>PPP 协议用在 SONET/SDH 链路时，使用同步传输（一连串的比特连续传送)。 <ul><li>这时 PPP 协议采用<strong>零比特填充</strong>方法来实现透明传输。</li></ul></li><li>在发送端，只要发现有 5 个连续 1，则立即填入一个 0。</li><li>接收端对帧中的比特流进行扫描。每当发现 5 个连续 1 时，就把这 5 个连续 1 后的一个 0 删除。</li><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230531155651564.png" alt="image-20230531155651564" style="zoom:80%;"></li></ul></li></ol><h4 id="ppp-数据控制协议" tabindex="-1"><a class="header-anchor" href="#ppp-数据控制协议"><span>PPP 数据控制协议</span></a></h4><ul><li>在交换网络层数据前，数据链路对等方必须:LCP\NCP <ul><li>LCP 链路控制协议: 配置 PPP 链路(如最大的帧长，身份鉴别协议等)</li><li>NCP 网络控制协议: 学习/配置网络层信息 <ul><li>对 IP:使用 IP 控制协议(IPCP)分组，封装成 PPP 帧(协议字段:8021)，完成 IP 地址等相关信息的配置</li></ul></li></ul></li></ul><h1 id="第六章-物理层" tabindex="-1"><a class="header-anchor" href="#第六章-物理层"><span>第六章 物理层</span></a></h1><blockquote><p>这一小节补充 PPT：<a href="https://note.youdao.com/ynoteshare1/index.html?id=cf0592e2b1b463a48e9c8a0ef3c1396a&amp;type=notebook#/b435c72341f168a19f766acb8dc19833">物理层</a></p></blockquote><h2 id="_6-1-物理层基础概念" tabindex="-1"><a class="header-anchor" href="#_6-1-物理层基础概念"><span>6.1 物理层基础概念</span></a></h2><ul><li><p>物理层解决如何在连接各种计算机的传输媒体上<strong>传输数据比特流</strong>，而不是指具体的传输媒体</p></li><li><p>物理层的作用是要尽可能地屏蔽掉不同传输媒体和通信手段的差异。</p></li><li><p>用于物理层的协议也常称为物理层<!---->。</p></li><li><p>物理层特性：</p><ul><li><!---->：指明接口所用接线器的<strong>形状和尺寸</strong>、引线数目和排列、固定和锁定装置等。</li><li><!---->：指明在接口电缆的各条线上出现的<strong>电压的范围</strong>。</li><li><!---->：指明某条线上出现的某一电平的<strong>电压的意义</strong>。</li><li><!----> ：指明对于不同功能的各种可能事件的<strong>出现顺序</strong>。</li></ul></li></ul><h2 id="_6-2-数据通信基础知识" tabindex="-1"><a class="header-anchor" href="#_6-2-数据通信基础知识"><span>6.2 数据通信基础知识</span></a></h2><h3 id="_6-2-1-数据通信系统的模型" tabindex="-1"><a class="header-anchor" href="#_6-2-1-数据通信系统的模型"><span>6.2.1 数据通信系统的模型</span></a></h3><p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230616131708039.png" alt="image-20230616131708039"></p><p>常用术语</p><ul><li><!---->(data)：传递信息的实体，通常是有意义的符号序列。</li><li><!---->(signal)：数据的电气/电磁的表现，是数据在传输过程中的存在形式。<ul><li>数字信号：代表消息的参数取值是<strong>离散</strong>的 (字符, 数字)</li><li>模拟信号：代表信号的参数取值是<strong>连续</strong>的 (声音)</li></ul></li><li><!----> (code) —— 在使用时间域（或简称为时域）的波形表示数字信号时，代表不同离散数值的基本波形。</li></ul><h3 id="_6-2-2-信道的基本概念" tabindex="-1"><a class="header-anchor" href="#_6-2-2-信道的基本概念"><span>6.2.2 信道的基本概念</span></a></h3><h4 id="信道" tabindex="-1"><a class="header-anchor" href="#信道"><span>信道</span></a></h4><ul><li><!---->：产生和发送数据的源头。</li><li><!---->：接收数据的终点</li><li><!---->：信号的传输媒介。一般用来表示像某一个方向传输信号的介质，因此一条通信线路往往包含一条发送信道和一条接收信道。</li></ul><h4 id="三种通信方式" tabindex="-1"><a class="header-anchor" href="#三种通信方式"><span>三种通信方式</span></a></h4><ul><li><!---->：只有一个方向的通信而没有反方向的交互，仅需一条信道。</li><li><!---->：通信的双方都可以发送或接受信息，但任何一方都<strong>不能同时发送和接收</strong>，需要两条信道。</li><li><!---->：通信双方可以同时发送和接收信息，也需要两条信道。</li></ul><p>两种数据传输方式：</p><ul><li><strong>串行传输</strong>：速度慢，费用低，适合远距离</li><li><strong>并行传输</strong>：速度快，费用高，适合近距离</li></ul><h4 id="常用编码方式" tabindex="-1"><a class="header-anchor" href="#常用编码方式"><span>常用编码方式</span></a></h4><ul><li><!---->：正电平代表 1，负电平代表 0。</li><li><!---->：正脉冲代表 1，负脉冲代表 0。</li><li><!---->：位周期中心的向上跳 ↑ 变代表 0，位周期中心的向下跳变 ↓ 代表 1。但也可反过来定义。</li><li><!---->：在每一位的中心处始终都有跳变。位开始边界有跳变代表 0<!---->，而位开始边界没有跳变代表 1<!----></li></ul><p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230616141516395.png" alt="image-20230616141516395"></p><ul><li>几种编码方式的特点 <ul><li>从信号波形中可以看出，曼彻斯特 (Manchester) 编码和差分曼彻斯特编码产生的信号<strong>频率比不归零制高</strong>。</li><li>从<!---->来看，不归零制不能从信号波形本身中提取信号时钟频率（这叫做没有自同步能力），而曼彻斯特编码和差分曼彻斯特编码具有自同步能力。</li></ul></li></ul><h4 id="调制" tabindex="-1"><a class="header-anchor" href="#调制"><span>调制</span></a></h4><ul><li><!---->（即基本频带信号）—— 来自信源的信号。(像计算机输出的代表各种文字或图像文件的数据信号都属于基带信号)。<p>基带信号往往包含有较多的低频成分，甚至有直流成分，而许多信道并不能传输这种低频分量或直流分量。因此必须对基带信号进行<!----> (modulation)</p></li><li><p>调制的分类</p><ul><li>基带调制：仅对基带信号的波形进行变换，使它能够与信道特性相适应。变换后的信号<strong>仍然是基带信号</strong>。把这种过程称为<!----> (coding)。</li><li>带通调制：使用<!----> (carrier)进行调制，把基带信号的频率范围搬移到较高的频段，并转换为模拟信号，这样就能够更好地在模拟信道中传输（即仅在一段频率范围内能够通过信道） <ul><li>带通信号 ：经过载波调制后的信号</li></ul></li></ul></li><li><p>基本的<strong>二元制</strong>调制方法</p><ol><li><!---->：载波的振幅随基带数字信号而变化。</li><li><!---->：载波的频率随基带数字信号而变化。</li><li><!---->：载波的初始相位随基带数字信号而变化。</li></ol><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230616142257867.png" alt="image-20230616142257867" style="zoom:50%;"></li><li><p>正交振幅调制 QAM (Quadrature Amplitude Modulation) : 为了达到更高的信息传输速率，采用技术上更为复杂的多元制的振幅相位混合调制方法。</p><ul><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230616143351467.png" alt="image-20230616143351467" style="zoom:50%;"> 12 种相位, 16 种组合 即 16 个码元; 一个码元传递 4bit 的信息, 数据传输率提高 4 倍</li><li>不是码元越多越好。若每一个码元可表示的比特数越多，则在接收端进行解调时要正确识别每一种状态就越困难，出错率增加</li></ul></li></ul><h3 id="_6-2-3-信道的极限容量" tabindex="-1"><a class="header-anchor" href="#_6-2-3-信道的极限容量"><span>6.2.3 信道的极限容量</span></a></h3><blockquote><p>任何实际的信道都不是理想的，在传输信号时会产生各种失真以及带来多种干扰。</p><p>码元传输的速率越高，或信号传输的距离越远，或传输媒体质量越差，在信道的输出端的波形的失真就越严重。</p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230616144455208.png" alt="image-20230616144455208" style="zoom:50%;"></blockquote><ul><li>从概念上讲，限制码元在信道上的传输速率的因素有以下两个： <ul><li>信道能够通过的频率范围</li><li>信噪比</li></ul></li></ul><ol><li><p>奈奎斯特定理 (奈氏准则)</p><ul><li><!---->在任何信道中，码元传输的速率是有上限的，否则就会出现码间串扰的问题，使接收端对码元的判决（即识别）成为不可能</li><li>在理想低通(<strong>无噪声</strong>, <strong>带宽有限</strong>)的信道中, 为避免码间串扰, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>极限码元传输速率</mtext><mo>=</mo><mn>2</mn><mi>W</mi><mo stretchy="false">(</mo><mtext>波特</mtext><mo stretchy="false">)</mo><mo>=</mo><mn>2</mn><mi>W</mi><mi>l</mi><mi>o</mi><msub><mi>g</mi><mn>2</mn></msub><mi>V</mi><mo stretchy="false">(</mo><mi>b</mi><mi mathvariant="normal">/</mi><mi>s</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">极限码元传输速率=2W(波特)=2Wlog_2 V(b/s)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">极限码元传输速率</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mopen">(</span><span class="mord cjk_fallback">波特</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mopen">(</span><span class="mord mathnormal">b</span><span class="mord">/</span><span class="mord mathnormal">s</span><span class="mclose">)</span></span></span></span> <!----><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi></mrow><annotation encoding="application/x-tex">W</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span></span></span></span>: 理想低通信道的带宽</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi></mrow><annotation encoding="application/x-tex">V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span>: 每个码元离散电平的数目</li></ul></li></ul></li><li><!----><ul><li><p>信噪比就是信号的平均功率和噪声的平均功率之比。常记为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi mathvariant="normal">/</mi><mi>N</mi></mrow><annotation encoding="application/x-tex">S/N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span>，并用分贝 (dB) 作为度量单位。</p><p>即：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>信噪比</mtext><mo stretchy="false">(</mo><mi>d</mi><mi>B</mi><mo stretchy="false">)</mo><mo>=</mo><mn>10</mn><mi>l</mi><mi>o</mi><mi>g</mi><mn>10</mn><mo stretchy="false">(</mo><mi>S</mi><mi mathvariant="normal">/</mi><mi>N</mi><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>d</mi><mi>B</mi><mo stretchy="false">)</mo><mo separator="true">;</mo><mi>S</mi><mi mathvariant="normal">/</mi><mi>N</mi><mo>=</mo><msup><mn>10</mn><mrow><mtext>信噪比</mtext><mi mathvariant="normal">/</mi><mn>10</mn></mrow></msup></mrow><annotation encoding="application/x-tex">信噪比(dB) = 10 log10(S/N ) (dB); S/N=10^{信噪比/10}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord cjk_fallback">信噪比</span><span class="mopen">(</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">10</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord">10</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.888em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord cjk_fallback mtight">信噪比</span><span class="mord mtight">/10</span></span></span></span></span></span></span></span></span></span></span></span></p></li><li><p>例如，当 S/N=10 时，信噪比为 10dB，而当 S/N=1000 时，信噪比为 30dB</p></li></ul></li><li><p>香农定理</p><ul><li><strong>带宽受限</strong>且有高斯白噪声的<strong>干扰</strong>的信道的极限数据传输速率, 用此速率传输不会产生误差</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>信道的极限传输速率</mtext><mo>=</mo><mi>W</mi><mi>l</mi><mi>o</mi><msub><mi>g</mi><mn>2</mn></msub><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><mi>S</mi><mi mathvariant="normal">/</mi><mi>N</mi><mo stretchy="false">)</mo><mtext> </mtext><mo stretchy="false">(</mo><mi>b</mi><mi mathvariant="normal">/</mi><mi>s</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">信道的极限传输速率=W log_2(1+S/N)\ (b/s)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">信道的极限传输速率</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">)</span><span class="mspace"> </span><span class="mopen">(</span><span class="mord mathnormal">b</span><span class="mord">/</span><span class="mord mathnormal">s</span><span class="mclose">)</span></span></span></span><ul><li>W 为信道的带宽（以 Hz 为单位）； S 为信道内所传信号的平均功率； N 为信道内部的高斯噪声功率。</li></ul></li></ul></li></ol><blockquote><p>对于频带宽度已确定的信道, 提高传输速率的方法</p><ol><li>提高信噪比</li><li>提高码元传输速率</li><li>改进编码, 使得一个码元携带更多信息</li></ol></blockquote><h2 id="_6-3-物理层下的传输媒体" tabindex="-1"><a class="header-anchor" href="#_6-3-物理层下的传输媒体"><span>6.3 物理层下的传输媒体</span></a></h2><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230616155245615.png" alt="image-20230616155245615" style="zoom:50%;"><!---->也称为<!---->或<!---->，它就是数据传输系统中在发送器和接收器之间的物理通路。<p>传输媒体可分为两大类，即导引型传输媒体和非导引型传输媒体。</p><ul><li>在导引型传输媒体中，电磁波被导引沿着固体媒体（铜线或光纤）传播。</li><li>非导引型传输媒体就是指自由空间。在非导引型传输媒体中，电磁波的传输常称为无线传输。</li></ul><h3 id="_6-3-1-导引型传输媒体" tabindex="-1"><a class="header-anchor" href="#_6-3-1-导引型传输媒体"><span>6.3.1 导引型传输媒体</span></a></h3><ol><li><p>双绞线：</p><ul><li><p>局域网中的主流传输媒体</p></li><li><p>模拟传输和数字传输都可以使用双绞线，其通信距离一般为几到十几公里</p></li><li><p><strong>屏蔽双绞线 STP</strong>(Shielded Twisted Pair)</p></li><li><p><strong>无屏蔽双绞线 UTP</strong>(Unshielded Twisted Pair)</p></li><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230616160248962.png" alt="image-20230616160248962" style="zoom:50%;"></li></ul></li><li><p>同轴电缆：</p><ul><li><p>同轴电缆具有很好的抗干扰特性，被广泛用于传输较高速率的数据。</p></li><li><p>同轴电缆的带宽取决于电缆的质量。</p></li><li><p><strong>细缆</strong>（适合短距离，安装容易，造价低）</p></li><li><p><strong>粗缆</strong>（适合较大局域网，布线距离长，可靠性好）</p></li><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230616160952986.png" alt="image-20230616160952986" style="zoom:50%;"></li></ul></li><li><p>光缆</p><ul><li>光纤是光纤通信的传输媒体。</li><li>由于可见光的频率非常高，约为 108 MHz 的量级，因此一个光纤通信系统的传输带宽远远大于目前其他各种传输媒体的带宽</li><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230616162034225.png" alt="image-20230616162034225" style="zoom:50%;"> - 只要从纤芯中射到纤芯表面的光线的入射角大于某个临界角度，就可产生全反射。 </li><li><!---->: 可以存在多条不同角度入射的光线在一条光纤中传输。</li><li><!---->: 若光纤的直径减小到只有一个光的波长，则光纤就像一根波导那样，它可使光线一直向前传播，而不会产生多次反射。</li><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230616162226817.png" alt="image-20230616162226817" style="zoom:50%;"></li><li>光纤优点 <ul><li>通信容量非常大。</li><li>传输损耗小，中继距离长。</li><li>抗雷电和电磁干扰性能好。</li><li>无串音干扰，保密性好。</li><li>体积小，重量轻。</li></ul></li></ul></li></ol><h3 id="_6-3-2-非导引型传输媒体" tabindex="-1"><a class="header-anchor" href="#_6-3-2-非导引型传输媒体"><span>6.3.2 非导引型传输媒体</span></a></h3><ul><li>将自由空间称为“非导引型传输媒体”。</li><li>无线传输所使用的频段很广。</li><li>短波通信（即高频通信）主要是靠电离层的反射，但短波信道的通信质量较差，传输速率低。</li><li>微波在空间主要是直线传播。</li><li>传统微波通信有两种方式： <ul><li>地面微波接力通信</li><li>卫星通信</li></ul></li></ul><h2 id="_6-4-信道复用技术" tabindex="-1"><a class="header-anchor" href="#_6-4-信道复用技术"><span>6.4 信道复用技术</span></a></h2><ul><li><p>复用 (multiplexing) 是通信技术中的基本概念。它允许用户使用一个共享信道进行通信，降低成本，提高利用率。</p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230616162809148.png" alt="image-20230616162809148" style="zoom:50%;"></li><li><p>频分复用 FDM (Frequency Division Multiplexing)：所有用户在同样的时间占用<strong>不同的频率</strong>带宽资源。 <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230616162907383.png" alt="image-20230616162907383" style="zoom:50%;"></p></li><li><p>时分复用 TDM(Time Division Multiplexing): 将时间划分为一段段等长的时分复用帧（TDM 帧）</p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230616163327687.png" alt="image-20230616163327687" style="zoom:50%;"><ul><li>时分复用的所有用户在不同的时间占用同样的频带宽度</li><li>使用时分复用系统传送计算机数据时，由于计算机数据的<strong>突发性质</strong>，用户对分配到的子信道的利用率不高，造成资源的浪费 <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230616163912674.png" alt="image-20230616163912674" style="zoom:50%;"></li></ul></li><li><p>统计时分复用 STDM(Statistic TDM)是改进的时分复用，明显地提高信道的利用率。 <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230616163945176.png" alt="image-20230616163945176" style="zoom:50%;"></p></li><li><p>波分复用 WDM (Wavelength Division Multiplexing)：光的频分复用 <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230616164034707.png" alt="image-20230616164034707" style="zoom:50%;"></p></li></ul><h4 id="码分复用-cdm" tabindex="-1"><a class="header-anchor" href="#码分复用-cdm"><span>码分复用 CDM</span></a></h4><ul><li><p>码分复用 CDM (Code Division Multiplexing)：常用的名词是<!---->：有很强的抗干扰能力。 各用户使用经过特殊挑选的不同码型，彼此不会造成干扰。</p></li><li><p>每一个比特时间划分为 m 个短的间隔，称为<!---->。</p><ul><li><p>每个站被指派一个唯一的 m bit 码片序列。</p><ul><li>如发送比特 1，则发送自己的 m bit 码片序列。</li><li>如发送比特 0，则发送该码片序列的二进制反码。</li></ul></li><li><p>例如，S 站的 8 bit 码片序列是 00011011。</p></li><li><p>发送比特 1 时，就发送序列 00011011，</p></li><li><p>发送比特 0 时，就发送序列 11100100。</p></li><li><p>S 站的码片序列：<code>(–1 –1 –1 +1 +1 –1 +1 +1)</code></p></li></ul></li><li><p>假定 S 站要发送信息的数据率为 b bit/s。由于每一个比特要转换成 m 个比特的码片，因此 S 站实际上发送的数据率提高到 mb bit/s，同时 S 站所占用的频带宽度也提高到原来数值的 m 倍。这种通信方式是<!---->通信中的一种。</p></li><li><p>扩频通信通常有两大类：</p><ul><li>一种是直接序列扩频 DSSS (Direct Sequence Spread Spectrum)，如上面讲的使用码片序列就是这一类。</li><li>另一种是跳频扩频 FHSS (Frequency Hopping Spread Spectrum)。</li></ul></li><li><p>每个站分配的码片序列不仅必须各不相同，并且还必须互相<!---->。</p><ul><li>正交：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>⋅</mo><mi>T</mi><mo>=</mo><mfrac><mn>1</mn><mi>m</mi></mfrac><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>m</mi></msubsup><msub><mi>S</mi><mi>i</mi></msub><msub><mi>T</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">S\cdot T=\frac 1 m\sum^m_{i=1}S_iT_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8043em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></li><li>任何一个码片向量和该码片向量**自己(<code>1</code>)**的规格化内积都是 1 。<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>⋅</mo><mi>S</mi><mo>=</mo><mfrac><mn>1</mn><mi>m</mi></mfrac><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>m</mi></msubsup><msub><mi>S</mi><mi>i</mi></msub><msub><mi>S</mi><mi>i</mi></msub><mo>=</mo><mfrac><mn>1</mn><mi>m</mi></mfrac><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>m</mi></msubsup><msubsup><mi>S</mi><mi>i</mi><mn>2</mn></msubsup><mo>=</mo><mfrac><mn>1</mn><mi>m</mi></mfrac><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>m</mi></msubsup><mo stretchy="false">(</mo><mo>±</mo><mn>1</mn><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">S\cdot S=\frac 1 m\sum^m_{i=1}S_iS_i=\frac 1 m\sum^m_{i=1}S_i^2=\frac 1 m\sum^m_{i=1}(\pm 1)^2=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8043em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8043em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-2.4413em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2587em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8043em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">±</span><span class="mord">1</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></li><li>一个码片向量和该码片**反码(<code>-1</code>)**的向量的规格化内积值是 –1。</li></ul></li><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230616191035557.png" alt="image-20230616191035557" style="zoom:50%;"></li></ul><h2 id="_6-5-数字传输系统" tabindex="-1"><a class="header-anchor" href="#_6-5-数字传输系统"><span>6.5 数字传输系统</span></a></h2><ol><li><strong><!----></strong><ul><li>同步光纤网 SONET (Synchronous Optical Network) 的各级时钟都来自一个非常精确的主时钟。</li><li>SONET 为光纤传输系统定义了同步传输的线路速率等级结构 <ul><li>对电信信号称为第 1 级<strong>同步传送信号</strong> STS-1 (Synchronous Transport Signal)，其传输速率是 51.84 Mbit/s。</li><li>对光信号则称为第 1 级<strong>光载波</strong> OC-1 (OC 表示 Optical Carrier)。</li></ul></li><li>现已定义了从 51.84 Mbit/s (即 OC-1) 一直到 9953.280 Mbit/s (即 OC-192/STS-192) 的标准。</li></ul></li><li><!----><ul><li>ITU-T 以美国标准 SONET 为基础，制订出国际标准同步数字系列 SDH (Synchronous Digital Hierarchy)。</li><li>一般可认为 SDH 与 SONET 是<mark>同义词</mark> 。</li><li>其主要不同点是：SDH 的基本速率为 155.52 Mbit/s，称为<strong>第 1 级同步传递模块</strong> (Synchronous Transfer Module)，即 STM-1，相当于 SONET 体系中的 OC-3 速率。</li></ul></li><li>SONET / SDH 标准的意义 <ul><li>使不同的数字传输体制在 STM-1 等级上获得了统一。</li><li>第一次真正实现了数字传输体制上的世界性标准。</li><li>已成为公认的新一代理想的传输网体制。</li><li>SDH 标准也适合于微波和卫星传输的技术体制。</li></ul></li></ol><h2 id="_6-6-宽带接入" tabindex="-1"><a class="header-anchor" href="#_6-6-宽带接入"><span>6.6 宽带接入</span></a></h2><blockquote><p>用户要连接到互联网，必须先连接到某个 ISP。</p></blockquote><p>从宽带接入的媒体来看，可以划分为两大类：① 有线宽带接入 ② 无线宽带接入</p><h3 id="_6-6-1-adsl-技术" tabindex="-1"><a class="header-anchor" href="#_6-6-1-adsl-技术"><span>6.6.1 ADSL 技术</span></a></h3><ol><li><p>ADSL 技术</p><ul><li><!----> (Asymmetric Digital Subscriber Line) 技术就是用数字技术对现有的模拟电话用户线进行<strong>改造</strong>，使它能够承载宽带业务。</li><li><p>标准模拟电话信号的频带被限制在 300~3400 Hz 的范围内，但用户线本身实际可通过的信号频率仍然超过 1 MHz。</p></li><li><p>ADSL 技术就把 0~4 kHz 低端频谱留给传统电话使用，而把原来没有被利用的<strong>高端频谱留给用户上网使用</strong>。</p></li></ul></li><li><p>DSL 的几种类型</p><ul><li><p>ADSL (Asymmetric Digital Subscriber Line)：非对称数字用户线</p></li><li><p>HDSL (High speed DSL)：高速数字用户线</p></li><li><p>SDSL (Single-line DSL)：1 对线的数字用户线</p></li><li><p>VDSL (Very high speed DSL)：甚高速数字用户线</p></li><li><p>DSL (Digital Subscriber Line) ：数字用户线</p></li><li><p>RADSL (Rate-Adaptive DSL)：速率自适应 DSL，是 ADSL 的一个子集，可自动调节线路速率</p></li></ul></li><li><p>ADSL 的传输距离</p><ul><li>ADSL 的传输距离取决于<strong>数据率</strong>和用户线的<strong>线径</strong>（用户线越细，信号传输时的衰减就越大）。</li><li>ADSL 所能得到的最高数据传输速率与实际的用户线上的<strong>信噪比</strong>密切相关。 <ul><li>例如：0.5 毫米线径的用户线，传输速率为 1.5~2.0 Mbit/s 时可传送 5.5 公里，但当传输速率提高到 6.1 Mbit/s 时，传输距离就缩短为 3.7 公里。</li><li>如果把用户线的线径减小到 0.4 毫米，那么在 6.1 Mbit/s 的传输速率下就只能传送 2.7 公里。</li></ul></li></ul></li><li><p>ADSL 的特点</p><ul><li>上行和下行带宽做成不对称的。上行指从用户到 ISP，而下行指从 ISP 到用户。</li><li>ADSL 在用户线（铜线）的两端各安装一个 <mark>ADSL 调制解调器</mark> 。</li><li>我国目前采用的方案是<!----> DMT (Discrete Multi-Tone)调制技术。 <ul><li>这里的“多音调”就是“<strong>多载波</strong>”或“<strong>多子信道</strong>”的意思。</li></ul></li></ul></li><li><!----> <strong>离散多音频调制</strong>（DMT，Discrete Multi-Tone）<ul><li>DMT 调制技术采用<!---->的方法，把 40 kHz 以上一直到 1.1 MHz 的高端频谱划分为许多子信道，其中 25 个子信道用于上行信道，而 249 个子信道用于下行信道。</li><li>每个子信道占据 4 kHz 带宽（严格讲是 4.3125 kHz），并使用不同的载波（即不同的音调）进行数字调制。这种做法相当于在一对用户线上使用许多小的调制解调器<mark>并行地</mark> 传送数据。</li><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230616194057740.png" alt="image-20230616194057740" style="zoom:50%;"></li></ul></li><li><p>ADSL 的数据率</p><ul><li>由于用户线的具体条件往往相差很大（距离、线径、受到相邻用户线的干扰程度等都不同），因此 ADSL 采用<mark>自适应调制技术</mark> 使用户线能够传送尽可能高的数据率。</li><li>当 ADSL 启动时，用户线两端的 ADSL 调制解调器就测试可用的频率、各子信道受到的干扰情况，以及在每一个频率上测试信号的传输质量。</li><li>ADSL <mark>不能保证固定的数据率</mark> 。对于质量很差的用户线甚至无法开通 ADSL。</li><li>通常下行数据率在 32 kbit/s 到 6.4 Mbit/s 之间，而上行数据率在 32 kbit/s 到 640 kbit/s 之间。</li></ul></li><li><p>ADSL 的组成</p><ul><li><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230616194350828.png" alt="image-20230616194350828" style="zoom:50%;"></li></ul></li><li><p>第二代 ADSL</p><ul><li>包括 ADSL2（G.992.3 和 G.992.4）和 ADSL2+（G.992.5）。</li><li>通过提高调制效率得到了<mark>更高的数据率</mark> 。 <ul><li>ADSL2 要求至少应支持下行 8 Mbit/s、上行 800 kbit/s 的速率。</li><li>ADSL2+ 则将频谱范围从 1.1 MHz 扩展至 2.2 MHz，下行速率可达 16 Mbit/s（最大传输速率可达 25 Mbit/s），而上行速率可达 800 kbit/s。</li><li>采用了<!----> SRA (Seamless Rate Adaptation)，可在运营中不中断通信和不产生误码的情况下，自适应地调整数据率。</li><li>改善了线路质量评测和故障定位功能，这对提高网络的运行维护水平具有非常重要的意义。</li></ul></li></ul></li></ol><h3 id="_6-6-2-光纤同轴混合网-hfc-网" tabindex="-1"><a class="header-anchor" href="#_6-6-2-光纤同轴混合网-hfc-网"><span>6.6.2 光纤同轴混合网(HFC 网)</span></a></h3><ul><li><!---->是在目前覆盖面很广的有线电视网 CATV 的基础上开发的一种居民宽带接入网。<ul><li>HFC 网除可传送 CATV 外，还提供电话、数据和其他宽带交互型业务。</li><li>现有的 CATV 网是树形拓扑结构的同轴电缆网络，它采用模拟技术的频分复用对电视节目进行单向传输。</li><li>HFC 网对 CATV 网进行了改造。</li></ul></li><li>HFC 网的主干线路采用光纤 <ul><li>HFC 网将原 CATV 网中的同轴电缆主干部分改换为光纤，并使用<mark>模拟光纤技术</mark> 。</li><li>在模拟光纤中采用<!---->，这比使用数字光纤更为经济。</li><li>模拟光纤从<mark>头端</mark> 连接到<mark>光纤结点</mark> (fiber node)，即<mark>光分配结点</mark> ODN (Optical Distribution Node)。在光纤结点光信号被转换为电信号。在光纤结点以下就是同轴电缆。</li></ul></li><li>HFC 网采用结点体系结构 <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230616220108497.png" alt="image-20230616220108497" style="zoom:50%;"></li></ul><h3 id="_6-6-3-fttx-技术" tabindex="-1"><a class="header-anchor" href="#_6-6-3-fttx-技术"><span>6.6.3 FTTx 技术</span></a></h3><ul><li><p>FTTx 是一种实现宽带居民接入网的方案，代表多种宽带光纤接入方式。</p></li><li><p>FTTx 表示 Fiber To The…（光纤到…），例如：</p><ol><li><p><strong>光纤到户</strong> <strong>FTTH</strong> (Fiber To The Home)：光纤一直铺设到用户家庭，可能是居民接入网最后的解决方法。</p></li><li><p><strong>光纤到大楼</strong> <strong>FTTB</strong> (Fiber To The Building)：光纤进入大楼后就转换为电信号，然后用电缆或双绞线分配到各用户。</p></li><li><p><strong>光纤到路边</strong> <strong>FTTC</strong> (Fiber To The Curb)：光纤铺到路边，从路边到各用户可使用星形结构双绞线作为传输媒体。</p></li></ol></li></ul><h1 id="第七章-网络安全" tabindex="-1"><a class="header-anchor" href="#第七章-网络安全"><span>第七章 网络安全</span></a></h1><h2 id="攻击分类" tabindex="-1"><a class="header-anchor" href="#攻击分类"><span>攻击分类</span></a></h2><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230619002009309.png" alt="image-20230619002009309" style="zoom:50%;"><ul><li>截获: 机密性</li><li>篡改: 完整性 / 端点鉴别</li><li>恶意攻击: 访问控制</li></ul><h2 id="加密算法" tabindex="-1"><a class="header-anchor" href="#加密算法"><span>加密算法</span></a></h2><ol><li><p>DES</p><ul><li>数据加密标准 DES 属于对称密钥密码体制，是一种分组密码。</li><li>在加密前，先对整个明文进行分组。每一个组长为 64 位。</li><li>然后对每一个 64 位 二进制数据进行加密处理，产生一组 64 位密文 数据。</li><li>最后将各组密文串接起来，即得出整个的密文。</li><li>DES 的保密性仅取决于对<strong>密钥的保密</strong></li></ul></li><li><p>公钥密码体制（为公开密钥密码体制）</p><ul><li>使用不同的加密密钥与解密密钥，是一种由已知加密密钥推导出解密密钥在计算上是不可行的”密码体 制。 <ul><li>在公钥密码体制中，加密密钥 PK 是向公众公开的，而解密密钥 SK 则是需要保密的。</li><li>加密算法和解密算法是公开的</li></ul></li><li>如果某一信息用对方的公开密钥加密，则必须用私有密钥解密，这就是实现保密的方法</li></ul></li><li><p>数字签名</p><ul><li>如果某一信息用自己的私有密钥加密，那么，它必须用公开密钥解密。这就是实现数字签名的方法</li></ul></li><li><p>IPSEC</p><ul><li>给网络层提供安全通信的协议族</li><li>IP 安全数据报格式 两个协议 <!----> 和 <!----> (Encapsulation Security Protocol)</li></ul></li><li><p>SSL</p><ul><li>给运输层，应用层提供安全传输的协议</li><li>改进型是 TSL</li></ul></li></ol><h1 id="第八章-多媒体" tabindex="-1"><a class="header-anchor" href="#第八章-多媒体"><span>第八章 多媒体</span></a></h1><ol><li><!----> (Real-time Streaming Protocol)<ul><li>RTSP 协议以客户服务器方式工作，如：暂停/继续、后退、前进等。它是一个多媒体播放控制协议，用 来使用户在播放从因特网下载的实时数据时能够进行控制</li><li>发起/终结流媒体</li></ul></li><li><!----> (Real-time Transport Protocol)<ul><li>RTP 协议负责对流媒体数据进行封包并实现媒体流的实时传输</li><li>传输流媒体数据</li></ul></li><li><!----> (Session Initiation Protocol)<ul><li>是两个用户终端之间基于 IP 网络的会话</li></ul></li><li>RSVP <ul><li>资源预留协议，通过预留空间，来减缓延迟</li></ul></li></ol><h1 id="第九章-无线网络" tabindex="-1"><a class="header-anchor" href="#第九章-无线网络"><span>第九章 无线网络</span></a></h1><ol><li>IEEE 802.11 <ul><li>使用 CSMA/CA 进行碰撞检测</li></ul></li></ol><h1 id="另附" tabindex="-1"><a class="header-anchor" href="#另附"><span>另附</span></a></h1><h3 id="熟知端口号" tabindex="-1"><a class="header-anchor" href="#熟知端口号"><span>熟知端口号</span></a></h3><table><thead><tr><th>应用程序</th><th>FTP</th><th>TELNET</th><th>SMTP</th><th>DNS</th><th>TFTP</th><th>HTTP</th><th>SNMP</th></tr></thead><tbody><tr><td>熟知端口号</td><td>21</td><td>23</td><td>25</td><td>53</td><td>69</td><td>80</td><td>161</td></tr></tbody></table><p><img src="/JinBlog/assets/image-20230619223600893-D7GqTUQ6.png" alt="image-20230619223600893"></p><h3 id="协议格式" tabindex="-1"><a class="header-anchor" href="#协议格式"><span>协议格式</span></a></h3><h4 id="_1-以太网-v2-帧结构" tabindex="-1"><a class="header-anchor" href="#_1-以太网-v2-帧结构"><span>① 以太网 v2 帧结构</span></a></h4><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230529160314695.png" alt="image-20230529160314695" style="zoom:67%;"><ul><li>前同步码 (8 字节): <ul><li>模式为前 7 个字节是 10101010，第 8 个字节为 10101011</li><li>用于同步接收方，发送方时钟速率</li></ul></li><li>源/目的地址(各 6 字节): <ul><li>如果适配器接收具有匹配的目的地址或广播地址(如 ARP 分组)的帧,它将帧中的数据提交给网络层协议</li><li>否则,适配器丢弃帧</li></ul></li><li>类型（2 字节)∶ 指示帧中封装的是哪个高层协议分组 (大多数为 IP, 但也可以支持其他类型如 Novell IPX 和 AppleTalk)</li><li>数据（46~1500 字节)∶ 指示上层协议载荷，有效的 MAC 帧长度 64 字节~1518 字节。</li><li>CRC(4 字节)∶ 在接收方核对，如果检测到差错，该帧就被丢弃</li></ul><h4 id="_2-ip-数据报" tabindex="-1"><a class="header-anchor" href="#_2-ip-数据报"><span>② IP 数据报</span></a></h4><p>一个 IP 数据报由首部（20 字节+可选字段）和数据两部分组成<br><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230417175646494.png" alt="image-20230417175646494" style="zoom:50%;"></p><ol><li><p>总长度 16 位</p><ul><li><p>指首部和数据部分长度之和(单位为字节)</p></li><li><p>2<sup>16</sup> - 1=65535B, 但是以太网帧的最大传输单元(<!---->)为 1500B, 当一个 IP 数据报成帧时, 不能超过 MTU 的值, 只能进行分片</p></li></ul></li><li><p>标识 16 位 Fragmentation Identifier-分片<!----></p><ul><li>用于分片时标识片来自同一个 IP 数据报</li></ul></li><li><p>标志 3 位</p><ul><li>标志分片情况</li><li>3bits，从左到右分别为: <ul><li>预留，为 0</li><li>DF，<strong>为 1 表示:禁止分片</strong>; 为 0 表示:允许分片</li><li>MF，为 1 表示:之后还有更多分片; 为 0 表示:是最后一个分片的数据报</li></ul></li></ul></li><li><p>段偏移 13 位</p><ul><li>指出分片后在原分组中的相对位置</li><li><mark>其值 ×8B</mark> 为实际的偏移值, 即偏移量以 8 个字节为偏移单位</li></ul></li><li><p>生存时间(TTL-Time To Live) 8 位</p><ul><li>数据报在网络中可以通过的路由器数的最大值, 标识分组在网络中的寿命。 路由器在转发分组前, 先将 TTL-1 若 TTL=0, 丢弃分组</li><li>TTL 缺省值为 30 或更多，除非出现路由循环一般够用 <ul><li>考题: 防止路由循环, IP 数据报采取什么方式</li></ul></li></ul></li><li><p>协议 8 位</p><ul><li>指出分组携带数据使用什么协议(即数据部分应该上交给哪个协议进行处理); 如 TCP(值为 6), UDP(值为 17)</li></ul></li><li><p>首部校验和 16 位</p><ul><li>只校验分组首部, 不校验数据部分</li></ul></li><li><p>原地址字段 4B 32 位 : 发送方的 IP 地址 目的地址字段 4B 32 位 : 接收方的 IP 地址</p></li></ol><h4 id="_3udp" tabindex="-1"><a class="header-anchor" href="#_3udp"><span>③UDP</span></a></h4><p>报文段结构如下图：<img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230504205455201.png" alt="image-20230504205455201" style="zoom:67%;"></p><ul><li>另附 UDP 校验和</li><li>校验和计算需要用到伪首部, UDP 首部, UDP 数据部分 <img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/image-20230327092921174.png" alt="image-20230327092921174" style="zoom:67%;"></li></ul><h4 id="_4tcp" tabindex="-1"><a class="header-anchor" href="#_4tcp"><span>④TCP</span></a></h4><p>TCP 报文段结构如下图：</p><img src="https://yj-notes.oss-cn-hangzhou.aliyuncs.com/image/6be34602716c4c1aa4d64f6e5d944f9b.png" alt="img" style="zoom:50%;"><p>与 UDP 一样，首部包括<strong>源端口号（Source port）和目的端口号（Dest port）</strong>，它被用于多路复用和多路分解来自或送到上层应用的数据，也包括<strong>检验和字段（Internet checksum）</strong>，首部还包括以下字段：</p><ul><li>32bit 的<strong>序号字段（Sequence number）和 32bit 的确认号字段（Acknowledgement number）</strong>；</li><li>16bit 的<strong>接受窗字段（Receive window）</strong>：用于控制流量；</li><li>4bit 的<strong>首部长度字段（Header length）</strong>：指示了以 32bit 的字为单位的 TCP 首部长度；</li><li>可选和变长的<strong>选项字段（Options）</strong>：用于发送方与接收方协商最大报文段长度（MSS）时，或在高速网络环境下用作窗口调节因子时使用；</li><li>6bit 的<strong>标志字段（flag field）</strong>： <ul><li><code>ACK</code>：确认字段中的值是否有效；</li><li><code>RST</code>,<code>SYN</code>,<code>FIN</code>：用于连接建立和拆除；</li><li><code>CWR</code>,<code>ECE</code>：在明确拥塞通过中使用；</li><li><code>PSH</code>：被置位时，指示接收方立即将数据交给上层；</li><li><code>URG</code>：指示报文段中存放着被发送端上层实体置为“紧急”的数据；</li></ul></li><li>16bit 的<strong>紧急数据指针字段（Urgent data point）</strong>：指出紧急数据的最后一个字节；</li></ul></div><!----><!----><!----></div></main><footer class="vp-doc-footer" data-v-50e98be9 data-v-f5809d15><!--[--><!--]--><div class="edit-info" data-v-f5809d15><div class="edit-link" data-v-f5809d15><a class="vp-link link no-icon vp-external-link-icon edit-link-button" href="https://github.com/yJader/JinBlog/edit/main/docs/fzu_cs_course/计算机网络/计算机网络.md" target="_blank" rel="noreferrer" data-v-f5809d15><!--[--><span class="vpi-square-pen edit-link-icon" aria-label="edit icon" data-v-f5809d15></span> 编辑此页<!--]--></a></div><!----></div><div class="contributors" aria-label="Contributors" data-v-f5809d15><span class="contributors-label" data-v-f5809d15>贡献者: </span><span class="contributors-info" data-v-f5809d15><!--[--><!--[--><span class="contributor" data-v-f5809d15>yJader_xx</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" data-v-f5809d15>yJader_r9p</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" data-v-f5809d15>yJader@mba</span><!----><!--]--><!--]--></span></div><nav class="prev-next" data-v-f5809d15><div class="pager" data-v-f5809d15><a class="vp-link link pager-link prev" href="/JinBlog/fzu_cs_course/computer-networks/exercises/" data-v-f5809d15><!--[--><span class="desc" data-v-f5809d15>上一页</span><span class="title" data-v-f5809d15><!----><span data-v-f5809d15>计算机网络 课后题</span></span><!--]--></a></div><div class="pager" data-v-f5809d15><a class="vp-link link pager-link next" href="/JinBlog/fzu_cs_course/operating-systems/nju/" data-v-f5809d15><!--[--><span class="desc" data-v-f5809d15>下一页</span><span class="title" data-v-f5809d15><!----><span data-v-f5809d15>NJU操作系统</span></span><!--]--></a></div></nav></footer><!----><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!--]--><button type="button" class="vp-back-to-top" aria-label="back to top" data-v-6fcf39b7 style="display:none;" data-v-9ccec6f7><span class="percent" data-allow-mismatch data-v-9ccec6f7>0%</span><span class="show icon vpi-back-to-top" data-v-9ccec6f7></span><svg aria-hidden="true" data-v-9ccec6f7><circle cx="50%" cy="50%" data-allow-mismatch style="stroke-dasharray:calc(0% - 12.566370614359172px) calc(314.1592653589793% - 12.566370614359172px);" data-v-9ccec6f7></circle></svg></button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="sign down" class="vp-sign-down" aria-hidden="true" data-v-6fcf39b7 style="display:none;" data-v-8cbe16af><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" data-v-8cbe16af><path d="m19 11l-7 6l-7-6" data-v-8cbe16af></path><path d="m19 5l-7 6l-7-6" opacity="0.6" data-v-8cbe16af></path></g></svg><footer class="vp-footer has-sidebar" vp-footer data-v-6fcf39b7 data-v-ec2d43d3><!--[--><div class="container" data-v-ec2d43d3><div class="message" data-v-ec2d43d3>Powered by <a target="_blank" href="https://v2.vuepress.vuejs.org/">VuePress</a> & <a target="_blank" href="https://theme-plume.vuejs.press">vuepress-theme-plume</a></div><!----></div><!--]--></footer><!--[--><!--]--><!--]--></div><!----><!--]--><!--[--><!--]--><!--]--></div><script type="module" src="/JinBlog/assets/app-AuyBpmKP.js" defer></script></body></html>